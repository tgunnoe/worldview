/*
 * NASA Worldview
 *
 * This code was originally developed at NASA/Goddard Space Flight Center for
 * the Earth Science Data and Information System (ESDIS) project.
 *
 * Copyright (C) 2013 - 2016 United States Government as represented by the
 * Administrator of the National Aeronautics and Space Administration.
 * All Rights Reserved.
 *
 * Licensed under the NASA Open Source Agreement, Version 1.3
 * http://opensource.gsfc.nasa.gov/nosa.php
 */
!function(a,b){"use strict";"object"==typeof module&&module.exports&&"function"==typeof require?module.exports=b():"function"==typeof define&&"object"==typeof define.amd?define(b):a.Queue=b()}(this,function(){"use strict";function a(a,b){this.pendingPromises=0,this.maxPendingPromises="undefined"!=typeof a?a:1/0,this.maxQueuedPromises="undefined"!=typeof b?b:1/0,this.queue=[]}var b="undefined"!=typeof Promise?Promise:function(){return{then:function(){throw new Error("Queue.configure() before use Queue")}}},c=function(){},d=function(a){return a&&"function"==typeof a.then?a:new b(function(b){b(a)})};return a.configure=function(a){b=a},a.prototype.add=function(a){var d=this;return new b(function(b,e,f){return d.queue.length>=d.maxQueuedPromises?void e(new Error("Queue limit reached")):(d.queue.push({promiseGenerator:a,resolve:b,reject:e,notify:f||c}),void d._dequeue())})},a.prototype.getPendingLength=function(){return this.pendingPromises},a.prototype.getQueueLength=function(){return this.queue.length},a.prototype._dequeue=function(){var a=this;if(this.pendingPromises>=this.maxPendingPromises)return!1;var b=this.queue.shift();if(!b)return!1;try{this.pendingPromises++,d(b.promiseGenerator()).then(function(c){a.pendingPromises--,b.resolve(c),a._dequeue()},function(c){a.pendingPromises--,b.reject(c),a._dequeue()},function(a){b.notify(a)})}catch(c){a.pendingPromises--,b.reject(c),a._dequeue()}return!0},a});var edsc={};edsc.map={};var L={};edsc.map.L=L,L.Polyline={prototype:{}},L.Polygon={extend:function(){},prototype:{}},L.Rectangle={prototype:{}},L.LayerGroup={prototype:{}},L.FeatureGroup={prototype:{}},L.EditToolbar={Delete:{prototype:{_removeLayer:{}}}},L.Draw={Polygon:{extend:function(){}}},L.Edit={Poly:{extend:function(){}}},L.Util={isArray:function(a){return a.constructor===Array}},function(){function a(a,b){if(a.lat){var c=a;this.lat=c.lat,this.lng=c.lng}else this.lat=a,this.lng=b}L.LatLng=a,L.latLng=function(a,b){return new L.LatLng(a,b)}}(),function(){var a,b=[].slice;a=window.edsc.map,a.Coordinate=function(a){var c,d,e,f;return d=Math.PI/180,e=180/Math.PI,c=function(){function c(a,b,c,d,e){this.phi=a,this.theta=b,this.x=c,this.y=d,this.z=e}return c.fromLatLng=function(){var a,e,f,g;return a=1<=arguments.length?b.call(arguments,0):[],1===a.length?(g=a[0],e=g.lat,f=g.lng):(e=a[0],f=a[1]),c.fromPhiTheta(e*d,f*d)},c.fromPhiTheta=function(a,b){var d,e,f,g,h,i;for(d=Math.PI,e=Math.cos,f=Math.sin;a>=d;)a-=2*d;for(;a<d;)a+=2*d;for(a>d/2&&(a=d-a,b+=d),a<-d/2&&(a=-d-a,b+=d);b>=d;)b-=2*d;for(;b<-d;)b+=2*d;return g=e(a)*e(b),h=e(a)*f(b),i=f(a),new c(a,b,g,h,i)},c.fromXYZ=function(a,b,d){var e,f,g,h;return e=a*a+b*b+d*d,0===e&&(e=a=1),g=1/Math.sqrt(e),a*=g,b*=g,d*=g,h=Math.atan2(b,a),f=Math.asin(d),new c(f,h,a,b,d)},c.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},c.prototype.cross=function(a){var b,d,e;return b=this.y*a.z-this.z*a.y,d=this.z*a.x-this.x*a.z,e=this.x*a.y-this.y*a.x,c.fromXYZ(b,d,e)},c.prototype.distanceTo=function(a){return Math.acos(this.dot(a))},c.prototype.toLatLng=function(){return new a.LatLng(e*this.phi,e*this.theta)},c.prototype.toString=function(){var a;return a=this.toLatLng(),"("+a.lat.toFixed(3)+", "+a.lng.toFixed(3)+")"},c.prototype.toXYZString=function(){return"<"+this.x.toFixed(3)+", "+this.y.toFixed(3)+", "+this.z.toFixed(3)+">"},c}(),f=c}(L)}.call(this),function(){var a;a=window.edsc.map,a.Arc=function(a,b){var c,d,e;return d=1e-8,c=function(){function a(a,b){var c;b.theta<a.theta&&(c=[a,b],b=c[0],a=c[1]),b.theta-a.theta>Math.PI?(this.coordB=a,this.coordA=b):(this.coordA=a,this.coordB=b),this.normal=this.coordA.cross(this.coordB)}return a.prototype.antimeridianCrossing=function(){var a,c,e,f,g,h,i,j;return a=Math.abs,this.coordA.theta<this.coordB.theta?null:a(Math.PI-a(this.coordA.theta))<d||a(Math.PI-a(this.coordB.theta))<d?null:a(this.coordA.theta-this.coordB.theta)%Math.PI<d?null:(e=this.normal.x,h=this.normal.y,j=this.normal.z,g=this.coordA.y,a(g)<d&&(g=this.coordB.y),a(g)<d?null:a(j)<d&&a(e)<d?null:(c=-j/g,f=0,i=e/g,c>0&&(c=-c,i=-i),b.fromXYZ(c,f,i)))},a}(),e=c}(L,a.Coordinate)}.call(this),function(){var a;a=window.edsc.map,a.geoutil=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;return f=1e-8,g=1,i=2,e=Math.PI/180,h=180/Math.PI,p=function(b,c){return function(d,g,i,j,k,l,m){var n,o,p,q,r,s,t,u,v,w,x,y,z;if(d(b.lat)===(v=d(c.lat))&&90===v)return b;if(c.lng<b.lng&&(w=[c,b],b=w[0],c=w[1]),q=b.lat*e,t=b.lng*e,r=c.lat*e,u=c.lng*e,o=2*g(i(j(k((q-r)/2),2)+l(q)*l(r)*j(k((t-u)/2),2))),n=k(o/2)/k(o),x=n*(l(q)*l(t)+l(r)*l(u)),y=n*(l(q)*k(t)+l(r)*k(u)),z=n*(k(q)+k(r)),p=h*m(z,i(x*x+y*y)),s=h*m(y,x),isNaN(p)||isNaN(s))return b;for(;s<b.lng-f;)s+=360;for(;s>c.lng+f;)s-=360;return new a.LatLng(p,s)}(Math.abs,Math.asin,Math.sqrt,Math.pow,Math.sin,Math.cos,Math.atan2)},k=function(a,c){var d,g,h,i,j,k,l,m,n,o,p,q,r;return r=Math.sin,j=Math.cos,g=Math.atan2,d=Math.PI,h=b.fromLatLng(a),i=b.fromLatLng(a),l=a.lat*e,n=a.lng*e,m=c.lat*e,o=c.lng*e,l>d/2-f?d:l<-d/2+f?2*d:(p=r(n-o)*j(m),k=j(l)*r(m)-r(l)*j(m)*j(n-o),q=g(p,k)%(2*d),q<0&&(q+=2*d),q)},j=function(a,b){var c;return b<a&&(b+=360),c=b-a,180===c?0:c>180?c-360:c},l=function(a){var b,c,d,e,g,h,i;for(d=0,h=a.length,e=g=0,i=h;0<=i?g<i:g>i;e=0<=i?++g:--g)b=a[e],c=a[(e+1)%h],d+=j(b,c);return Math.abs(d)<f&&(d=0),d},n=function(b){var c,e,j,m,n,o,p,q,r,s,t,u,v,w,x,y;if(b.length<3)return!1;for(b=function(){var c,d,e;for(e=[],c=0,d=b.length;c<d;c++)s=b[c],e.push(a.latLng(s));return e}(),e=0,w=b.length,p=r=0,y=w;0<=y?r<y:r>y;p=0<=y?++r:--r)t=b[(p-1+w)%w],u=b[p],v=b[(p+1)%w],x=(k(u,t)+Math.PI)%(2*Math.PI),q=k(u,v),o=(k(v,u)+Math.PI)%(2*Math.PI),j=q-x,j>Math.PI&&(j-=2*Math.PI),j<-Math.PI&&(j+=2*Math.PI),Math.abs(Math.PI-Math.abs(j))<f&&(j=0),m=o-q,m>Math.PI&&(m-=2*Math.PI),m<-Math.PI&&(m+=2*Math.PI),Math.abs(Math.PI-Math.abs(m))<f&&(m=0),e+=j+m;return e*=h,e<-360+f?g|i:e<f?(c=function(){var a,c,d;for(d=[],a=0,c=b.length;a<c;a++)s=b[a],d.push(s.lng);return d}(),n=l(c),n>0?g:n<0?i:(d.debug&&console.warn("Rotation direction is NONE despite containing a pole"),0)):0},m=function(a){var b,c,d,f,g,h,i,j,k,l,n,o,q,r,s,t,u;if(a.length<3)return 0;for(k=[],l=a.length,d=f=0,o=l;0<=o?f<o:f>o;d=0<=o?++f:--f)h=a[d],i=a[(d+1)%l],k.push(h),(Math.abs(h.lat-i.lat)>20||Math.abs(h.lng-i.lng)>20)&&k.push(p(h,i));for(b=Math.PI,c=!1,r=0,l=k.length,d=g=0,q=l;0<=q?g<q:g>q;d=0<=q?++g:--g)h=k[d],i=k[(d+1)%l],j=k[(d+2)%l],s=h.lng*e,t=i.lng*e,u=j.lng*e,n=i.lat*e,Math.abs(t-s)>b&&(c=!c,t>s?t-=2*Math.PI:t+=2*Math.PI),Math.abs(u-t)>b&&(c=!c,u>t?u-=2*Math.PI:u+=2*Math.PI),r+=(u-s)*Math.sin(n);return c&&(r=4*Math.PI+r),m=-r/2,m<0&&(m=4*Math.PI+m),m},o={gcInterpolate:p,area:m,containsPole:n,NORTH_POLE:g,SOUTH_POLE:i}}(L,a.Coordinate,a.Arc,this.edsc.config)}.call(this),function(){var a;a=this.edsc.map.L,a.interpolation=function(a,b){var c,d,e,f,g,h;return d=function(b,c){return a.latLng((b.lat+c.lat)/2,(b.lng+c.lng)/2)},e=function(a,c){return b(a,c)},f=function(b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(null==e&&(e=1),null==f&&(f=10),0===b.length)return[];for(b=Math.abs(b[0].lng)===(u=Math.abs(b[b.length-1].lng))&&180===u?b.concat(b[b.length-1]):b.concat(b[0]),t=function(){var a,d,e;for(e=[],a=0,d=b.length;a<d;a++)m=b[a],e.push(c(m));return e}(),k=[b.shift()],l=[t.shift()],i=0,j=0,p=!1;b.length>0;)n=k[k.length-1],r=l[l.length-1],o=b[0],s=t[0],m=d(n,o),q=c(m),h=Math.max(i,j)+1,g=a.LineUtil.pointToSegmentDistance(q,r,s),g<e||h>=f?(h>=f&&(p=!0),k.push(m,b.shift()),l.push(q,t.shift()),i=j,j=Math.max(0,j-2)):(b.unshift(m),t.unshift(q),j+=1);return p&&config.debug&&console.log("Max interpolation depth reached."),l},h=function(b,c,g,h,i,j){var k,l,m;return null==g&&(g=[]),null==h&&(h="geodetic"),null==i&&(i=1),null==j&&(j=10),"geodetic"===h&&(h=e),"cartesian"===h&&(h=d),l=function(c){var d,e;return d=1e7,90===c.lat&&(c=a.latLng(89.999,c.lng)),e=b.latLngToLayerPoint.call(b,c),e.x=Math.max(Math.min(e.x,d),-d),e.y=Math.max(Math.min(e.y,d),-d),e},m={boundary:f(c,l,h,i,j),holes:function(){var a,b,c,d;for(c=null!=g?g:[],d=[],a=0,b=c.length;a<b;a++)k=c[a],d.push(f(k,l,h,i,j));return d}()}},g=function(){var a;return a=h(this._map,this._latlngs,this._holes,this._interpolationFn),this._originalPoints=a.boundary,this._holePoints=a.holes},a.Polyline.prototype.projectLatlngs=g,a.Polygon.prototype.projectLatlngs=g,a.Polyline.prototype._interpolationFn=e,a.Rectangle.prototype._interpolationFn=d,c={projectPath:h}}(L,window.edsc.map.geoutil.gcInterpolate)}.call(this),function(){var a;a=edsc.map,a.L.sphericalPolygon=function(a,b,c,d){var e,f,g,h,i,j,k,l;return f=function(b){var c,d,e,f,g;for(g=[],c=0,e=b.length;c<e;c++){for(f=b[c],d=a.latLng(f);d.lng>180;)d.lng-=360;for(;d.lng<-180;)d.lng+=360;g.push(d)}return g},e=function(b,e){var f,g;return f=new c(d.fromLatLng(a.latLng(b)),d.fromLatLng(a.latLng(e))),null!=(g=f.antimeridianCrossing())?g.toLatLng():void 0},k=function(a){var c;return c=b.area(a),c>2*Math.PI&&a.reverse(),a},j=function(a){var b;return function(){var c,d,e;for(e=[],c=0,d=a.length;c<d;c++)b=a[c],e.push("("+b.lat+", "+b.lng+")");return e}().join(", ")},i=function(a){var b;return function(){var c,d,e,f;for(e=a.concat(a[0]),f=[],c=0,d=e.length;c<d;c++)b=e[c],f.push(b.lng+","+b.lat);return f}().join(", ")},g=function(c){var d,g,h,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S;if(v=[],d=[],r=[],c&&a.Util.isArray(c[0])&&"number"!=typeof c[0][0]){for(Q=c.slice(1),w=0,E=Q.length;w<E;w++)q=Q[w],q=f(q),denormalizePath(q),r.push(q);c=c[0]}for(c=f(c),c=k(c),h=b.containsPole(c),i=0!==(h&b.NORTH_POLE),j=0!==(h&b.SOUTH_POLE),J=-95,K=95,S=[],D=c.length,s=x=0,R=D;0<=R?x<R:x>R;s=0<=R?++x:--x)for(B=c[s],C=c[(s+1)%D],l=e(B,C),S.push(B),n=[],null!=l?(z=l.lat,n=B.lng<C.lng?[[z,-180],[z,180]]:[[z,180],[z,-180]]):180===B.lng&&C.lng<0?n=[[B.lat,-180]]:B.lng===-180&&C.lng>0?n=[[B.lat,180]]:180===C.lng&&B.lng<0?n=[[C.lat,-180]]:C.lng===-180&&B.lng>0&&(n=[[C.lat,180]]),y=0,F=n.length;y<F;y++)m=n[y],z=m[0],H=m[1],S.push(a.latLng(z,H)),J=Math.max(z,J),K=Math.min(z,K);if(o=c.length<S.length,u=[],g=[],o&&(180!==Math.abs(S[0].lng)||180!==Math.abs(S[S.length-1].lng))){for(;180!==Math.abs(S[0].lng);)S.push(S.shift());S.push(S.shift())}for(s=I=0,G=S.length;I<G;s=++I)if(A=S[s],u.push(A),g.push(A),M=S[(s+1)%S.length],u.length>2&&180===Math.abs(A.lng)&&180===Math.abs(M.lng)){if(d.push(g),g=[],p=!1,i&&A.lat===J)for(p=!0,H=A.lng,t=H<0?90:-90,s=L=0;L<=4;s=++L)u.push(a.latLng(90,H+s*t));if(j&&A.lat===K)for(p=!0,H=A.lng,t=H<0?90:-90,s=N=0;N<=4;s=++N)u.push(a.latLng(-90,H+s*t));p||(v.push(u),u=[])}if(g.length>0&&d.push(g),u.length>0&&v.push(u),i&&j&&!o){for(u=[],s=O=0;O<=4;s=++O)u.push(a.latLng(90,-180+90*s));for(s=P=0;P<=4;s=++P)u.push(a.latLng(-90,180-90*s));v.unshift(u)}return{interiors:v,boundaries:d}},a.SphericalPolygon=a.Polygon.extend({includes:[a.LayerGroup.prototype,a.FeatureGroup.prototype],options:{fill:!0},initialize:function(b,c){return this._layers={},this._options=a.extend({},this.options,c),this.setLatLngs(b)},setLatLngs:function(b){var c,d;return b[0]&&Array.isArray(b[0])&&b[0].length>2&&(console.warn&&console.warn("Polygon with hole detected.  Ignoring."),b=b[0]),b=function(){var c,e,f;for(f=[],c=0,e=b.length;c<e;c++)d=b[c],f.push(a.latLng(d));return f}(),this._latlngs=b,c=g(b),this._boundaries?(this._interiors.setLatLngs(c.interiors),this._boundaries.setLatLngs(c.boundaries)):(this._interiors=a.polygon(c.interiors,a.extend({},this._options,{stroke:!1})),this._boundaries=a.multiPolyline(c.boundaries,a.extend({},this._options,{fill:!1})),this.addLayer(this._interiors),this.addLayer(this._boundaries))},getLatLngs:function(){return k(this._latlngs.concat())},newLatLngIntersects:function(a,b){return!1},setOptions:function(b){return this._options=this.options=a.extend({},this._options,b),a.setOptions(this._interiors,a.extend({},this._options,{stroke:!1})),a.setOptions(this._boundaries,a.extend({},this._options,{fill:!1})),this.redraw()},setStyle:function(b){return this.options.previousOptions&&(this.options.previousOptions=this._options),this._interiors.setStyle(a.extend({},b,{stroke:!1})),this._boundaries.setStyle(a.extend({},b,{fill:!1}))},redraw:function(){return this.setLatLngs(this._latlngs)}}),a.sphericalPolygon=function(b,c){return new a.SphericalPolygon(b,c)},l=a.EditToolbar.Delete.prototype._removeLayer,a.EditToolbar.Delete.prototype._removeLayer=function(a){var b;return(null!=(b=a.target)?b._boundaries:void 0)&&(a.layer=a.target),l.call(this,a)},a.Draw.Polygon=a.Draw.Polygon.extend({Poly:a.SphericalPolygon,addHooks:function(){if(a.Draw.Polyline.prototype.addHooks.call(this),this._map)return this._poly=new a.SphericalPolygon([],this.options.shapeOptions)}}),a.Edit.Poly=a.Edit.Poly.extend({_getMiddleLatLng:function(a,c){var d;return d=b.gcInterpolate(a.getLatLng(),c.getLatLng())}}),h={dividePolygon:g}}(L,a.geoutil,a.Arc,a.Coordinate)}.call(this);var wv=wv||{};wv.brand=wv.brand||function(){var a={};return a.NAME="EOSDIS Worldview",a.VERSION="1.4.5",a.BUILD_TIMESTAMP="August 24, 2017 - 14:28 UTC",a.BUILD_NONCE="20170824142834978",a.release=function(){return"@"!==a.VERSION[0]},a.url=function(b){var c=_.indexOf(b,"?")<0?"?":"&";return b+c+"v="+a.BUILD_NONCE},a}();var wv=wv||{};wv.util=wv.util||{},wv.util.browser=wv.util.browser||function(){var a={};a.ie=!1,a.safari=!1,a.firefox=!1,a.version=null,a.small=!1,a.constrained=!1,a.cors=!0,a.webWorkers=!0,a.localStorage=!0,a.history=!0,a.touchDevice=!1,a.mobileWidth=740,a.constrainedHeight=320;var b=function(){var b=a.tests;b.safari()?(a.safari=!0,a.version=b.safariVersion()):b.ie()?(a.ie=!0,a.version=b.ieVersion()):b.firefox()&&(a.firefox=!0),a.cors=b.cors(),a.webWorkers=b.webWorkers(),a.localStorage=b.localStorage(),a.small=b.small(),a.history=b.history(),a.touchDevice=b.touchDevice();var c=function(){a.small=b.small(),a.constrained=b.constrained()};$(window).on("resize",c),$(function(){c()})};return a.tests={},a.tests.navigator=function(){return navigator},a.tests.window=function(a){return window[a]},a.tests.safari=function(){var b=a.tests.navigator();return!/ Chrome\//.test(b.userAgent)&&/ Safari\//.test(b.userAgent)},a.tests.safariVersion=function(){var b=a.tests.navigator(),c=b.userAgent.match(/ Version\/([^ ]+)/);if(c)return parseInt(c[1].split(".")[0])},a.tests.ie=function(){var b=a.tests.navigator();return!!/MSIE /.test(b.userAgent)||"Netscape"===b.appName&&/Trident/.test(b.userAgent)},a.tests.firefox=function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},a.tests.touchDevice=function(){var a=document.createElement("div");return a.setAttribute("ontouchstart","return;"),"function"==typeof a.ontouchstart},a.tests.ieVersion=function(){var b=a.tests.navigator(),c=b.userAgent.match(/MSIE ([\d\.]+)/);if(c)return parseInt(c[1].split(".")[0])},a.tests.cors=function(){return!(a.tests.safari()&&a.tests.safariVersion()<=6)&&!a.tests.ie()},a.tests.webWorkers=function(){return a.tests.window("Worker")},a.tests.localStorage=function(){if(!a.tests.window("localStorage"))return!1;try{localStorage.setItem("available","true")}catch(a){return!1}return!0},a.tests.small=function(){return $(window).width()<a.mobileWidth},a.tests.constrained=function(){return $(window).height()<a.constrainedHeight},a.tests.history=function(){return window.history&&window.history.replaceState},b(),a}(),Date.prototype.toISOString||!function(){function a(a){return a<10?"0"+a:a}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}(),window.console||!function(){window.console={log:function(){},warn:function(){},info:function(){},error:function(){}}}(),function(){for(var a=$.event.props,b=a.length,c=[];b--;){var d=a[b];"layerX"!=d&&"layerY"!=d&&c.push(d)}$.event.props=c}(),function(){var a=function(){window.scrollTo(0,0),document.body.style.height="100%",/(iphone|ipod)/.test(navigator.userAgent.toLowerCase())||document.body.parentNode&&(document.body.parentNode.style.height="100%")};setTimeout(a,700),setTimeout(a,1500)}(),function(){window.scrollTo(0,0)}(),wv.util.browser.ie&&wv.util.browser.version<=9&&!function(){var a=window.setTimeout,b=window.setInterval;window.setTimeout=function(b,c){var d=this,e=Array.prototype.slice.call(arguments,2);return a(b instanceof Function?function(){b.apply(d,e)}:b,c)},window.setInterval=function(a,c){var d=this,e=Array.prototype.slice.call(arguments,2);return b(a instanceof Function?function(){a.apply(d,e)}:a,c)}}(),"contains"in String.prototype||!function(){String.prototype.contains=function(a,b){return-1!==String.prototype.indexOf.call(this,a,b)}}(),String.prototype.startsWith||!function(){Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){return b=b||0,this.indexOf(a,b)===b}})}(),String.prototype.endsWith||!function(){Object.defineProperty(String.prototype,"endsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){b=b||this.length,b-=a.length;var c=this.lastIndexOf(a);return c!==-1&&c===b}})}(),function(){function a(a){if(navigator.userAgent.match(/(iPad|iPhone|iPod touch);.*CPU.*OS 6_\d/i)){var b=$(window).height();b+=60,$("#app").css("min-height",0).css("height",b)}else $("#app, .ui-mobile, .ui-mobile .ui-page").css("min-height",0)}(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))&&(mobile=!0,90!=window.orientation&&window.orientation!=-90&&(portrait=!0)),navigator.userAgent.indexOf("iPhone")==-1&&navigator.userAgent.indexOf("Android")==-1||(navigator.userAgent.indexOf("Safari")!=-1&&(mobileSafari=!0),addEventListener("load",function(){mobile&&$(".layerPicker a[href='#DataDownload']").hide(),a(),window.scrollTo(0,1),$("#app, .ui-mobile, .ui-mobile .ui-page").css("min-height",0)},!1),addEventListener("orientationchange",function(){window.scrollTo(0,1),a()},!1)),$(window).on("touchmove",function(a){a.target.classList.contains("scrollable")||a.preventDefault()},!1)}();var wv=wv||{};wv.util=function(a){var b=null;a.LAYER_GROUPS={baselayers:{id:"baselayers",camel:"BaseLayers",description:"Base Layers"},overlays:{id:"overlays",camel:"Overlays",description:"Overlays"}},a.repeat=function(a,b){for(var c="",d=0;d<b;d++)c+=a;return c},a.pad=function(b,c,d){if(b=""+b,b.length<c){var e=c-b.length;b=a.repeat(d,e)+b}return b},a.fromQueryString=function(a){if(!a)return{};"?"===a[0]&&(a=a.substring(1));for(var b=a.split("&"),c={},d=0;d<b.length;d++){var e=b[d].indexOf("="),f=b[d].substring(0,e),g=b[d].substring(e+1);c[f]=decodeURIComponent(g)}return c},a.toQueryString=function(a,b){b=b||{};var c=[];return _.each(a,function(a,d){var e=d+"="+encodeURIComponent(a);_.each(b,function(a){var b=new RegExp(a,"ig"),c=decodeURIComponent(a);e=e.replace(b,c)}),c.push(e)}),0===c.length?"":"?"+c.join("&")},a.parseTimestampUTC=function(b){return a.parseDateUTC(b)},a.getCanvasPixelData=function(a,b,c){var d=a.getContext("2d");return d.getImageData(b,c,1,1).data},a.parseDateUTC=function(a){var b=a.split(/T/),c=b[0].split("-"),d=c[0],e=c[1]-1,f=c[2],g=0,h=0,i=0,j=0;if(b.length>1){var k=b[1].split(/[:\.Z]/);g=k[0]||0,h=k[1]||0,i=k[2]||0,j=k[3]||0}var l=new Date(Date.UTC(d,e,f,g,h,i,j));if(isNaN(l.getTime()))throw new Error("Invalid date: "+a);return l},a.getTextWidth=function(a,c){b=b||document.createElement("canvas");var d=b.getContext("2d");d.font=c;var e=d.measureText(a);return e.width},a.toISOStringDate=function(a){return a.toISOString().split("T")[0]},a.toISOStringTimeHM=function(a){var b=a.toISOString().split("T")[1],c=b.split(".")[0].split(":");return c[0]+":"+c[1]},a.getDatePercent=function(a,b,c){return Math.round((a-b)/(c-b))},a.clearTimeUTC=function(a){return a.setUTCHours(0),a.setUTCMinutes(0),a.setUTCSeconds(0),a.setUTCMilliseconds(0),a},a.dateAdd=function(a,b,c){var d,e,f,g=new Date(a.getTime());switch(b){case"day":g.setUTCDate(g.getUTCDate()+c);break;case"month":f=g.getUTCFullYear(),d=g.getUTCMonth(),e=new Date(f,d+c+1,0).getUTCDate(),e<=a.getUTCDate()&&g.setUTCDate(e),g.setUTCMonth(d+c);break;case"year":g.setUTCFullYear(g.getUTCFullYear()+c);break;default:throw new Error("[dateAdd] Invalid interval: "+b)}return g},a.daysInMonth=function(a){var b,c;a.getUTCFullYear?(b=a.getUTCFullYear(),c=a.getUTCMonth()):(b=a.year,c=a.month);var d=new Date(Date.UTC(b,c+1,0));return d.getUTCDate()},a.objectLength=function(a){return Object.keys(a).length},a.giveWeekDay=function(a){var b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return b[a.getUTCDay()]},a.giveMonth=function(a){var b=["January","February","March","April","May","June","July","August","September","October","November","December"];return b[a.getUTCMonth()]},a.clamp=function(a,b,c){return a<b?b:a>c?c:a},a.roll=function(a,b,c){return a<b?c-(b-a)+1:a>c?b+(a-c)-1:a},a.minDate=function(){return new Date(Date.UTC(1e3,0,1))},a.maxDate=function(){return new Date(Date.UTC(3e3,11,31))},a.rollRange=function(b,c,d,e){var f,g,h=b.getUTCFullYear(),i=b.getUTCMonth();b.getUTCDate();switch(c){case"day":var j=new Date(Date.UTC(h,i,1)),k=new Date(Date.UTC(h,i,a.daysInMonth(b)));f=new Date(Math.max(j,d)).getUTCDate(),g=new Date(Math.min(k,e)).getUTCDate();break;case"month":var l=new Date(Date.UTC(h,0,1)),m=new Date(Date.UTC(h,11,31));f=new Date(Math.max(l,d)).getUTCMonth(),g=new Date(Math.min(m,e)).getUTCMonth();break;case"year":var n=a.minDate(),o=a.maxDate();f=new Date(Math.max(n,d)).getUTCFullYear(),g=new Date(Math.min(o,e)).getUTCFullYear()}return{first:f,last:g}},a.rollDate=function(b,c,d,e,f){e=e||a.minDate(),f=f||a.maxDate();var g=a.rollRange(b,c,e,f),h=g.first,i=g.last,j=b.getUTCDate(),k=b.getUTCMonth(),l=b.getUTCFullYear();switch(c){case"day":j=a.roll(j+d,h,i);break;case"month":k=a.roll(k+d,h,i);break;case"year":l=a.roll(l+d,h,i);break;default:throw new Error("[rollDate] Invalid interval: "+c)}var m=a.daysInMonth({year:l,month:k});j>m&&(j=m);var n=new Date(Date.UTC(l,k,j));return n=new Date(wv.util.clamp(n,e,f))},a.toCompactTimestamp=function(a){return a.toISOString().replace(/[-:TZ\.]/g,"")},a.fromCompactTimestamp=function(a){var b=a.match(/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{3})/);if(_.isNull(b))throw new Error("Invalid timestamp:"+a);return new Date(Date.UTC(parseInt(b[1],10),parseInt(b[2]-1,10),parseInt(b[3],10),parseInt(b[4],10),parseInt(b[5],10),parseInt(b[6],10),parseInt(b[7],10)))};var c=function(){return new Date};return a.now=c,a.resetNow=function(){a.now=c},a.today=function(){return a.clearTimeUTC(a.now())},a.error=function(a,b){wv.ui.error(a,b)},a.warn=console&&console.warn&&console.warn.bind?console.warn.bind(console):function(){},a.hexToRGB=function(a){return"rgb("+parseInt(a.substring(0,2),16)+","+parseInt(a.substring(2,4),16)+","+parseInt(a.substring(4,6),16)+")"},a.hexToRGBA=function(a){return"rgba("+parseInt(a.substring(0,2),16)+","+parseInt(a.substring(2,4),16)+","+parseInt(a.substring(4,6),16)+","+parseInt(a.substring(6,8),16)+")"},a.rgbaToHex=function(a,b,c){function d(a){var b=a.toString(16);return 1==b.length?"0"+b:b}return d(a)+d(b)+d(c)+"ff"},a.hexColorDelta=function(a,b){var c=parseInt(a.substring(0,2),16),d=parseInt(a.substring(2,4),16),e=parseInt(a.substring(4,6),16),f=parseInt(b.substring(0,2),16),g=parseInt(b.substring(2,4),16),h=parseInt(b.substring(4,6),16);return Math.sqrt(Math.pow(c-f,2)+Math.pow(d-g,2)+Math.pow(e-h,2))},a.ajaxCache=function(a){a=a||{};var b=a.size||null,c=a.options||{},d=new Cache(b);return{submit:function(a){var b="url="+a.url;a.data&&(b+="&query="+$.param(a.data,!0));var e=d.getItem(b);if(e)return $.Deferred().resolve(e).promise();var f=$.ajax(a);return f.done(function(a){d.setItem(b,a,c)}),f}}},a.localStorage=function(a,b){return _.isUndefined(b)?localStorage.getItem(a):void localStorage.setItem(a,b)},a.isInLocalStorage=function(a){return localStorage.getItem(a)},a.wrap=function(a){return function(){try{return a.apply(a,arguments)}catch(a){wv.util.error(a)}}},a.get=function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a),d.onload=function(){200==d.status?b(d.response):c(Error(d.statusText))},d.onerror=function(){c(Error("Network Error"))},d.send()})},a.ajaxJoin=function(a){var b=0,c={},d=$.Deferred();return $.each(a,function(e,f){f.promise.done(function(e){c[f.item]=e,b+=1,b==a.length&&d.resolve(c)}).fail(function(a,b,c){d.reject(a,b,c)})}),d.promise()},a.jqueryEscape=function(a){return encodeURIComponent(a).replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1")},a.metrics=function(){window.ntptEventTag?ntptEventTag.apply(null,arguments):console.log("no metrics")},a.key={LEFT:37,RIGHT:39,UP:38,DOWN:40},a.formatDMS=function(b,c){var d,e;"longitude"===c?(d=3,e="EW"):(d=2,e="NS");var f=b>=0?e[0]:e[1];b=Math.abs(b);var g=Math.floor(b),h=Math.floor(60*b-60*g),i=Math.floor(3600*b-3600*g-60*h),j=a.pad(g,d," "),k=a.pad(h,2,"0"),l=a.pad(i,2,"0");return j+"&deg;"+k+"'"+l+'"'+f},a.setCoordinateFormat=function(b){if("latlon-dd"!==b&&"latlon-dms"!==b)throw new Error("Invalid coordinate format: "+b);a.localStorage("coordinateFormat",b)},a.getCoordinateFormat=function(){return a.localStorage("coordinateFormat")||"latlon-dd"},a.formatCoordinate=function(b,c){var d=c||a.getCoordinateFormat();return"latlon-dms"===d?a.formatDMS(b[1],"latitude")+", "+a.formatDMS(b[0],"longitude"):b[1].toFixed(4)+"&deg;, "+b[0].toFixed(4)+"&deg;"},a.format=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+b+"\\}","gi");a=a.replace(c,arguments[b])}return a},a.toArray=function(a){return a?(a.constructor!==Array&&(a=[a]),a):[]},a}(wv.util||{});var wv=wv||{};wv.util=wv.util||{},wv.util.load=wv.util.load||function(){var a={},b={},c=0,d=null,e=null;return a.config=function(a,f,g){var h=$.Deferred();return b[g]?(b[g].done(h.resolve).fail(h.reject),h):(a[f]&&_.size(a[f])>0?h.resolve(a[f]):(c+=1,h=$.getJSON(wv.brand.url(g)),1===c&&(d=setTimeout(function(){e=wv.ui.indicator.loading()},2e3)),h.done(function(b){a[f]=b}).always(function(){delete b[g],c-=1,0===c&&(clearTimeout(d),d=null,wv.ui.indicator.hide(e))}).fail(wv.util.error),b[g]=h),h)},a}();var wv=wv||{};wv.util=wv.util||{},wv.util.events=wv.util.events||function(){var a={},b={},c=[];return a.on=function(c,d){if(!d)throw new Error("No listener specified");var e=b[c];return e||(e=[],b[c]=e),e.push(d),a},a.off=function(c,d){var e=b[c];return e&&_.pull(e,d),a},a.any=function(a){if(!a)throw new Error("No listener specified");c.push(a)},a.trigger=function(d){var e=b[d];if(e||c){var f=Array.prototype.slice.call(arguments,1);return _.each(b[d],function(b){b.apply(a,f)}),_.each(c,function(b){b.apply(a,f)}),a}},a};var wv=wv||{};wv.ui=function(a){a.error=function(){console.error.apply(console,arguments),a.notify("<div class='error-header'><i class='error-icon fa fa-exclamation-triangle fa-3x'></i>An unexpected error has occurred</div><div class='error-body'>Please reload the page and try again. If you continue to have problems, contact us at <a href='mailto:support@earthdata.nasa.gov'>support@earthdata.nasa.gov</a></div>","Error")},a.notify=function(b,c,d,e){var f=a.getDialog();c=c||"Notice",d=d||300,f.html(b).dialog({title:c,width:d,minHeight:1,height:"auto",show:{effect:"fade",duration:400},hide:{effect:"fade",duration:200}}).on("dialogclose",function(){$(this).off("dialogclose"),e&&e()})},a.notify.small=function(b,c,d,e){a.getDialog();b=b||"Notice",d=d||200},a.ask=function(b){var c=a.getDialog("wv-dialog-ask"),d=b.cancelButton||"Cancel",e=b.okButton||"OK",f={};f[d]=function(){$(this).dialog("close"),b.onCancel&&b.onCancel()},f[e]=function(){$(this).dialog("close"),b.onOk&&b.onOk()},c.dialog({title:b.header||"Notice",resizable:!1,modal:!0,buttons:f}).html(b.message).on("dialogclose",function(){b.onCancel&&b.onCancel()})},a.unsupported=function(a){var b;b=a?"The "+a+" feature":"This feature",wv.ui.notify(b+" is not supported with your web browser. Upgrade or try again in a different browser.")};var b=function(a,b){return $element=$("<div></div>").addClass(a),$("body").append($element),$element},c=function(a,b){var c="."+a,d=$(c);0!==d.length&&b(d)},d=function(a){0!==a.length&&(a.dialog&&a.dialog("close"),a.remove())},e=function(a){0!==a.length&&a.remove()};return a.close=function(){c("wv-dialog",d),c("wv-menu",e)},a.getDialog=function(c,e){return a.close(c),b(c||"wv-dialog",d)},a.getMenu=function(c){return a.close(),b(c||"wv-menu",e)},a.closeDialog=function(){a.close()},a.positionMenu=function(a,b){var c=function(){a.menu().position(b)};c(),$(window).resize(c),a.on("hide",function(){$(window).off("resize",c)})},a.positionDialog=function(a,b){var c=function(){a.dialog("option","position",b)};c(),$(window).resize(c),a.on("dialogclose",function(){$(window).off("resize",c)})},a}(wv.ui=wv.ui||{});var wv=wv||{};wv.ui=wv.ui||{},wv.ui.mouse=wv.ui.mouse||{},wv.ui.mouse.click=wv.ui.mouse.click||function(a,b){var c={};c.sensitivity=5;var d,e,f=function(){a.mousedown(g),a.mouseup(h)},g=function(a){d=a.clientX,e=a.clientY},h=function(a){i(a)&&b.call(this)},i=function(a){var b=a.clientX,f=a.clientY,g=Math.sqrt(Math.pow(d-b,2)+Math.pow(e-f,2));return g<=c.sensitivity};return f(),c},wv.ui.mouse.wheel=wv.ui.mouse.wheel||function(a,b,c){c=c||{};var d={};d.timeout=c.timeout||100,d.threshold=c.threshold||100,d.events=wv.util.events();var e=0,f=!1,g=null,h=!1,i=null,j=function(){a.on("zoom",k)};d.change=function(a){return d.events.on("change",a),d};var k=function(){var a=d3.event.sourceEvent;Math.abs(a.deltaX)<=Math.abs(a.deltaY)&&h===!1?(i=a,e+=a.deltaY,g||(f=!1),clearTimeout(g),g=setTimeout(m,d.timeout),l(a)):Math.abs(a.deltaX)>=Math.abs(a.deltaY)?b.timeline.isCropped&&(b.timeline.pan.axis(d3.event),h=!0,clearTimeout(g),g=setTimeout(function(){h=!1},500)):b.timeline.isCropped&&b.timeline.pan.axis()},l=function(a){var b=Math.floor(Math.abs(e)/d.threshold);if(b>=1){var c=e?e<0?-1:1:0;d.events.trigger("change",c*b,a),e%=d.threshold,f=!0}},m=function(){if(g=null,!f){var a=e?e<0?-1:1:0;d.events.trigger("change",a,i)}i=null,e=0,f=!1};return j(),d};var wv=wv||{};wv.ui=wv.ui||{},wv.ui.indicator=wv.ui.indicator||function(){var a,b,c,d={};d.active=[];var e=function(){a=$("<div></div>").attr("id","indicator"),b=$("<img />"),c=$("<span></span>"),a.append(b).append(c).hide(),$("body").append(a)};return d.show=function(a,b){d._show(a,b);var c=_.uniqueId();return d.active.push({id:c,message:a,icon:b}),c},d.hide=function(a){if(_.isString(a)&&(a=[a]),_.each(a,function(a){_.remove(d.active,{id:a})}),_.isEmpty(d.active))d._hide();else{var b=_.last(d.active);d._show(b.message,b.icon)}},d.replace=function(a,b,c){return d.hide(a),d.show(b,c)},d._show=function(d,f){a||e(),f?(a.removeClass("message"),b.attr("src",f).show()):(a.addClass("message"),b.removeAttr("src").hide()),c.html(d),a.show()},d._hide=function(){a&&a.hide()},d.searching=function(a){return a&&d.hide(a),d.show("Searching for Data","images/activity.gif")},d.loading=function(a){return a&&d.hide(a),d.show("Loading","images/activity.gif")},d.noData=function(a){return a&&d.hide(a),d.show("No Data Available","images/red-x.svg")},d.delayed=function(a,b){b=b||1e3;var c,e=setTimeout(function(){c=d.loading()},b);a.always(function(){clearTimeout(e),c&&d.hide(c)})},d}();var wv=wv||{};wv.ui=wv.ui||{},wv.ui.info=wv.ui.info||function(a,b){var c="#wv-info-button",d=$("<input />").attr("type","checkbox").attr("id","wv-info-button-check"),e=$("<label></label>").attr("for","wv-info-button-check").attr("title","Information"),f=$("<i></i>").addClass("fa").addClass("fa-info-circle").addClass("fa-2x");e.append(f),$(c).append(e),$(c).append(d),d.button({text:!1}),d.click(function(a){a.stopPropagation(),wv.ui.close();var b=$("#wv-info-button-check").prop("checked");b&&g()});var g=function(){var c,f,g=wv.ui.getMenu().attr("id","wv-info-menu"),h="https://github.com/nasa-gibs/worldview/releases",i=$("<ul></ul>"),j=$("<li><a class='feedback'><i class='ui-icon fa fa-envelope fa-fw'></i>Send Feedback</a></li>"),k=$("<li><a><i class='ui-icon fa fa-truck fa-fw'></i>Start Tour</a></li>"),l=$("<li><a><i class='ui-icon fa fa-file fa-fw'></i>About</a></li>"),m=$("<li><a><i class='ui-icon fa fa-code fa-fw'></i>Source</a></li>");
b.features.alert&&(c=a.alert.getAlert(),f=a.alert.getMessages(),b.features.alert.releases&&(h=b.features.alert.releases)),f||(f=$("<li><a target='_blank' href='"+h+"'><i class='ui-icon fa fa-flag fa-fw'></i>What's New</a></li>")),b.features.feedback&&i.append(j),b.features.tour&&i.append(k),i.append(m),i.append(l),b.features.whatsNew&&i.append(f),c&&i.append(c),i.append(l),g.append(i),i.menu(),wv.ui.positionMenu(i,{my:"left top",at:"left bottom + 5",of:e}),i.hide(),l.click(function(){wv.util.browser.small||wv.util.browser.touchDevice?window.open("brand/pages/about.html?v=20170824142834978","_blank"):wv.ui.getDialog().dialog({title:"About",width:625,height:525,show:{effect:"fade"},hide:{effect:"fade"}}).load("brand/pages/about.html?v=20170824142834978 #page").addClass("wv-opaque")}),m.click(function(a){window.open("https://github.com/nasa-gibs/worldview","_blank")}),wv.feedback.decorate(j.find("a")),k.click(function(){a.tour.start()}),$("#wv-toolbar").find("input:not(#wv-info-button-check)").prop("checked",!1).button("refresh"),i.show("slide",{direction:"up"});var n=function(a){d.parent().has(a.target).length>0||(i.hide(),$("#wv-info-button-check").prop("checked",!1),$("#wv-info-button").find("label").removeClass("ui-state-hover"),d.button("refresh"),$("body").off("click",n).off("touchstart",n))};i.on("touchstart",function(a){a.stopPropagation()}),$("html").one("click",n).one("touchstart",n)}};var wv=wv||{};wv.map=wv.map||{},wv.map.ui=wv.map.ui||function(a,b,c){var d,e,f,g="wv-map",h="#"+g,i=new Cache(400),j=250,k={},l=new c.Rotation(k,a),m=c.Dateline(a,b),n=c.Precache(a,b,i,k),o=k.runningdata=new c.Runningdata(a);ol.has.DEVICE_PIXEL_RATIO>1;k.mapIsbeingDragged=!1,k.mapIsbeingZoomed=!1,k.proj={},k.selected=null,k.events=wv.util.events(),d=k.layerBuilder=c.Layerbuilder(a,b,i,k),e=k.layerKey=d.layerKey,f=k.createLayer=d.createLayer,k.promiseDay=n.promiseDay;var p=function(){b.parameters.mockMap||(_.forOwn(b.projections,function(a){var b=K(a);k.proj[a.id]=b}),a.proj.events.on("select",function(){q()}),a.layers.events.on("add",y).on("remove",z).on("visibility",w).on("opacity",x).on("update",A),a.date.events.on("select",B),a.palettes.events.on("set-custom",C).on("clear-custom",C).on("range",C).on("update",C),$(window).on("resize",r),q(!0))},q=function(b){k.selected&&(k.selected.previousCenter=k.selected.center,s(k.selected)),k.selected=k.proj[a.proj.selected.id];var c=k.selected;if(v(),"geographic"!==a.proj.selected.id&&l.setResetButton(a.map.rotation),t(c),c.updateSize(),k.selected.previousCenter&&k.selected.setCenter(k.selected.previousCenter),b){var d=a.proj.selected.id,e=null;a.map.extent?e=a.map.extent:a.map.extent||"geographic"!==d||(e=a.map.getLeadingExtent()),e&&c.getView().fit(e,{constrainResolution:!1})}J(),r()},r=function(){var a=k.selected;a.small!==wv.util.browser.small&&(wv.util.browser.small?(a.removeControl(a.wv.scaleImperial),a.removeControl(a.wv.scaleMetric),$("#"+a.getTarget()+" .select-wrapper").hide()):(a.addControl(a.wv.scaleImperial),a.addControl(a.wv.scaleMetric),$("#"+a.getTarget()+" .select-wrapper").show()))},s=function(a){$("#"+a.getTarget()).hide()},t=function(a){$("#"+a.getTarget()).show()},u=function(a){var b=a.getLayers().getArray().slice(0);_.each(b,function(b){b.wv&&a.removeLayer(b)}),H(),i.clear()},v=function(b){b=b||k.selected,u(b);var c=a.layers.get({reverse:!0});_.each(c,function(a){F(a)?G():k.selected.addLayer(f(a))}),w()},w=function(){var b=k.selected.getLayers();b.forEach(function(b){if(b.wv){var c=a.layers.isRenderable(b.wv.id);b.setVisible(c)}});var c=a.layers.get();_.each(c,function(b){if(F(b)){var c=a.layers.isRenderable(b.id);c?G():H()}})},x=function(a,b){var c=D(a);c.setOpacity(b),w()},y=function(b){var c=_.findIndex(a.layers.get({reverse:!0}),{id:b.id});F(b)?G():k.selected.getLayers().insertAt(c,f(b)),w(),k.events.trigger("added-layer")},z=function(a){if(F(a))H();else{var b=D(a);k.selected.removeLayer(b)}w()},A=function(){v()},B=function(){var b=a.layers.get();_.each(b,function(a){if("daily"===a.period){var b=E(a);k.selected.getLayers().setAt(b,f(a))}}),w()},C=function(b){var c=wv.util.toISOStringDate(a.date.selected),d=a.proj.selected.id;i.removeWhere(function(a,e){return!(e.wvid!==b||e.wvproj!==d||e.wvdate===c||!e.lookupTable)}),v()};k.getCustomLayerTimeout=function(b){return a.palettes.isActive(b.id)?200:0};var D=function(a){var b=k.selected.getLayers().getArray(),c=_.find(b,{wv:{id:a.id}});return c},E=function(a){var b=k.selected.getLayers().getArray(),c=_.findIndex(b,{wv:{id:a.id}});return c},F=function(b){var c=a.proj.selected.id;return"graticule"===b.projections[c].type||"graticule"===b.type},G=function(){k.selected.graticule||(k.selected.graticule=new ol.Graticule({map:k.selected,strokeStyle:new ol.style.Stroke({color:"rgba(255, 255, 255, 0.5)",width:2,lineDash:[.5,4]})}))},H=function(){k.selected.graticule&&k.selected.graticule.setMap(null),k.selected.graticule=null},I=_.throttle(function(){k.events.trigger("extent")},500,{trailing:!0}),J=function(){var b=k.selected;a.map.update(b.getView().calculateExtent(b.getSize())),I()},K=function(b){var c,d,e,f,g,i,n,o;return c="wv-map-"+b.id,d=$("<div></div>").attr("id",c).attr("data-proj",b.id).addClass("wv-map").hide(),$(h).append(d),e=new ol.control.ScaleLine({className:"wv-map-scale-metric",units:"metric"}),f=new ol.control.ScaleLine({className:"wv-map-scale-imperial",units:"imperial"}),g=new ol.interaction.DragRotate({condition:ol.events.condition.altKeyOnly,duration:j}),n=new ol.interaction.PinchRotate({duration:j}),i=new ol.Map({view:new ol.View({maxResolution:b.resolutions[0],projection:ol.proj.get(b.crs),center:b.startCenter,rotation:"geographic"===b.id?0:a.map.rotation,zoom:b.startZoom,maxZoom:b.numZoomLevels,enableRotation:!0,extent:"geographic"===b.id?[-250,-90,250,90]:b.maxExtent}),target:c,renderer:["canvas"],logo:!1,controls:[e,f],interactions:[new ol.interaction.DoubleClickZoom({duration:j}),new ol.interaction.DragPan({kinetic:new ol.Kinetic(-.005,.05,100)}),new ol.interaction.PinchZoom({duration:j}),new ol.interaction.MouseWheelZoom({duration:j}),new ol.interaction.DragZoom({duration:j})],loadTilesWhileAnimating:!0}),i.wv={small:!1,scaleMetric:e,scaleImperial:f},L(i,b),N(i,b),"geographic"!==b.id?(l.init(i,b.id),i.addInteraction(g),i.addInteraction(n)):o=m.init(k,i,a.date.selected),i.getView().on("change:center",J),i.getView().on("change:resolution",J),i.getView().on("change:rotation",_.throttle(M,300)),i.on("pointerdrag",function(){k.mapIsbeingDragged=!0,k.events.trigger("drag")}),i.getView().on("propertychange",function(a){switch(a.key){case"resolution":k.mapIsbeingZoomed=!0}}),i.on("moveend",function(a){k.events.trigger("moveend"),setTimeout(function(){k.mapIsbeingDragged=!1,k.mapIsbeingZoomed=!1},200)}),i},L=function(a,b){var c=$("#"+a.getTarget()),d=$("<button></button>").addClass("wv-map-zoom-out").addClass("wv-map-zoom"),e=$("<i></i>").addClass("fa").addClass("fa-minus").addClass("fa-1x");d.append(e),c.append(d),d.button({text:!1}),d.click(O(a,-1));var f=$("<button></button>").addClass("wv-map-zoom-in").addClass("wv-map-zoom"),g=$("<i></i>").addClass("fa").addClass("fa-plus").addClass("fa-1x");f.append(g),c.append(f),f.button({text:!1}),f.click(O(a,1));var h=function(){var c=b.resolutions.length,e=a.getView().getZoom();0===e?(f.button("enable"),d.button("disable")):e===c?(f.button("disable"),d.button("enable")):(f.button("enable"),d.button("enable"))};a.getView().on("change:resolution",function(){h(),k.events.trigger("movestart")}),h()},M=function(){l.updateRotation(),J()},N=function(b,c){function d(c){var d,e,g;wv.util.browser.small||$(c.relatedTarget).hasClass("map-coord")||$(c.relatedTarget).hasClass("coord-btn")||(e=b.getEventPixel(c.originalEvent),d=b.getCoordinateFromPixel(e),ol.extent.containsCoordinate(p,d)||(g=!0),Math.abs(d[0])>180&&(d[0]>0?d[0]=d[0]-360:d[0]=d[0]+360),$("#"+f).show(),$("#"+f+" span.map-coord").each(function(){var a=$(this).attr("data-format");$(this).html(m(d,a,g))}),k.mapIsbeingDragged||wv.util.browser.small||a.naturalEvents.active||a.data.active||a.anim&&a.anim.rangeState.playing||o.newPoint(e,b))}var e,f,g,h,i,j,l,m,n,p;e=$("#"+b.getTarget()),b=b||k.selected,f="coords-"+c.id,p=c.maxExtent,g=$("<div></div>").attr("id",f).addClass("wv-coords-map wv-coords-map-btn"),m=function(b,d,e){var f,g;return g=a.proj.change?a.proj.change.crs:a.proj.selected.crs,e?g:(f=ol.proj.transform(b,c.crs,"EPSG:4326"),wv.util.formatCoordinate(f,d)+" "+g)},e.append(g),h=$("<span></span>").attr("id",f+"-latlon-dd").attr("data-format","latlon-dd").addClass("map-coord"),i=$("<span></span>").attr("id",f+"-latlon-dms").attr("data-format","latlon-dms").addClass("map-coord"),"latlon-dd"===wv.util.getCoordinateFormat()?($("div.map-coord").removeClass("latlon-selected"),h.addClass("latlon-selected")):($("div.map-coord").removeClass("latlon-selected"),i.addClass("latlon-selected")),j=$("<i></i>").addClass("coord-switch"),l=$("<div></div>").addClass("coord-btn"),l.append(j),g.append(h).append(i).append(l).click(function(){var a=$(this).find(".latlon-selected");"latlon-dd"===a.attr("data-format")?($("span.map-coord").removeClass("latlon-selected"),$('span.map-coord[data-format="latlon-dms"]').addClass("latlon-selected"),wv.util.setCoordinateFormat("latlon-dms")):($("span.map-coord").removeClass("latlon-selected"),$('span.map-coord[data-format="latlon-dd"]').addClass("latlon-selected"),wv.util.setCoordinateFormat("latlon-dd"))}),$(b.getViewport()).mouseover(function(a){$(a.relatedTarget).hasClass("map-coord")||$(a.relatedTarget).hasClass("coord-btn")||$("#"+f).show()}).mouseout(function(a){$(a.relatedTarget).hasClass("map-coord")||$(a.relatedTarget).hasClass("coord-btn")||($("#"+f).hide(),n.cancel(),o.clearAll())}).mousemove(n=_.throttle(d,300))},O=function(a,b){return function(){var c=a.getView(),d=c.getZoom();c.animate({zoom:d+b,duration:j})}};return p(),k};var wv=wv||{};wv.proj=function(a){return a.parse=function(a,b,c){a.switch&&(a.p=a.switch,delete a.switch);var d=a.p;d&&(c.projections[d]||(delete a.p,b.push({message:"Unsupported projection: "+d})))},a}(wv.proj||{});var wv=wv||{};wv.proj=wv.proj||{},wv.proj.change=wv.proj.change||function(a){var b=new Date(Date.UTC(2013,5,6)),c=new Date(Date.UTC(2011,10,1)),d="arcticProjectionChangeNotification",e=!1,f=0,g={};g.events=wv.util.events(),g.old=!1,g.crs=null,g.epsg=null;var h=function(){a.proj.register("EPSG:3995","+title=WGS 84 / Arctic Polar Stereographic +proj=stere lat_0=90 +lat_ts=71 +lon_0=0 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_def"),a.proj.events.on("select",j),a.date.events.on("select",j),i()},i=function(){var d=a.proj.selected;if(g.old=!1,"arctic"===d.id||"antarctic"===d.id){f+=1;var e=a.date.selected.getTime(),h=b.getTime(),i=c.getTime();g.old=e<h&&e>i}"arctic"===d.id&&g.old?(g.crs="EPSG:3995",g.epsg=3995):(g.crs=d.crs,g.epsg=d.epsg)},j=function(){var a=g.old;i(),g.events.trigger("select",g),f>1&&a!==g.old&&k()},k=function(){wv.util.browser.localStorage&&"true"!==wv.util.localStorage(d)&&(e||l())},l=function(){e=!0;var a=["On "+wv.util.toISOStringDate(b)+" the polar projections for some layers changed as follows:","<br/><br/>","The <b>Arctic projection</b> changed from Arctic Polar ",'Stereographic (EPSG:3995, "Greenwich down") to NSIDC Polar ','Stereographic North (EPSG:3413, "Greenland down"). ',"Coastlines and Graticule in the older projection ",'can be found in the Add Layer tab by searching for "EPSG:3995". ',"<br/><br/>The <b>Antarctic projection</b> changed from being projected onto ","a sphere with radius of 6371007.181 meters to being projected ","onto the WGS84 ellipsoid. The projection is now the correct ","Antarctic Polar Stereographic (EPSG:3031). This change results ","in a shift of the imagery that ranges up to tens of kilometers, ","depending on the location.","<br/><br/>","Imagery before this transition date will eventually be ","reprocessed to be consistent with the imagery after it. In ",'addition, the "Population Density" layer can no longer be ',"displayed properly in the older projection.","<br/><br/>","Thanks for your patience as we improve and expand our ","imagery archive.","<br/><br/>","<input id='arcticChangeNoticeDontShowAgain' value='false' ","type='checkbox'>Do not show again"].join("");wv.ui.notify(a,"Notice",400);var c=$("#arcticChangeNoticeDontShowAgain");c.on("click",function(){c.is(":checked")&&wv.util.localStorage(d,"true")})};return h(),g};var wv=wv||{};wv.proj=wv.proj||{},wv.proj.model=wv.proj.model||function(a){var b={};b.selected=null,b.events=wv.util.events();var c=function(){b.selectDefault(),_.each(a.projections,function(a){a.crs&&a.proj4&&(b.register(a.crs,a.proj4),ol.proj.get(a.crs).setExtent(a.maxExtent))})};return b.select=function(c){var d=a.projections[c];if(!d)throw new Error("Invalid projection: "+c);var e=!1;return b.selected&&b.selected.id===c||(b.selected=d,b.events.trigger("select",d)),e},b.selectDefault=function(){a.defaults&&a.defaults.projection&&b.select(a.defaults.projection)},b.save=function(a){a.p=b.selected.id},b.load=function(a){var c=a.p;c&&b.select(c)},b.register=function(a,b){b&&window.proj4&&proj4.defs(a,b)},c(),b};var wv=wv||{};wv.proj=wv.proj||{},wv.proj.ui=wv.proj.ui||function(a,b){var c,d,e,f=(a.proj,{}),g="#wv-proj-button",h=function(){b.ui&&b.ui.projections&&i()},i=function(){c=$("<input></input>").attr("type","checkbox").attr("id","wv-proj-button-check"),d=$("<label></label>").attr("for","wv-proj-button-check").attr("title","Switch projection");var a=$("<i></i>").addClass("fa").addClass("fa-globe").addClass("fa-2x");d.append(a),$(g).append(d),$(g).append(c),c.button({text:!1}),c.click(function(a){a.stopPropagation(),wv.ui.close();var b=$("#wv-proj-button-check").prop("checked");b&&j()})},j=function(){var f=wv.ui.getMenu().attr("id","wv-proj-menu");e=$("<ul></ul>"),_.each(b.ui.projections,function(b){var d=$("<li data-proj='"+b.id+"'><a data-proj='"+b.id+"'><i class='ui-icon icon-large "+b.style+"'></i>"+b.name+"</a></li>");e.append(d),d.click(function(){a.proj.select(b.id),$("#wv-proj-button-check").prop("checked",!1),c.button("refresh")})}),f.append(e),e.menu(),wv.ui.positionMenu(e,{my:"left top",at:"left bottom+5",of:d}),e.hide(),e.show("slide",{direction:"up"}),$("#wv-proj-menu li").removeClass("wv-menu-item-selected"),$("#wv-proj-menu li[data-proj='"+a.proj.selected.id+"']").addClass("wv-menu-item-selected");var g=function(a){c.parent().has(a.target).length>0||(e.hide(),$("#wv-proj-button-check").prop("checked",!1),$("#wv-proj-button label").removeClass("ui-state-hover"),c.button("refresh"),$("body").off("click",g).off("touchstart",g))};e.on("touchstart",function(a){a.stopPropagation()}),$("body").one("click",g).one("touchstart",g)};return h(),f};var wv=wv||{};wv.anim=function(a){return a.parse=function(a,b){if(a.a){var c=a.a,d={attributes:[]},e=c.match(/[^\(,]+/)[0];if("on"!==e)return void(a.a=void 0);c=c.match(/\(.*\)/)[0].replace(/[\(\)]/g,"");var f=c.split(",");_.each(f,function(a){var b=a.split("=");d.attributes.push({id:b[0],value:b[1]})}),a.a=d}},a}(wv.anim||{});var wv=wv||{};wv.anim=wv.anim||{},wv.anim.gif=wv.anim.gif||function(a,b,c){var d,e,f={},g=($("#wv-map"),null),h=null,i=null,j=a.anim,k=!0,l=!1,m="One or more layers on the map have been modified (changed palette, thresholds, etc.). These modifications cannot be used to take a snapshot. Would you like to temporarily revert to the original layer(s)?",n="Image may not be downloaded when rotated. Would you like to reset rotation?";f.init=function(){a.anim.events.on("gif-click",F)},f.createGIF=function(){var a,b,c,f=j.rangeState,g=f.speed,i=f.startDate,k=f.endDate;e=wv.ui.indicator.loading(),c=function(b){var c=function(){d=$("<progress />").attr("class","wv-gif-progress"),wv.ui.getDialog().append(d).dialog({title:"Collecting Images...",width:300,height:100}),d.attr("value",0)},f=function(a){l||(c(),l=!0,wv.ui.indicator.hide(e)),d.parent().dialog("option","title","Creating GIF..."),d.attr("value",a)};a=u(i,k,d),a&&gifshot.createGIF({gifWidth:h.w,gifHeight:h.h,images:a,stamp:b,textAlign:"right",textBaseline:"top",fontColor:"#fff",fontWeight:"lighter",fontFamily:"Helvetica Neue",fontSize:"16px",interval:1/g,progressCallback:f,stroke:{color:"#000",pixels:1.7},pause:1},x)},b=new Image,b.onload=function(){c(b)},b.onerror=function(){c(null)},b.src="brand/images/wv-icon-w-shadow.png"};var o=function(b){var d,e,f="geographic"===a.proj.selected.id,g=[40,20,4,2,1];if(e=f?g[Math.floor(c.map.selected.getView().getZoom()/2)]:g[Math.floor((c.map.selected.getView().getZoom()+2)/2)],0===b)return e;switch(e){case 1:d="250m";break;case 2:d="500m";break;case 4:d="1km";break;case 20:d="5km";break;default:d="10km"}return d};f.getGif=function(){var b;return b=a.layers.get({renderable:!0}),a.palettes.inUse()?void wv.ui.ask({header:"Notice",message:m,onOk:function(){previousPalettes=a.palettes.active,a.palettes.clear(),f.getGif()}}):_.find(b,{id:"Graticule"})&&"geographic"===a.proj.selected.id?void wv.ui.ask({header:"Notice",message:GRATICULE_WARNING,onOk:function(){a.layers.setVisibility("Graticule",!1),f.getGif(startDate,endDate,delta,interval)}}):0!==c.map.selected.getView().getRotation()?void wv.ui.ask({header:"Reset rotation?",message:n,onOk:function(){w(),F()}}):(WVC.GA.event("Animation","Click","Create GIF"),void f.createGIF())};var p=function(a,b){var c=[];return _.each(a,function(a){a.projections[b].layer?c.push(a.projections[b].layer):c.push(a.id)}),c},q=function(b){var c=[],d=a.layers.get({reverse:!0,renderable:!0});return _.each(d,function(a){a.endDate&&b>new Date(a.endDate)||(a.visible&&new Date(a.startDate)<b?c.push(a):a.startDate||c.push(a))}),c},r=function(a){var b=[];return _.each(a,function(a){b.push(_.isUndefined(a.opacity)?1:a.opacity)}),b},s=function(){return[c.map.selected.getCoordinateFromPixel([Math.floor(h.x),Math.floor(h.y2)]),c.map.selected.getCoordinateFromPixel([Math.floor(h.x2),Math.floor(h.y)])]},t=function(a,b){var c="geographic"===b?.002197:256,d=o(0);return[Math.round(Math.abs(a[1][0]-a[0][0])/c/Number(d)),Math.round(Math.abs(a[1][1]-a[0][1])/c/Number(d))]},u=function(d,f){var g,h,i,j,l,m,n=[],o=new Date(d),u=new Date(f),w=o,x=0,y=s(),z=a.proj.selected.id,A=t(y,z),B=a.proj.change?a.proj.change.epsg:a.proj.selected.epsg,C=q();for(b.features.imageDownload?(h=b.features.imageDownload.host,i=b.parameters.imagegen||b.features.imageDownload.path):(h="https://gibs.earthdata.nasa.gov",i="image-download");w<=u;)if(x++,l=wv.util.toISOStringDate(w),C=q(w),layers=p(C,z),m=r(C),g=wv.util.format(h+"/"+i+"?{1}&extent={2}&epsg={3}&layers={4}&opacities={5}&worldfile=false&format=image/jpeg&width={6}&height={7}","TIME={1}",y[0][0]+","+y[0][1]+","+y[1][0]+","+y[1][1],B,layers.join(","),m.join(","),A[0],A[1]),j=wv.util.format(g,l),k?n.push({src:j,text:l}):n.push(j),w=wv.util.dateAdd(w,c.anim.ui.getInterval(),1),x>40)return v(),wv.ui.indicator.hide(e),!1;return n},v=function(){var a="<h3 class='wv-data-unavailable-header'>GIF Not Available</h3>",b="Too many frames were selected. Please request less than 40 frames if you would like to generate a GIF";callback=function(){$("#timeline-footer").toggleClass("wv-anim-active")},wv.ui.notify(a+b,"Notice",600,callback)},w=function(){c.map.selected.getView().animate({duration:400,rotation:0})},x=function(a){if(a.error===!1){d.remove(),l=!1;for(var b=document.createElement("img"),f=atob(a.image.substring(22)),g=[],i=0;i<f.length;i+=512){for(var k=f.slice(i,i+512),m=new Array(k.length),n=0;n<k.length;n++)m[n]=k.charCodeAt(n);var o=new Uint8Array(m);g.push(o)}var p=new Blob(g,{type:"image/gif"}),q=URL.createObjectURL(p);b.src=q;var r=wv.util.format("nasa-worldview-{1}-to-{2}.gif",j.rangeState.startDate,j.rangeState.endDate),s=(p.size/1024).toFixed(),t=$("<a><span class=ui-button-text>Download</span></a>").attr("type","button").attr("role","button").attr("download",r).attr("href",q).attr("class","ui-button ui-widget ui-state-default ui-button-text-only").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}).click(function(){WVC.GA.event("Animation","Download","GIF",s)}),u="<div class='gif-results-dialog' style='height: "+h.h+"px; min-height: 210px;' ><div><div><b>Size: </b></div><div>"+s+" KB</div></div><div><div><b>Speed: </b></div><div>"+j.rangeState.speed+" fps</div></div><div><div><b>Date Range: </b></div><div>"+j.rangeState.startDate+"</div><div> - </div><div>"+j.rangeState.endDate+"</div></div><div><div><b>Increments: </b></div><div>"+c.anim.widget.getIncrements()+"</div></div></div>",v=$("<div></div>");v.addClass("gif-results-dialog-case"),v.css("padding","10px 0"),v.append(b),v.append(u);var w=1*h.w/window.innerWidth,x=50*h.h/window.innerHeight,y="center-"+w.toFixed()+"% center-"+x.toFixed()+"%",z=wv.ui.getDialog().append(v).append(t);z.dialog({dialogClass:"wv-panel wv-gif-results",title:"Your GIF",width:h.w+198,resizable:!1,close:function(){h=null,z.find("img").remove(),$("#timeline-footer").toggleClass("wv-anim-active")},position:{my:"center center",at:y,of:window}})}else{var A="<h3 class='wv-data-unavailable-header'>GIF Not Available</h3>",B="One or more of the frames requested was unable to be processed";wv.ui.indicator.hide(e),callback=function(){$("#timeline-footer").toggleClass("wv-anim-active")},wv.ui.notify(A+B,"Notice",600,callback)}},y=function(b){var d=c.map.selected.getCoordinateFromPixel([Math.floor(b.x),Math.floor(b.y2)]),e=c.map.selected.getCoordinateFromPixel([Math.floor(b.x2),Math.floor(b.y)]),f="geographic"===a.proj.selected.id?.002197:256,g=o(0),h=Math.round(Math.abs(e[0]-d[0])/f/Number(g)),i=Math.round(Math.abs(e[1]-d[1])/f/Number(g));return(h*i*24/8388608).toFixed(2)},z=function(){$("#wv-map").insertAfter("#productsHolder"),h=void 0,g.destroy(),"geographic"===a.proj.selected.id&&c.map.events.trigger("selectiondone")};f.getSelectorDialog=function(b){var d,e,h,i,k=$("<div class='gif-dialog'></div>"),l="<div class='content'>Create an animation from <b>"+j.rangeState.startDate+"</b> to <b>"+j.rangeState.endDate+"</b> at a rate of "+j.rangeState.speed+" frames per second</div>";return e=$("<a><span class=ui-button-text>Create GIF</span></a>").attr("type","button").attr("role","button").attr("class","ui-button ui-widget ui-state-default ui-button-text-only").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}),i=$("<div class='wv-checkbox-date'><label for='checkbox-date'><input type='checkbox' title='Check box to remove dates from Animating GIF' name='checkbox-date' class='checkbox-date-input' id='checkbox-date-input'>Include Date Stamps</label></div>"),h=$("<div></div>"),h.append(e).append(i),k.html(l).append(h),A(i),e.on("click",f.getGif),d=wv.ui.getDialog(),d.html(k),d.css({paddingBottom:"10px"}),d.dialog({dialogClass:"wv-panel wv-image",title:"Generate GIF",height:"auto",width:b,minHeight:40,minWidth:287,resizable:!1,show:{effect:"slide",direction:"down"},position:{my:"left top",at:"left bottom+10",of:$(".jcrop-tracker")},close:function(b){C(i),$("#wv-map").insertAfter("#productsHolder"),g.destroy(),"geographic"===a.proj.selected.id&&c.map.events.trigger("selectiondone")}}),d};var A=function(a){a.iCheck({checkboxClass:"icheckbox_square-red"}),a.iCheck("check"),k=!0,a.on("ifChecked",B),a.on("ifUnchecked",B)},B=function(a){k="ifUnchecked"!==a.type},C=function(a){a.off("ifChecked",B),a.off("ifUnchecked",B)},D=function(a,b){var c;b<287&&(b=287),a&&(c=a.parent(),c.width(b),c.position({my:"left top",at:"left bottom+10",of:$(".jcrop-tracker")}))},E=function(a,b){var c=Math.abs(b/4);a&&(c<=30&&(c=30),a.css("font-size",c))},F=function(){var b,d,e;i=null===i||void 0===i?[$(window).width()/2-100,$(window).height()/2-100,$(window).width()/2+100,$(window).height()/2+100]:[i.x,i.y,i.x2,i.y2],"geographic"===a.proj.selected.id&&c.map.events.trigger("selecting"),b=i[0]-i[2],$("#wv-map").Jcrop({bgColor:"black",bgOpacity:.3,fullScreen:!0,setSelect:i,onSelect:function(a){h=a,$("#wv-gif-width").html(a.w),$("#wv-gif-height").html(a.h)},onChange:function(a){h=a,0!==a.h&&0!==a.w&&(i=a);var b=y(a);$("#wv-gif-width").html(a.w),$("#wv-gif-height").html(a.h),$("#wv-gif-size").html(b+" MB"),b>250?$("#wv-gif-button").button("disable"):$("#wv-gif-button").button("enable"),D(e,a.w),E(d,a.w)},onRelease:function(a){z(),$("#timeline-footer").toggleClass("wv-anim-active"),e&&wv.ui.close()}},function(){var a;d="<div class='wv-dl-gif-bt-case'><i class='fa fa-download'></div>",g=this,$("#timeline-footer").toggleClass("wv-anim-active"),e=f.getSelectorDialog(),a=this.ui.selection.find(".jcrop-tracker"),a.append(d),d=$(".wv-dl-gif-bt-case i"),E(d,b),d.on("click",f.getGif)})};return f.init(),f};var wv=wv||{};wv.anim=wv.anim||{},wv.anim.model=wv.anim.model||function(a,b){var c={};return c.delay=500,c.events=wv.util.events(),c.animationState={active:!1,speed:10,loop:!1,reverse:!1},c.load=function(a,b){c.rangeState=c.rangeState||{},a.ab&&(c.rangeState.state=a.ab),a.as&&a.ae&&10==a.ae.length&&10==a.as.length&&(c.rangeState.startDate=a.as,c.rangeState.endDate=a.ae),a.av&&(c.rangeState.speed=Number(a.av)),a.al&&(c.rangeState.loop=Boolean(a.al))},c.toggleActive=function(){"off"===c.rangeState.state?c.rangeState.state="on":c.rangeState.state="off"},c.add=function(a){},c.save=function(a){rangeState=c.rangeState,rangeState.state&&(a.ab=rangeState.state,a.as=rangeState.startDate,a.ae=rangeState.endDate,a.av=String(rangeState.speed),a.al=String(rangeState.loop))},c};var wv=wv||{};wv.anim=wv.anim||{},wv.anim.rangeselect=wv.anim.rangeselect||function(a,b,c){var d,e={},f=c.timeline,g=(c.anim.options,React.createFactory(WVC.RangeSelector)),h=$("#wv-rangeselector-case")[0],i=$("#timeline-footer"),j=$("#timeline-header"),k=$("#timeline");return c.anim.rangeOptions=c.anim.rangeOptions||{},e.init=function(){$("#animate-button");e.setDefaults(),e.render(),a.date.events.on("timeline-change",e.update),d.events.on("change",e.update)},e.setDefaults=function(){var b;d=a.anim||{},d.rangeState=d.rangeState||{},b=d.rangeState,b.state=b.state||null,b.loop=b.loop||!1,b.speed=b.speed||3},e.render=function(){var a,b,c=d3.select("#guitarpick"),f=c.node().getBoundingClientRect().width,i=($(".end-tick").height(),d3.transform(c.attr("transform")).translate[0]-f/2);d.rangeState.startDate?(b=e.getLocationFromStringDate(d.rangeState.startDate),endLocation=e.getLocationFromStringDate(d.rangeState.endDate)):(b=i-100,endLocation=i,e.updateRange(b,endLocation)),a={startLocation:b,endLocation:endLocation,max:e.getMaxWidth(),startColor:"#40a9db",endColor:"#295f92",startTriangleColor:"#fff",endTriangleColor:"#4b7aab",rangeColor:"#45bdff",rangeOpacity:.3,pinWidth:5,height:45,onDrag:e.updateRange,onRangeClick:e.onRangeClick},e.reactComponent=ReactDOM.render(g(a),h)},e.getHeaderOffset=function(){return j.width()+Number(k.css("left").replace("px",""))+Number(i.css("margin-left").replace("px",""))},e.getLocationFromStringDate=function(a){return f.x(new Date(a))},e.update=function(){var a=e.updateOptions();e.reactComponent.setState(a)},e.getMaxWidth=function(){var a=i.width(),b=f.x(f.data.end());return a>b?b:a},e.updateOptions=function(){var a=d.rangeState,b={};return b.startLocation=e.getLocationFromStringDate(a.startDate),b.endLocation=e.getLocationFromStringDate(a.endDate),b.max=e.getMaxWidth(),b},e.onRangeClick=function(b){var c=e.getHeaderOffset(),d=b.pageX-c,g=f.x.invert(d);a.date.select(g)},e.updateRange=function(a,b){var c=f.x.invert(a),e=f.x.invert(b),g=d.rangeState;g.startDate=wv.util.toISOStringDate(c)||0,g.endDate=wv.util.toISOStringDate(e),d.rangeState.playing=!1,d.events.trigger("change"),d.events.trigger("datechange")},e.init(),e};var wv=wv||{};wv.anim=wv.anim||{},wv.anim.widget=wv.anim.widget||function(a,b,c){var d,e,f,g=["yearly","monthly","daily"],h={},i=c.timeline,j=a.anim,k=React.createFactory(WVC.AnimationWidget);return h.init=function(){var b;b=h.initWidget(),e=$("#animate-button"),h.reactComponent=ReactDOM.render(b,$("#wv-animation-widet-case")[0]),d=$("#timeline-footer"),e.on("click",function(){WVC.GA.event("Animation","Click","Animation Icon"),h.toggleAnimationWidget()}),"on"===j.rangeState.state&&d.toggleClass("wv-anim-active"),$(".wv-date-selector-widget input").on("keydown",function(a){a.stopPropagation()}),j.events.trigger("change"),j.events.on("change",h.update),a.date.events.on("timeline-change",h.update),a.data?(f=a.data,f.events.on("activate",function(){h.toggleAnimationWidget(),h.onDataActivate()}),f.events.on("deactivate",function(){h.onDataDeactivate()})):(f={},f.active=!1),$(".wv-date-selector-widget input").keydown(function(a){13!=a.keyCode&&9!=a.keyCode||a.preventDefault()}),$(window).keypress(function(a){32!=a.keyCode&&32!=a.charCode||$("#layer-modal").dialog("isOpen")||(a.preventDefault(),h.onSpaceBar())})},h.initWidget=function(){var b=j.rangeState;return k({onPushPlay:h.onPressPlay,onPushLoop:h.onPressLoop,onPushPause:h.onPressPause,onPushGIF:h.onPressGIF,looping:j.rangeState.loop,increment:h.getIncrements(),incrementArray:_.without(g,h.getIncrements()),onDateChange:h.dateUpdate,sliderLabel:"Frames Per Second",sliderSpeed:b.speed,onZoomSelect:h.onZoomSelect,onSlide:h.onRateChange,startDate:new Date(b.startDate),endDate:new Date(b.endDate),minDate:a.date.minDate(),maxDate:a.date.maxDate(),onClose:h.toggleAnimationWidget})},h.onSpaceBar=function(){if("on"===j.rangeState.state)return j.rangeState.playing?void h.onPressPause():(h.onPressPlay(),void h.update())},h.update=function(){var a=j.rangeState;h.reactComponent.setState({startDate:new Date(a.startDate),endDate:new Date(a.endDate),playing:a.playing,increment:h.getIncrements(),incrementArray:_.without(g,h.getIncrements())})},h.getIncrements=function(){return g[i.config.currentZoom-1]},h.onZoomSelect=function(a){var b=_.indexOf(g,a);return i.config.zoom(b+1)},h.dateUpdate=function(a,b){j.rangeState.startDate=wv.util.toISOStringDate(a)||0,j.rangeState.endDate=wv.util.toISOStringDate(b),j.rangeState.playing=!1,j.events.trigger("change"),j.events.trigger("datechange")},h.toggleAnimationWidget=function(){if(null===j.rangeState.state&&(j.rangeState.state="off",h.makeDateGuess()),d.is(":hidden")&&!f.active){if(c.timeline.toggle(),"on"===j.rangeState.state)return;setTimeout(function(){j.events.trigger("change"),j.events.trigger("toggle-widget")},500)}if("off"!==j.rangeState.state||!f.active)return j.toggleActive(),j.events.trigger("change"),j.events.trigger("toggle-widget"),d.toggleClass("wv-anim-active")},h.makeDateGuess=function(){var b=new Date(a.date.selected),d=c.anim.ui.getInterval(),e=wv.util.dateAdd(b,d,7),f=new Date;e>f?(j.rangeState.endDate=wv.util.toISOStringDate(b),j.rangeState.startDate=wv.util.toISOStringDate(wv.util.dateAdd(b,d,-7))):(j.rangeState.startDate=wv.util.toISOStringDate(b),j.rangeState.endDate=wv.util.toISOStringDate(wv.util.dateAdd(b,d,7)))},h.onPressPlay=function(){j.rangeState.playing=!0,j.events.trigger("play")},h.onRateChange=function(a){j.rangeState.speed=a,j.events.trigger("change")},h.onPressPause=function(){var a=j.rangeState;a.playing=!1,j.events.trigger("change")},h.onDataActivate=function(){e.addClass("wv-disabled-button"),e.prop("title","Animation feature is deactivated when data download feature is active")},h.onDataDeactivate=function(){e.removeClass("wv-disabled-button"),e.prop("title","Setup animation")},h.onPressLoop=function(a){var b=j.rangeState;b.loop=a,j.events.trigger("change")},h.onPressGIF=function(){j.events.trigger("gif-click")},h.init(),h};var wv=wv||{};wv.anim=wv.anim||{},wv.anim.ui=wv.anim.ui||function(a,b){var c={};c.events=wv.util.events();var d,e,f,g,h,i=a.date,j=a.anim,k=(b.map.selected,["year","month","day"]),l=new Queue(5,1/0),m={};return c.init=function(){c.refreshState(),j.events.on("play",c.onPushedPlay),j.events.on("gif-click",c.refreshState),j.events.on("datechange",c.refreshState),j.events.on("toggle-widget",c.refreshState),a.proj&&a.proj.events.on("select",c.refreshState),a.palettes&&a.palettes.events.on("update",c.refreshState),a.data&&(a.data.events.on("activate",c.refreshState),a.date.events.on("zoom-change",c.refreshState),a.date.events.on("select",c.dateChange)),
b.map&&b.map.events.on("added-layer",c.refreshState)},c.dateChange=function(){c.state.playing||c.refreshState()},c.refreshState=function(){e=[],m={},g={},f={},d=10,c.state={playing:!1,playIndex:c.getStartDate(),supportingCustomLayers:c.hasCustomLayers()},j.rangeState.playing=!1,j.events.trigger("change"),wv.ui.indicator.hide(h),wv.ui.indicator._hide(h)},c.getStartDate=function(){var a,b,d,e;return a=j.rangeState,b=wv.util.parseDateUTC(a.endDate),d=wv.util.parseDateUTC(a.startDate),e=i.selected,e>d&&c.nextDate(e)<b?wv.util.toISOStringDate(c.nextDate(e)):wv.util.toISOStringDate(d)},c.onPushedPlay=function(){c.checkQueue(d,c.state.playIndex),c.checkShouldPlay()},c.getInterval=function(){return k[b.timeline.config.currentZoom-1]},c.nextDate=function(a){return wv.util.dateAdd(a,c.getInterval(),1)},c.addDate=function(a){c.addToInQueue(a),l.add(function(){return b.map.promiseDay(a)}).then(function(a){c.addDateToCache(a),c.shiftCache(),c.checkQueue(d,c.state.playIndex),c.checkShouldPlay()})},c.addToInQueue=function(a){var b=wv.util.toISOStringDate(a);f[b]=a,e.push(b)},c.addDateToCache=function(a){var b=wv.util.toISOStringDate(a);m[b]=a,delete f[b]},c.shiftCache=function(){var a;m[e[0]]&&wv.util.objectLength(m)>d+d/2+1&&g[e[0]]&&!c.isInToPlayGroup(e[0])&&(a=e.shift(),delete m[a],delete g[a])},c.isInToPlayGroup=function(a){for(var b=j.rangeState.loop,e=0,f=new Date(c.state.playIndex),g=new Date(j.rangeState.startDate),h=new Date(j.rangeState.endDate),i=new Date(a);e<d;){if(c.nextDate(f)>h){if(!b)return!1;f=c.setNewDate(f,g)}else f=c.nextDate(f);if(f.valueOf()==i.valueOf())return!0;e++}return!1},c.clearCache=function(){m={},e=[]},c.checkQueue=function(a,b){var d,g,h=wv.util.parseDateUTC(j.rangeState.startDate),i=wv.util.parseDateUTC(j.rangeState.endDate);j.rangeState.loop;return j.rangeState.playing?(d=wv.util.parseDateUTC(b),g=c.getLastBufferDateStr(d,h,i),void(e[0]||f[b]?m[g]||f[g]||c.state.supportingCustomLayers?c.state.supportingCustomLayers&&e[0]&&c.customQueuer(d,h,i):c.addItemToQueue(d,h,i):c.initialPreload(d,h,i,g))):c.refreshState()},c.hasCustomLayers=function(){for(var b,c=a.layers.get(),d=0;d<c.length;d++)if(b=c[d],!_.isEmpty(a.palettes.isActive(b.id))&&b.visible)return!0;return!1},c.customQueuer=function(a,b,e){var g,h=c.nextDate(a);h>e&&(h=c.setNewDate(h,b)),g=wv.util.toISOStringDate(h),m[g]||f[g]||c.state.playing||(c.clearCache(),c.checkQueue(d,c.state.playIndex))},c.initialPreload=function(a,b,e,f){var g=a;if(d=c.getQueueLength(b,e),d<=1)return i.select(b),j.rangeState.playing=!1,void setTimeout(function(){c.refreshState()},100);for(var k=0;k<d;k++){if(c.addDate(g),g=c.getNextBufferDate(g,b,e),wv.util.toISOStringDate(g)===f)return c.addDate(g),void(h=wv.ui.indicator.loading());if(wv.util.toISOStringDate(g)===wv.util.toISOStringDate(a))return d=k,void(h=wv.ui.indicator.loading())}h=wv.ui.indicator.loading()},c.getQueueLength=function(a,b){for(var e=a,f=0;f<d;)if(f++,e=c.nextDate(e),e>b)return f;return f},c.addItemToQueue=function(a,b,e){var g=c.getNextBufferDate(a,b,e),h=wv.util.toISOStringDate(g);!f[h]&&!m[h]&&g<=e&&g>=b&&(c.addDate(g),c.checkQueue(d,c.state.playIndex))},c.getNextBufferDate=function(a,b,d){var f=wv.util.parseDateUTC(e[e.length-1]),g=c.nextDate(f);return f>=d||c.nextDate(f)>d?c.setNewDate(g,b):c.nextDate(f)},c.getLastBufferDateStr=function(a,b,e){for(var f=a,g=j.rangeState.loop,h=1;h<d;){if(c.nextDate(f)>e){if(!g)return wv.util.toISOStringDate(f);f=c.setNewDate(f,b)}else f=c.nextDate(f);h++}return wv.util.toISOStringDate(f)},c.checkShouldLoop=function(a){j.rangeState.loop?(c.shiftCache(),c.state.playIndex=wv.util.toISOStringDate(c.setNewDate(a,new Date(j.rangeState.startDate))),setTimeout(function(){c.checkShouldPlay(),c.checkQueue(d,c.state.playIndex)},1e3)):c.refreshState()},c.checkShouldPlay=function(){var a=wv.util.parseDateUTC(c.state.playIndex),b=(1e3/j.rangeState.speed,wv.util.parseDateUTC(j.rangeState.endDate)),d=wv.util.parseDateUTC(j.rangeState.startDate);return!(c.state.playing||!j.rangeState.playing)&&(m[c.getLastBufferDateStr(a,d,b)]?void c.play(c.state.playIndex):c.state.supportingCustomLayers&&m[c.state.playIndex]&&_.isEmpty(f)?void c.play(c.state.playIndex):void c.shiftCache())},c.play=function(a){c.state.playing=!0,wv.ui.indicator.hide(h),wv.ui.indicator._hide(h),c.animate(a)},c.setNewDate=function(a,b){return b},c.animate=function(a){var b,e,f=a,k=wv.util.parseDateUTC(j.rangeState.endDate),l=function(){return c.shiftCache(),c.checkQueue(d,f),i.select(wv.util.parseDateUTC(f)),g[f]=wv.util.parseDateUTC(f),c.state.playIndex=f,f=wv.util.toISOStringDate(c.nextDate(new Date(f))),e=new Date(f),e>k?(clearInterval(b),c.state.playing=!1,void c.checkShouldLoop(e)):j.rangeState.playing&&m[f]?(c.checkQueue(d,c.state.playIndex),void(b=setTimeout(l,1e3/j.rangeState.speed))):(clearInterval(b),c.state.playing=!1,void(!m[f]&&j.rangeState.playing?(h=wv.ui.indicator.loading(),c.shiftCache(),c.checkQueue(d,c.state.playIndex)):c.refreshState()))};b=setTimeout(l,j.rangeState.speed)},c.init(),c};var wv=wv||{};wv.date=function(a){return a.parse=function(a,b){if(a.time&&(a.t=a.time,delete a.time),a.t)try{a.t=wv.util.parseDateUTC(a.t)}catch(c){delete a.t,b.push({message:"Invalid date: "+a.t,cause:c})}if(a.now)try{a.now=wv.util.parseDateUTC(a.now),wv.util.now=function(){return new Date(a.now.getTime())},wv.util.warn("Overriding now: "+a.now.toISOString())}catch(c){delete a.now,b.push({message:"Invalid now: "+a.now,cause:c})}},a}(wv.date||{});var wv=wv||{};wv.date=wv.date||{},wv.date.model=wv.date.model||function(a,b){b=b||{};var c={};c.events=wv.util.events(),c.selected=null,c.monthAbbr=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];var d=function(){var a=b.initial||wv.util.today();c.select(a)};return c.string=function(){return wv.util.toISOStringDate(c.selected)},c.select=function(a){a=c.clamp(wv.util.clearTimeUTC(a));var b=!1;return c.selected&&a.getTime()===c.selected.getTime()||(c.selected=a,c.events.trigger("select",a),b=!0),b},c.add=function(a,b){c.select(wv.util.dateAdd(c.selected,a,b))},c.clamp=function(b){return b>wv.util.today()&&(b=wv.util.today()),a.startDate&&(startDate=wv.util.parseDateUTC(a.startDate),b<startDate&&(b=startDate)),b},c.isValid=function(b){return!(b>wv.util.today())&&!(a.startDate&&(startDate=wv.util.parseDateUTC(a.startDate),b<startDate))},c.minDate=function(){return a.startDate?wv.util.parseDateUTC(a.startDate):wv.util.minDate()},c.maxDate=function(){return wv.util.today()},c.save=function(a){a.t=c.selected.toISOString().split("T")[0],c.selectedZoom&&(a.z=c.selectedZoom.toString())},c.load=function(a){a.t&&c.select(a.t),a.z&&(c.selectedZoom=Number(a.z))},d(),c};var wv=wv||{};wv.date=wv.date||{},wv.date.label=wv.date.label||function(a){var b="timedsdateHolder",c=$("#"+b),d=a.date,e={},f=function(){d.events.on("select",g),g()},g=function(){c.html(wv.util.toISOStringDate(d.selected))};return f(),e};var wv=wv||{};wv.date=wv.date||{},wv.date.timeline=wv.date.timeline||function(a,b,c){var d={},e=a.date;d.enabled=!1,d.margin={top:0,right:30,bottom:20,left:30},d.getPadding=function(){return d.padding=d.width/4,d.padding},d.getWidth=function(){return d.width=$(window).outerWidth(!0)-$("#timeline-header").outerWidth(!0)-$("#timeline-zoom").outerWidth(!0)-$("#timeline-hide").outerWidth(!0)-d.margin.left-d.margin.right-22,d.width},d.height=65-d.margin.top-d.margin.bottom,d.isCropped=!0,d.toggle=function(a){var b=$("#timeline-footer"),c=$("#timeline-zoom"),e=d.boundary,f=d3.select("#guitarpick");if(b.is(":hidden")){var g=function(){c.show(),$("#timeline").css("right","10px"),e.attr("style",'clip-path:url("#timeline-boundary")'),f.attr("style","display:block;clip-path:url(#guitarpick-boundary);")};a?(b.show(),g()):b.show("slow",g)}else e.attr("style","clip-path:none"),f.attr("style","display:none;clip-path:none"),c.hide(),b.hide("slow"),$("#timeline").css("right","auto")},d.expand=function(a){a=a||!1;var b=$("#timeline-footer, #timeline-zoom");b.is(":hidden")&&d.toggle(a)},d.expandNow=function(){d.expand(!0)},d.collapse=function(a){var b=$("#timeline-footer, #timeline-zoom");b.is(":hidden")||d.toggle(a)},d.collapseNow=function(){d.collapse(!0)},d.resize=function(){var a=wv.util.browser.small||wv.util.browser.constrained;d.enabled&&a?(d.enabled=!1,$("#timeline").hide()):d.enabled||a||(d.enabled=!0,$("#timeline").show()),d.enabled&&(d.getWidth(),d.svg.attr("width",d.width),d3.select("#timeline-boundary rect").attr("width",d.width),d3.select("#guitarpick-boundary rect").attr("width",d.width+d.margin.left+d.margin.right),d.axis.select("line:first-child").attr("x2",d.width))},d.setClip=function(){d3.select("#timeline-footer svg > g:nth-child(2)").attr("visibility","hidden"),d3.select("#timeline-footer svg > g:nth-child(2)").attr("style",""),setTimeout(function(){d3.select("#timeline-footer svg > g:nth-child(2)").attr("style",'clip-path:url("#timeline-boundary")'),d3.select("#timeline-footer svg > g:nth-child(2)").attr("visibility","")},50)};var f=function(){d.getWidth(),d.svg=d3.select("#timeline-footer").append("svg:svg").attr("width",d.width).attr("height",d.height+d.margin.top+d.margin.bottom+16),d.svg.append("svg:defs").append("svg:clipPath").attr("id","timeline-boundary").append("svg:rect").attr("width",d.width).attr("height",d.height+d.margin.top+d.margin.bottom),d3.select("#timeline-footer svg defs").append("svg:clipPath").attr("id","guitarpick-boundary").append("svg:rect").attr("width",d.width+d.margin.left+d.margin.right).attr("height",d.height+d.margin.top+d.margin.bottom).attr("x",-d.margin.left),d.boundary=d.svg.append("svg:g").attr("clip-path","#timeline-boundary").attr("style","clip-path:url(#timeline-boundary)").attr("transform","translate(0,16)"),d.axis=d.boundary.append("svg:g").attr("class","x axis").attr("transform","translate(0,"+d.height+")"),d.axis.insert("line",":first-child").attr("x1",0).attr("x2",d.width),d.dataBars=d.boundary.insert("svg:g",".x.axis").attr("height",d.height).classed("plot",!0),d.verticalAxis=d.boundary.append("svg:g").attr("class","y axis").attr("transform","translate(0,0)"),d.animboundary=d.svg.append("svg:g").attr("clip-path","#timeline-boundary").attr("transform","translate(0,16)"),d.animboundary.append("g").attr("id","wv-rangeselector-case")},g=function(){var b=$("#timeline-footer");f(),a.anim?(b.css("margin-left","10px"),b.css("margin-right",d.margin.right+d.margin.left-14+"px")):($("#animate-button").hide(),b.css("margin-left",d.margin.left-1+"px"),b.css("margin-right",d.margin.right-1+"px")),d.x=d3.time.scale.utc(),d.xAxis=d3.svg.axis().orient("bottom").tickSize(-d.height).tickPadding(5),d.axisZoom=d3.behavior.zoom().scale(1).scaleExtent([1,1]),d.resize(),wv.util.browser.localStorage&&"collapsed"===localStorage.getItem("timesliderState")&&d.collapseNow(),$("#timeline-hide").click(function(){d.toggle()}),$(window).resize(function(){d.resize(),d.zoom.refresh(),d.setClip()}),e.events.on("select",function(){d.input.update(),d.pick.shiftView()}),a.layers.events.on("change",function(){d.data.set()})};return g(),d};var wv=wv||{};wv.date=wv.date||{},wv.date.timeline=wv.date.timeline||{},wv.date.timeline.data=wv.date.timeline.data||function(a,b,c){var d=c.timeline,e=(a.date,{});e.start=function(){return new Date(b.startDate)},e.end=function(){return new Date(new Date(wv.util.today()).setUTCDate(wv.util.today().getUTCDate()))},e.set=function(){var b=a.layers.get(),c=b.filter(function(a){return a.startDate}),f=[],g=c.length;d.dataBars.selectAll("rect").remove(),$(c).each(function(a){f[a]=this.id}),d.y=d3.scale.ordinal().domain(f).rangeBands([5,d.height-12]),d.yAxis=d3.svg.axis().scale(d.y).orient("left").ticks(g),$(c).each(function(a){var b,c,f=!0,g=!0,h=this.id;this.startDate?(b=new Date(this.startDate),g=!1):b=e.start(),c=this.inactive===!0?new Date(this.endDate):new Date(e.end().setUTCDate(e.end().getUTCDate()+1));var i=d.dataBars.append("svg:rect").attr("x",d.x(b)).attr("width",d.x(c)-d.x(b)).attr("y",d.y(h)-2.5).attr("rx",4).attr("ry",4).attr("data-layer",h).attr("class","data-bar");g||i.classed("data-bar-dyn",!0),this.visible===!1&&(f=!1,i.classed("data-bar-invisible",!0))}),d.dataBars.selectAll("rect").attr("height",(d.height-22)/g),d.verticalAxis&&d.verticalAxis.call(d.yAxis)};var f=function(){};return f(),e};var wv=wv||{};wv.date=wv.date||{},wv.date.timeline=wv.date.timeline||{},wv.date.timeline.ticks=wv.date.timeline.ticks||function(a,b,c){var e,f=c.timeline,g=a.date,h={},i=!0,j=200,k=function(){i=!1};h.setAll=function(){h.all=d3.selectAll(".x.axis>g.tick"),h.firstElem=h.all[0][0],h.firstDate=h.all.data()[0],h.lastDate=h.all.data()[h.all.data().length-1],h.all.classed("tick-labeled",!1)},h.normal={setEnds:function(){var a=h.normal.all;h.normal.all.classed("end-tick",!1),h.normal.firstDate=a.data()[0],h.normal.firstElem=a[0][0],h.normal.lastDate=a.data()[a.data().length-1],h.normal.lastElem=a[0][a[0].length-1],d3.select(h.normal.lastElem).classed("end-tick",!0)},update:function(){var a=h.normal.all;a.each(function(){var a=d3.select(this),b=a.data()[0],c=f.zoom.current.ticks.normal.next(b);if(nWidth=f.x(c)-f.x(b)+1,"-2"!==$(this).find("line:first-child").attr("y1")&&a.select("line").attr("y1","-2"),a.classed("end-tick")&&null===a.select("line.tick-close")[0][0]&&d3.select(h.normal.lastElem).append("line").classed("tick-close",!0).attr("y2",-f.height).attr("y1",-2).attr("x1",nWidth-.5).attr("x2",nWidth-.5),$(this).find("text").length&&a.select("text").remove(),$(this).find("rect").length?a.select("rect.normaltick-background").attr("width",nWidth):h.normal.insert.rect(a,nWidth),3===f.config.currentZoom&&!$(this).find("line.tick-week").length){var d=d3.select(this),e=d.data()[0];0===e.getUTCDay()&&1!==e.getUTCDate()&&d.insert("line","rect").attr("y1",0).attr("y2",-10).attr("x2",0).classed("tick-week",!0)}}),h.normal.set(),h.normal.bind()},init:function(){var a=h.normal.all;a.selectAll("line").attr("y1","-2"),a.selectAll("line.tick-week").attr("y1","0"),a.selectAll("text").remove(),a.each(function(){var a=d3.select(this),b=a.data()[0],c=f.zoom.current.ticks.normal.next(b);nWidth=f.x(c)-f.x(b)+1,h.normal.insert.rect(a,nWidth),a.classed("end-tick")&&d3.select(h.normal.lastElem).append("line").classed("tick-close",!0).attr("y2",-f.height).attr("y1",-2).attr("x1",nWidth-.5).attr("x2",nWidth-.5)})},insert:{rect:function(a,b){a.append("svg:rect").attr("class","normaltick-background").attr("height",f.height-1).attr("y",-f.height).attr("x",-.5).attr("width",b)}},set:function(){h.normal.background=h.all.selectAll("rect.normaltick-background")},bind:function(){h.normal.background.on("mouseenter",function(){d=d3.select(this.parentNode).data()[0],h.normal.hover.call(this,d)}).on("mouseleave",h.label.remove).on("mousedown",function(){e=setTimeout(k,j)}).on("mouseup",function(){clearTimeout(e),!c.map.mapIsbeingDragged&&i&&(d=d3.select(this.parentNode).data()[0],h.normal.click.call(this,d)),i=!0})},hover:function(a){var b=f.zoom.current.ticks.normal.hover(a);h.label.show.call(this,b)},click:function(a){var b=f.zoom.current.ticks.normal.clickDate(a);g.select(b)}},h.boundary={update:function(){var a=h.boundary.all;a.each(function(){var a=d3.select(this),b=a.data()[0],c=f.zoom.current.ticks.boundary.next(b),d=f.zoom.current.ticks.normal.next(b),e=f.x(c)-f.x(b),g=f.x(d)-f.x(b)+1,i=f.zoom.current.ticks.boundary.subLabel(b);"20"!==$(this).find("line").attr("y1")&&a.select("line").attr("y1","20").attr("y2","-50"),$(this).find("text").hasClass("tick-label")||(a.select("text").attr("class","tick-label").attr("x",7).attr("style","text-anchor:left;"),i&&a.select("text").append("tspan").text(" "+i).attr("class","sub-label")),$(this).find("circle").length||a.insert("svg:circle","text").attr("r","6"),$(this).find("rect").length?(a.select("rect.boundarytick-background").attr("width",e),a.select("rect.boundarytick-foreground").attr("width",e),a.select("rect.normaltick-background").attr("width",g)):h.boundary.insert.rect(a,e,g)}),h.boundary.set(),h.boundary.bind()},init:function(){var a=h.boundary.all;a.selectAll("line").attr("y1","20").attr("y2","-50"),a.insert("svg:circle","text").attr("r","6"),a.each(function(){var a=d3.select(this),b=a.data()[0],c=f.zoom.current.ticks.boundary.next(b),d=f.zoom.current.ticks.normal.next(b),e=f.x(c)-f.x(b),g=f.x(d)-f.x(b)+1,i=f.zoom.current.ticks.boundary.subLabel(b);b<f.data.end()&&h.boundary.insert.rect(a,e,g),i&&a.select("text").append("tspan").text(" "+i).attr("class","sub-label")}),a.selectAll("text").attr("class","tick-label").attr("x",7).attr("style","text-anchor:left;")},insert:{rect:function(a,b,c){a.insert("svg:rect","text").attr("x","0").attr("y","0").attr("width",b).attr("height",f.height).attr("class","boundarytick-background"),a.append("svg:rect").attr("x","0").attr("y","0").attr("width",b).attr("height",f.height).attr("class","boundarytick-foreground"),a.classed("label-only")||a.append("svg:rect").attr("class","normaltick-background").attr("height",f.height-1).attr("y",-f.height).attr("x",-.5).attr("width",c)}},set:function(){h.boundary.background=h.boundary.all.selectAll("rect.boundarytick-foreground")},bind:function(){h.boundary.background.on("mouseenter",function(){d=d3.select(this.parentNode).data()[0],h.boundary.hover.call(this,d)}).on("mouseleave",h.label.remove).on("mousedown",function(){e=setTimeout(k,j)}).on("mouseup",function(){clearTimeout(e),!c.map.mapIsbeingDragged&&i&&(d=d3.select(this.parentNode).data()[0],h.boundary.click.call(this,d)),i=!0})},hover:function(a){var b=f.zoom.current.ticks.boundary.hover(a);h.label.show.call(this,b)},click:function(a){var b=f.zoom.current.ticks.boundary.clickDate(a);g.select(b)},labelOnly:function(a){d3.selectAll(".x.axis>g.label-only")}},h.add=function(a,b,c){var d=f.axis.insert("g",b).data([a]).attr("class","tick").attr("transform","translate("+f.x(a)+",0)");c||d.classed("label-only",!0);var e=f.zoom.current.ticks.boundary.label(a);d.append("line").attr("y2",-f.height),d.append("text").attr("y","5").attr("dy",".71em").text(e)},h.label={show:function(a){var b,c,d=this.parentNode;d3.select(d).classed("tick-labeled")?$boundaryTick=$(d):$boundaryTick=$(d).prevAll("g.tick-labeled").first(),c=$boundaryTick.find("rect.boundarytick-background").attr("width"),b=d3.select($boundaryTick[0]),b.selectAll(".tick-label, .sub-label").attr("visibility","hidden"),b.select("rect.boundarytick-background").classed("bg-hover",!0),b.append("svg:text").attr("class","hover-tick-label").attr("y","15").attr("x",c/2).attr("style","text-anchor:middle").attr("width",c).text(a.getUTCFullYear()+" "+g.monthAbbr[a.getUTCMonth()]+" "+a.getUTCDate())},remove:function(){f.boundary.selectAll(".tick-label, .sub-label").attr("visibility",""),f.boundary.selectAll(".hover-tick-label, .hover-sub-label").remove(),f.boundary.selectAll("rect.boundarytick-background.bg-hover").classed("bg-hover",!1)}},h.removePaddingData=function(){h.all.each(function(){(d3.select(this).data()[0]<f.data.start()||d3.select(this).data()[0]>f.data.end())&&(d3.select(this).classed("tick-labeled")?d3.select(this).selectAll("rect").remove():d3.select(this).remove())})},h.check=function(){var a,b;h.setAll(),f.ticks.removePaddingData(),h.setAll(),f.isCropped||h.firstDate>f.data.start()&&(protoNorm=f.zoom.current.ticks.normal.first(),h.add(protoNorm,"g.tick",!0)),h.setAll(),f.zoom.current.ticks.normal.all(),h.all.classed("label-only",!1),$(h.normal.firstElem).is(":nth-child(2)")&&(a=f.zoom.current.ticks.boundary.first(),h.add(a,"g.tick"));var c=d3.select($(h.normal.lastElem).next()[0]);c.classed("domain")&&(b=f.zoom.current.ticks.boundary.last(),h.add(b,"path.domain")),c.classed("end-tick"),h.setAll(),f.zoom.current.ticks.boundary.all(),h.boundary.all.classed("tick-labeled",!0)};var l=function(){};return l(),h};var wv=wv||{};wv.date=wv.date||{},wv.date.timeline=wv.date.timeline||{},wv.date.timeline.zoom=wv.date.timeline.zoom||function(a,b,c){var d=c.timeline,e=(a.date,{});e.current={ticks:{boundary:{},normal:{}},pick:{}},e.change=function(a,b){var c=d.config.currentZoom;c+=-a,c<1&&(c=1),c>3&&(c=3),d.config.zoom.call(this,c,b)},e.drawTicks=function(a,b,f,g,h,i,j,k,l){var m,n;if(k){var o=k.clientX-$("#timeline-footer").offset().left;n=d.x.invert(o),m=(d.width-d.margin.left-d.margin.right)/2-o}var p,q=d.data.start(),r=d.width/2-a*g/2,s=d.width/2+a*g/2;b>a?(d.isCropped=!1,p=d.data.end(),r=d.width/2-a*g/2,s=d.width/2+a*g/2):(d.isCropped=!0,p=f,r=0,s=d.width),d.x.domain([q,p]).range([r,s]),d.xAxis.scale(d.x).ticks(h,i).tickFormat(j),d.axisZoom=d3.behavior.zoom().scale(1).scaleExtent([1,1]).x(d.x),d.isCropped?d.axisZoom.xExtent(l):d.axisZoom.xExtent([d.data.start(),d.data.end()]),wv.ui.mouse.wheel(d.axisZoom,c).change(e.change),d.svg.call(d.axisZoom),k?d.pan.toCursor(n,m):d.pan.toSelection(),d.axis.selectAll(".tick").remove(),d.axis.call(d.xAxis)},e.refresh=function(){d.config.zoom(d.config.currentZoom)};var f=function(){};return f(),e};var wv=wv||{};wv.date=wv.date||{},wv.date.timeline=wv.date.timeline||{},wv.date.timeline.pick=wv.date.timeline.pick||function(a,b,c){var d,e,f,g=c.timeline,h=a.date,i={},j=60,k=!1,l=function(a){var b=Math.max(-(j/2),Math.min(g.width-j/2,d3.event.x)),c=b+j/2,k=g.x.invert(c);d3.event.dx>0?void 0===d?o(k):k>=d&&d<=g.data.end()&&d>g.data.start()?(i.offset=g.x(d)-j/2,f=d,n.call(this),o(k)):d>g.data.end()?(f=new Date(Date.UTC(g.data.end().getUTCFullYear(),h.selected.getUTCMonth(),h.selected.getUTCDate())),i.offset=g.x(f)-j/2,n.call(this),o(k)):d<g.data.start()&&(d=new Date(Date.UTC(g.data.start().getUTCFullYear(),h.selected.getUTCMonth(),h.selected.getUTCDate()))):d3.event.dx<0&&(void 0===e?o(k):k<=e&&e>=g.data.start()&&e<g.data.end()?(i.offset=g.x(e)-j/2,f=e,n.call(this),o(k)):o(k))},m=d3.behavior.drag().origin(function(a){return a}).on("dragstart",function(){k=!0,d3.event.sourceEvent.preventDefault(),d3.event.sourceEvent.stopPropagation(),g.guitarPick.classed("pick-clicked",!0)}).on("drag",l).on("dragend",function(){k=!1,e=void 0,d=void 0,g.guitarPick.classed("pick-clicked",!1)}),n=function(){var a=f;g.guitarPick.attr("transform","translate("+i.offset+",0)"),g.guitarPick.data([{x:i.offset,y:0}]).call(m),h.select(a),i.hoverDate(a)};i.hoverDate=function(a){var b;g.zoom.current.pick.hoverTick(a),tickBg=g.zoom.current.pick.hoveredTick.select("rect.normaltick-background")[0][0],b=d3.select(g.zoom.current.pick.hoveredTick[0][0]).data()[0],g.ticks.label.remove(),g.ticks.normal.hover.call(tickBg,b)};var o=function(a){e=g.zoom.current.pick.prevChange(a),d=g.zoom.current.pick.nextChange(a)};i.shiftView=function(){var a=g.pan.xPosition;g.x(h.selected)>=g.width-15?(k?g.axisZoom.translate([a-g.x(h.selected)+(g.width-15),0]):g.axisZoom.translate([a-g.x(h.selected)+g.width/8*7,0]),g.pan.xPosition=g.axisZoom.translate()[0],g.pan.axis()):g.x(h.selected)<15&&(k?g.axisZoom.translate([a-g.x(h.selected)+15,0]):g.axisZoom.translate([a-g.x(h.selected)+g.width/8,0]),g.pan.xPosition=g.axisZoom.translate()[0],g.pan.axis()),$("#guitarpick").show()},i.checkLocation=function(){i.offset-j/2>=g.width-g.margin.left-g.margin.right||i.offset<=-30?$("#guitarpick").hide():$("#guitarpick").show()},i.update=function(){k===!1&&(i.offset=g.x(h.selected)-j/2),g.guitarPick.data([{x:i.offset,y:0}]).attr("transform","translate("+i.offset+",0)").call(m),e=void 0,d=void 0};var p=function(){g.guitarPick=g.svg.append("svg:g").attr("id","guitarpick").attr("style","clip-path:url(#guitarpick-boundary);"),g.guitarPick.append("svg:path").attr("d","M 7.3151,0.7426 C 3.5507,0.7426 0.5,3.7926 0.5,7.5553 l 0,21.2724 14.6038,15.7112 14.6039,15.7111 14.6038,-15.7111 14.6037,-15.7112 0,-21.2724 c 0,-3.7627 -3.051,-6.8127 -6.8151,-6.8127 l -44.785,0 z"),g.guitarPick.append("svg:rect").attr("width","4").attr("height","20").attr("x","21").attr("y","11"),g.guitarPick.append("svg:rect").attr("width","4").attr("height","20").attr("x","28").attr("y","11"),g.guitarPick.append("svg:rect").attr("width","4").attr("height","20").attr("x","35").attr("y","11"),d3.select(document).on("mouseup",function(){k&&(k=!1,g.guitarPick.classed("pick-clicked",!1),g.ticks.label.remove())})};return p(),i};var wv=wv||{};wv.date=wv.date||{},wv.date.timeline=wv.date.timeline||{},wv.date.timeline.pan=wv.date.timeline.pan||function(a,b,c){var d=c.timeline,e=a.date,f={};f.xPosition=d.axisZoom.translate()[0],f.axis=function(a){if(a){var b=a.sourceEvent||a,c=b.deltaX;"wheel"===b.type&&(c<=0||c>0)&&g(f.xPosition-c,0)}else f.xPosition=d.axisZoom.translate()[0];d.axis.call(d.xAxis),d.ticks.check(),d.ticks.boundary.update(),d.ticks.normal.update(),d.pick.update(),d.pick.checkLocation(),e.events.trigger("timeline-change"),d.data.set()};var g=function(a,b){d.axisZoom.translate([a,b]),f.xPosition=d.axisZoom.translate()[0]};f.toSelection=function(){var a=-d.x(e.selected)+(d.width-d.margin.left-d.margin.right)/2;g(a,0),d.data.set()},f.toCursor=function(a,b){var c=-d.x(a)+(d.width-d.margin.left-d.margin.right)/2-b;g(c,0),d.data.set()};var h=function(){};return h(),f};var wv=wv||{};wv.date=wv.date||{},wv.date.timeline=wv.date.timeline||{},wv.date.timeline.input=wv.date.timeline.input||function(a,b,c){var d,e,f=c.timeline,g=a.date,h={};h.direction="forward",h.interval="day",h.delta=1,h.active=!1,h.delay=500;var i=$("#right-arrow-group"),j=$("#left-arrow-group"),k=function(){var a=new Date(new Date(g.selected).setUTCDate(g.selected.getUTCDate()+1));a<=wv.util.today()?o("day"):h.stop()};h.forward=function(){h.play("forward")},h.reverse=function(){h.play("reverse")},h.stop=function(){d&&clearTimeout(d),d=null,h.active=!1};var l=function(){if(h.active){var a="forward"===h.direction?h.delta:-h.delta,b=wv.util.dateAdd(g.selected,h.interval,a);d=setTimeout(function(){m(b)},h.delay)}},m=function(a){var b=g.select(a);b?l():h.stop()};h.play=function(a){if(h.active&&a!==h.direction)h.stop();else if(h.active)return;h.direction=a||h.direction,h.active=!0,l()};var n=function(){var a=new Date(new Date(g.selected).setUTCDate(g.selected.getUTCDate()-1));a>=f.data.start()?p("day"):h.stop()},o=function(b){h.active||(a.date.add(b,1),h.interval=b,h.play("forward"))},p=function(b){h.active||(a.date.add(b,-1),h.interval=b,h.play("reverse"))},q=function(b,c){d&&(clearTimeout(d),d=null);var f=$(this).attr("data-interval")||b,h=_.parseInt($(this).attr("data-value"))||c,i=e||a.date.selected,j=a.date.minDate(),k=a.date.maxDate(),l=wv.util.rollDate(i,f,h,j,k);if(l!==i){e=l,$(this).parent().css("border-color",""),s(e);var m=this;d=setTimeout(function(){g.select(e),$(m).parent().find("input").select(),e=null,d=null},400)}},r=function(a){var b=a.keyCode||a.which,c=13==b||9===b;if("focusout"==a.type||c){c&&a.preventDefault();var d=$(this),e=d.attr("id"),i=d.val(),j=null;switch(e){case"year-input-group":i>1e3&&i<9999&&(j=new Date(new Date(g.selected).setUTCFullYear(i)));break;case"month-input-group":if($.isNumeric(i)&&i<13&&i>0)j=new Date(new Date(g.selected).setUTCMonth(i-1));else{var k,l=!1;i=i.toUpperCase();for(var m=0;m<g.monthAbbr.length;m++)i===g.monthAbbr[m]&&(l=!0,k=m);l&&(j=new Date(new Date(g.selected).setUTCMonth(k)))}break;case"day-input-group":i>0&&i<=new Date(g.selected.getYear(),g.selected.getMonth()+1,0).getDate()&&(j=new Date(new Date(g.selected).setUTCDate(i)))}if(j>f.data.start()&&j<=wv.util.today()){var n=d.parent().next("div.input-wrapper").find("input.button-input-group");c&&n.length<1&&$("#focus-guard-2").focus(),g.select(j),$(".button-input-group").parent().css("border-color",""),d.parent().removeClass("selected"),c&&n.select().addClass("selected")}else d.parent().css("border-color","#ff0000"),"focusout"!==a.type?d.select():(document.selection?document.selection.empty():window.getSelection().removeAllRanges(),d.parent().animate({borderColor:"rgba(40, 40, 40, .9)"},{complete:function(){d.parent().css("border-color","")}}),h.update())}},s=function(b){b=b||a.selected.date,$("#year-input-group").val(b.getUTCFullYear()),$("#month-input-group").val(g.monthAbbr[b.getUTCMonth()]);b.getUTCDate();$("#day-input-group").val(wv.util.pad(b.getUTCDate(),2,"0"))};h.update=function(a){var b=a||new Date(g.selected),c=new Date(b.setUTCDate(b.getUTCDate()+1)),d=new Date(b.setUTCDate(b.getUTCDate()-1));$("#year-input-group").val(g.selected.getUTCFullYear()),$("#month-input-group").val(g.monthAbbr[g.selected.getUTCMonth()]),g.selected.getUTCDate()<10?$("#day-input-group").val("0"+g.selected.getUTCDate()):$("#day-input-group").val(g.selected.getUTCDate()),c>wv.util.today()?i.addClass("button-disabled"):i.removeClass("button-disabled"),d.toUTCString()===f.data.start().toUTCString()?j.addClass("button-disabled"):j.removeClass("button-disabled"),f.pick.update()};var t=function(){i.mousedown(function(a){a.preventDefault(),k()}).mouseup(h.stop),j.mousedown(function(a){a.preventDefault(),n()}).mouseup(h.stop),$(document).mouseout(h.stop).keydown(function(a){if("INPUT"!==a.target.nodeName)switch(a.keyCode){case wv.util.key.LEFT:p("day"),a.preventDefault();break;case wv.util.key.RIGHT:o("day"),a.preventDefault()}}).keyup(function(a){switch(a.keyCode){case wv.util.key.LEFT:case wv.util.key.RIGHT:h.stop(),a.preventDefault()}});var a=$(".button-input-group");a.unbind(),a.keydown(function(a){var b=$(this).attr("id").split("-")[0];a.stopPropagation(),a.keyCode===(wv.util.key.LEFT||wv.util.key.RIGHT)?(a.preventDefault(),$(this).select().focus()):a.keyCode===wv.util.key.UP?(a.preventDefault(),q(b,1),$(this).select().focus()):a.keyCode===wv.util.key.DOWN&&(a.preventDefault(),q(b,-1),$(this).select().focus())}),a.on("focus",function(b){b.preventDefault(),a.siblings(".date-arrows").css("visibility",""),a.parent().removeClass("selected"),$(this).parent().addClass("selected"),$(this).siblings(".date-arrows").css("visibility","visible")}),a.focusout(function(b){a.siblings(".date-arrows").css("visibility",""),a.parent().removeClass("selected")});var b=$(".date-arrow-up");b.click(q),b.mousedown(function(a){a.preventDefault()});var c=$(".date-arrow-down");c.click(q),c.mousedown(function(a){a.preventDefault()}),$("input").focus(function(a){$(this).select()}).mouseup(function(a){a.preventDefault()}),$(".button-input-group").keydown(r).focusout(function(a){$(this).hasClass("focus")&&($(this).removeClass("focus"),r.call(this,a))}).focus(function(){$(this).addClass("focus")}),$("#focus-guard-1").on("focus",function(){$("#day-input-group").focus().select()}),$("#focus-guard-2").on("focus",function(){$("#year-input-group").focus().select()}),wv.util.browser.tests.touchDevice()&&$(".button-input-group").prop("disabled",!0),h.update()};return t(),h};var wv=wv||{};wv.date=wv.date||{},wv.date.timeline=wv.date.timeline||{},wv.date.timeline.config=wv.date.timeline.config||function(a,b,c){var d={},e=c.timeline,f=a.date,g=f.selectedZoom||3;d.zoom=function(a,b){var c,g,i,j,k,l,m,n=1;switch(a){case 1:c=d3.time.format.utc("%Y"),g=d3.time.year.utc,i=e.data.end().getUTCFullYear()-e.data.start().getUTCFullYear(),k=15,j=Math.ceil(e.width/k),m=[new Date(e.data.start().setUTCFullYear(e.data.start().getUTCFullYear()-10)),new Date(e.data.end().setUTCFullYear(e.data.end().getUTCFullYear()+10))],l=new Date(e.data.start().getUTCFullYear()+j,e.data.start().getUTCMonth(),e.data.start().getUTCDate()),e.zoom.drawTicks(i,j,l,k,g,n,c,b,m),e.zoom.current.ticks.normal.all=function(){e.ticks.normal.all=e.ticks.all.filter(function(a){return a.getUTCFullYear()%10!==0}),e.ticks.normal.setEnds()},e.zoom.current.ticks.boundary.all=function(){e.ticks.boundary.all=e.ticks.all.filter(function(a){return a.getUTCFullYear()%10===0})},e.zoom.current.ticks.boundary.next=function(a){var b=new Date(a);return new Date(b.setUTCFullYear(b.getUTCFullYear()+10))},e.zoom.current.ticks.normal.next=function(a){var b=new Date(a);return new Date(b.setUTCFullYear(b.getUTCFullYear()+1))},e.zoom.current.ticks.boundary.first=function(){var a=e.ticks.normal.firstDate;return new Date(Date.UTC(10*Math.floor(a.getUTCFullYear()/10),0,1))},e.zoom.current.ticks.normal.first=function(){var a=e.ticks.firstDate;return new Date(Date.UTC(a.getUTCFullYear()-1,a.getUTCMonth(),a.getUTCDate()))},e.zoom.current.ticks.boundary.last=function(){var a=e.ticks.normal.lastDate;return new Date(Date.UTC(10*Math.ceil(a.getUTCFullYear()/10),0,1));
},e.zoom.current.ticks.normal.hover=function(a){return new Date(a.getUTCFullYear(),f.selected.getUTCMonth(),f.selected.getUTCDate())},e.zoom.current.ticks.normal.clickDate=function(a){return new Date(a.getUTCFullYear(),f.selected.getUTCMonth(),f.selected.getUTCDate())},e.zoom.current.ticks.boundary.hover=function(a){var b=f.selected.getUTCFullYear()-Math.ceil(10*new Date(f.selected.getUTCFullYear()/10));return new Date(a.getUTCFullYear()+b,f.selected.getUTCMonth(),f.selected.getUTCDate())},e.zoom.current.ticks.boundary.label=function(a){return a.getUTCFullYear()},e.zoom.current.ticks.boundary.subLabel=function(a){return null},e.zoom.current.ticks.boundary.clickDate=function(a){var b=f.selected.getUTCFullYear()-Math.ceil(10*new Date(f.selected.getUTCFullYear()/10));return new Date(a.getUTCFullYear()+b,f.selected.getUTCMonth(),f.selected.getUTCDate())},e.zoom.current.pick.nextChange=function(a){return new Date(Date.UTC(a.getUTCFullYear()+1,f.selected.getUTCMonth(),f.selected.getUTCDate()))},e.zoom.current.pick.prevChange=function(a){return new Date(Date.UTC(a.getUTCFullYear(),f.selected.getUTCMonth(),f.selected.getUTCDate()))},e.zoom.current.pick.hoverTick=function(a){e.zoom.current.pick.hoveredTick=d3.selectAll(".x.axis>g.tick").filter(function(b){return b.getUTCFullYear()===a.getUTCFullYear()})},$(".zoom-btn").removeClass(function(a,b){return(b.match(/(^|\s)depth-\S+/g)||[]).join(" ")}).css("margin","").css("font-size",""),$("#zoom-years").addClass("depth-1").css("font-size","1.7em"),$("#zoom-months").addClass("depth-2").css("font-size","1.2em"),$("#zoom-days").addClass("depth-3").css("margin","-3px 0 5px 0"),d.currentZoom=1;break;case 2:c=d3.time.format.utc("%Y"),g=d3.time.month.utc,i=12*(e.data.end().getUTCFullYear()-e.data.start().getUTCFullYear())+e.data.end().getUTCMonth()+1-e.data.start().getUTCMonth(),k=11,j=Math.ceil(e.width/k),m=[new Date(e.data.start().setUTCFullYear(e.data.start().getUTCFullYear()-1)),new Date(e.data.end().setUTCFullYear(e.data.end().getUTCFullYear()+1))],l=new Date(e.data.start().getUTCFullYear(),e.data.start().getUTCMonth()+j,e.data.start().getUTCDate()),e.zoom.drawTicks(i,j,l,k,g,n,c,b,m),e.zoom.current.ticks.normal.all=function(){e.ticks.normal.all=e.ticks.all.filter(function(a){return 0!==a.getUTCMonth()}),e.ticks.normal.setEnds()},e.zoom.current.ticks.boundary.all=function(){e.ticks.boundary.all=e.ticks.all.filter(function(a){return 0===a.getUTCMonth()})},e.zoom.current.ticks.boundary.next=function(a){var b=new Date(a);return new Date(b.setUTCFullYear(b.getUTCFullYear()+1))},e.zoom.current.ticks.normal.next=function(a){var b=new Date(a);return new Date(b.setUTCMonth(b.getUTCMonth()+1))},e.zoom.current.ticks.boundary.first=function(){var a=e.ticks.normal.firstDate;return new Date(Date.UTC(a.getUTCFullYear(),0,1))},e.zoom.current.ticks.normal.first=function(){var a=e.ticks.normal.firstDate;return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth()-1,a.getUTCDate()))},e.zoom.current.ticks.boundary.last=function(){var a=e.ticks.normal.lastDate;return new Date(Date.UTC(a.getUTCFullYear()+1,0,1))},e.zoom.current.ticks.normal.hover=function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),f.selected.getUTCDate())},e.zoom.current.ticks.normal.clickDate=function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),f.selected.getUTCDate())},e.zoom.current.ticks.boundary.hover=function(a){return new Date(a.getUTCFullYear(),f.selected.getUTCMonth(),f.selected.getUTCDate())},e.zoom.current.ticks.boundary.label=function(a){return a.getUTCFullYear()},e.zoom.current.ticks.boundary.subLabel=function(a){return null},e.zoom.current.ticks.boundary.clickDate=function(a){return new Date(a.getUTCFullYear(),f.selected.getUTCMonth(),f.selected.getUTCDate())},e.zoom.current.pick.nextChange=function(a){return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth()+1,f.selected.getUTCDate()))},e.zoom.current.pick.prevChange=function(a){return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),f.selected.getUTCDate()))},e.zoom.current.pick.hoverTick=function(a){e.zoom.current.pick.hoveredTick=d3.selectAll(".x.axis>g.tick").filter(function(b){return b.getUTCFullYear()===a.getUTCFullYear()&&b.getUTCMonth()===a.getUTCMonth()})},$(".zoom-btn").removeClass(function(a,b){return(b.match(/(^|\s)depth-\S+/g)||[]).join(" ")}).css("margin","").css("font-size",""),$("#zoom-days").addClass("depth-2").css("margin","5px 0 0 0"),$("#zoom-years").addClass("depth-2"),$("#zoom-months").addClass("depth-1").css("font-size","1.7em"),d.currentZoom=2;break;case 3:c=d3.time.format.utc("%b"),g=d3.time.day.utc,i=(e.data.end()-e.data.start())/1e3/60/60/24,k=11,j=Math.ceil(e.width/k),m=[new Date(e.data.start().setUTCDate(e.data.start().getUTCDate()-15)),new Date(e.data.end().setUTCDate(e.data.end().getUTCDate()+15))],l=new Date(e.data.start().getUTCFullYear(),e.data.start().getUTCMonth(),e.data.start().getUTCDate()+j),e.zoom.drawTicks(i,j,l,k,g,n,c,b,m),e.zoom.current.ticks.normal.all=function(){e.ticks.normal.all=e.ticks.all.filter(function(a){return 1!==a.getUTCDate()}),e.ticks.normal.setEnds()},e.zoom.current.ticks.boundary.all=function(){e.ticks.boundary.all=e.ticks.all.filter(function(a){return 1===a.getUTCDate()})},e.zoom.current.ticks.boundary.next=function(a){var b=new Date(a);return new Date(b.setUTCMonth(b.getUTCMonth()+1))},e.zoom.current.ticks.normal.next=function(a){var b=new Date(a);return new Date(b.setUTCDate(b.getUTCDate()+1))},e.zoom.current.ticks.boundary.first=function(){var a=e.ticks.normal.firstDate;return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),1))},e.zoom.current.ticks.normal.first=function(){var a=e.ticks.normal.firstDate;return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()-1))},e.zoom.current.ticks.boundary.last=function(){var a=e.ticks.normal.lastDate;return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth()+1,1))},e.zoom.current.ticks.normal.hover=function(a){return a},e.zoom.current.ticks.normal.clickDate=function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())},e.zoom.current.ticks.boundary.hover=function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),f.selected.getUTCDate())},e.zoom.current.ticks.boundary.label=function(a){return f.monthAbbr[a.getUTCMonth()]},e.zoom.current.ticks.boundary.subLabel=function(a){return a.getUTCFullYear()},e.zoom.current.ticks.boundary.clickDate=function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),f.selected.getUTCDate())},e.zoom.current.pick.nextChange=function(a){return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()+1))},e.zoom.current.pick.prevChange=function(a){return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()))},e.zoom.current.pick.hoverTick=function(a){e.zoom.current.pick.hoveredTick=d3.selectAll(".x.axis>g.tick").filter(function(b){return b.getUTCFullYear()===a.getUTCFullYear()&&b.getUTCMonth()===a.getUTCMonth()&&b.getUTCDate()===a.getUTCDate()})},d3.selectAll(".x.axis > g.tick").each(function(){var a=d3.select(this),b=a.data()[0];0===b.getUTCDay()&&1!==b.getUTCDate()&&a.insert("line","rect").attr("y1",0).attr("y2",-10).attr("x2",0).classed("tick-week",!0)}),$(".zoom-btn").removeClass(function(a,b){return(b.match(/(^|\s)depth-\S+/g)||[]).join(" ")}).css("margin","").css("font-size",""),$("#zoom-years").addClass("depth-3").css("margin","6px 0 0 0"),$("#zoom-months").addClass("depth-2"),$("#zoom-days").addClass("depth-1").css("margin","8px 0 0 0").css("font-size","1.8em"),d.currentZoom=3;break;default:console.log("Invalid Zoom level")}e.ticks.check(),h(),e.pick.update(),e.pick.checkLocation(),f.selectedZoom=a,f.events.trigger("zoom-change"),f.events.trigger("timeline-change")};var h=function(){e.ticks.boundary.init(),e.ticks.normal.init(),e.ticks.normal.set(),e.ticks.normal.bind(),e.ticks.boundary.set(),e.ticks.boundary.bind()},i=function(){d3.select("#zoom-years").on("click",function(a){$(".zoom-btn").removeClass("zoom-btn-selected"),$(this).addClass("zoom-btn-selected"),d.zoom(1)}),d3.select("#zoom-months").on("click",function(a){$(".zoom-btn").removeClass("zoom-btn-selected"),$(this).addClass("zoom-btn-selected"),d.zoom(2)}),d3.select("#zoom-days").on("click",function(a){$(".zoom-btn").removeClass("zoom-btn-selected"),$(this).addClass("zoom-btn-selected"),d.zoom(3)}),d.zoom(g),e.setClip()};return i(),d};var wv=wv||{};wv.date=wv.date||{},wv.date.wheels=wv.date.wheels||function(a,b){var c="timewheels",d=$("#"+c),e=6e4,f=a.date,g={};g.enabled=!1;var h=function(){i(),f.events.on("select",m),$(window).on("resize",k),l(),m(),k()},i=function(){d.addClass("datespan").html("<div id='wv-date-mobile-label'></div><input type='hidden' id='linkmode' readonly>"),$("#linkmode").mobiscroll().date({display:"bottom",onChange:function(a){var b=wv.util.parseDateUTC(a);f.select(b)},onShow:function(){$("#wv-date-mobile-label").css("display","none")},onClose:function(){$("#wv-date-mobile-label").css("display","block")},dateFormat:"yyyy-mm-dd",setText:"OK"}),$("#linkmode").mobiscroll("setDate",j(f.selected),!0),$("#wv-date-mobile-label").click(function(a){$("#linkmode").mobiscroll("show")})},j=function(a){var b=a.getTimezoneOffset()*e;return new Date(a.getTime()+b)},k=function(){!g.enabled&&wv.util.browser.small?(g.enabled=!0,d.show()):g.enabled&&!wv.util.browser.small&&(g.enabled=!1,d.hide())},l=function(){startDate=wv.util.parseDateUTC(b.startDate),endDate=wv.util.today(),$("#linkmode").mobiscroll("option","disabled",!1),$("#linkmode").mobiscroll("option","minDate",j(startDate)),$("#linkmode").mobiscroll("option","maxDate",j(endDate))},m=function(){$("#wv-date-mobile-label").html(wv.util.toISOStringDate(f.selected)),$("#linkmode").mobiscroll("setDate",j(f.selected),!0)};return h(),g};var wv=wv||{};wv.layers=function(a){a.parse=function(a,d,e){a.l&&c(a,d,e),a.products&&b(a,d,e)};var b=function(a,b,c){var d=a.products,e=[],f=d.split(/[~,\.]/);_.each(f,function(a){if("baselayers"!==a&&"overlays"!=a){var d=!0;if(a.startsWith("!")&&(d=!1,a=a.substring(1)),c.redirects&&c.redirects.layers&&(a=c.redirects.layers[a]||a),!c.layers[a])return void b.push({message:"No such layer: "+a});var f={id:a,attributes:[]};d||f.attributes.push({id:"hidden",value:!0}),e.push(f)}}),a.l=e},c=function(a,b,c){var d=a.l,e=d.match(/[^\(,]+(\([^\)]*\))?,?/g),f=[];_.each(e,function(a){var b=a.match(/[^\(,]+/)[0];c.redirects&&c.redirects.layers&&(b=c.redirects.layers[b]||b);var d={id:b,attributes:[]},e=a.match(/\(.*\)/);if(e){var g=e[0].replace(/[\(\)]/g,""),h=g.split(",");_.each(h,function(a){parts=a.split("="),1===parts.length?d.attributes.push({id:parts[0],value:!0}):d.attributes.push({id:parts[0],value:parts[1]})})}f.push(d)}),a.l=f};return a.validate=function(a,b){var c=function(c,d){a.push({message:"Invalid layer: "+c,cause:d,layerRemoved:!0}),delete b.layers[c],_.remove(b.layerOrder.baselayers,function(a){return a===c}),_.remove(b.layerOrder.overlays,function(a){return a===c})},d=_.cloneDeep(b.layers);_.each(d,function(a){return a.group?a.projections?void 0:void c(a.id,"No projections defined"):void c(a.id,"No group defined")});var e=_.cloneDeep(b.layerOrder);_.each(e,function(a){if(!b.layers[a])return void c(a,"No configuration")})},a}(wv.layers||{});var wv=wv||{};wv.layers=wv.layers||{},wv.layers.metadata=function(a){var b="config/metadata/"+a.metadata+".html?v=20170824142834978";wv.util.browser.small?window.open(b,"_blank"):wv.ui.getDialog().dialog({title:"Layer Information",width:625,height:525,show:{effect:"fade"},hide:{effect:"fade"}}).load(b+" #page")};var wv=wv||{};wv.layers=wv.layers||{},wv.layers.model=wv.layers.model||function(a,b){var c={},d=0;c.events=wv.util.events(),c.active=[];var e=function(){c.reset()};c.reset=function(){c.clear(),b.defaults&&b.defaults.startingLayers&&_.each(b.defaults.startingLayers,function(a){c.add(a.id,a)})},c.get=function(a){a=a||{};var b=f("baselayers",a),c=f("overlays",a);if("baselayers"===a.group)return b;if("overlays"===a.group)return c;if("all"===a.group)return{baselayers:b,overlays:c};if(a.group)throw new Error("Invalid layer group: "+a.group);return b.concat(c)},c.getTitles=function(c,d){d=d||a.proj.selected.id;var e,f;if(b.layers[c].projections[d]){var g=b.layers[c].projections[d];e=g.title,f=g.subtitle,tags=g.tags}var h=b.layers[c];return e=e||h.title||"["+c+"]",f=f||h.subtitle||"",tags=tags||h.tags||"",{title:e,subtitle:f,tags:tags}},c.available=function(b){var d=c.dateRange({layer:b}),e=a.date.selected;return!d||!(e<d.start||e>d.end)},c.exists=function(a){var b=!1;return _.each(c.active,function(c){if(a===c.id)return void(b=!0)}),b},c.dateRange=function(d){d=d||{};var e=(d.projId||a.proj.selected.id,d.layer?[_.find(c.active,{id:d.layer})]:c.active),f=b.parameters&&(b.parameters.debugGIBS||b.parameters.ignoreDateRange);if(f)return{start:new Date(Date.UTC(1970,0,1)),end:wv.util.today()};var g=Number.MAX_VALUE,h=0,i=!1;return _.each(e,function(a){if(a.startDate){i=!0;var b=wv.util.parseDateUTC(a.startDate).getTime();g=Math.min(g,b)}if(a.inactive&&a.endDate){i=!0;var c=wv.util.parseDateUTC(a.endDate).getTime();h=Math.max(h,c)}else a.endDate&&(i=!0,h=wv.util.today().getTime());a.startDate&&!a.endDate&&(h=wv.util.today().getTime())}),i?(0===h&&(h=wv.util.today().getTime()),{start:new Date(g),end:new Date(h)}):void 0},c.add=function(a,e){if(!_.find(c.active,{id:a})){e=e||{};var f=b.layers[a];if(!f)throw new Error("No such layer: "+a);f.visible=!0,_.isUndefined(e.visible)?_.isUndefined(e.hidden)||(f.visible=!e.hidden):f.visible=e.visible,f.opacity=_.isUndefined(e.opacity)?1:e.opacity,"overlays"===f.group?(c.active.unshift(f),d+=1):c.active.splice(d,0,f),c.events.trigger("add",f),c.events.trigger("change")}},c.remove=function(a){var b=_.findIndex(c.active,{id:a}),e=c.active[b];b>=0&&(c.active.splice(b,1),b<d&&(d-=1),c.events.trigger("remove",e),c.events.trigger("change"))},c.replace=function(a,d){var e=_.findIndex(c.active,{id:a});if(!(e<0)){var f=(c.active[e],b.layers[d]);f.visible=!0,f.opacity=1,c.active[e]=f,c.events.trigger("update"),c.events.trigger("change")}},c.clear=function(b){b=b||a.proj.selected.id;var d=c.active.slice(0);_.each(d,function(a){b&&a.projections[b]&&c.remove(a.id)})},c.pushToBottom=function(a){var b=_.findIndex(c.active,{id:a});if(b<0)throw new Error("Layer is not active: "+a);var e=c.active[b];c.active.splice(b,1),"baselayers"===e.group?c.active.push(e):c.active.splice(d-1,0,e),c.events.trigger("update"),c.events.trigger("change")},c.moveBefore=function(a,b){var d=_.findIndex(c.active,{id:a});if(d<0)throw new Error("Layer is not active: "+source);var e=c.active[d],f=_.findIndex(c.active,{id:b});if(f<0)throw new Error("Layer is not active: "+target);c.active.splice(f,0,e),d>f&&d++,c.active.splice(d,1),c.events.trigger("update",e,f),c.events.trigger("change")},c.setVisibility=function(a,b){var d=_.find(c.active,{id:a});d.visible!==b&&(d.visible=b,c.events.trigger("visibility",d,b),c.events.trigger("change"))},c.setOpacity=function(a,b){var d=_.find(c.active,{id:a});d.opacity!==b&&(d.opacity=b,c.events.trigger("opacity",d,b),c.events.trigger("change"))},c.isRenderable=function(a){var b=_.find(c.active,{id:a});if(!b)return!1;if(!c.available(a))return!1;if(!b.visible||0===b.opacity)return!1;if("overlays"===b.group)return!0;var d=!1;return _.each(c.get({group:"baselayers"}),function(a){return a.id!==b.id&&(a.visible&&1===a.opacity&&c.available(a.id)?(d=!0,!1):void 0)}),!d},c.save=function(a){c.get();a.l=a.l||[],_.each(c.get(),function(b){var c=_.find(a.l,{id:b.id});c||(c={id:b.id},a.l.push(c)),c.attributes||(c.attributes=[]),b.visible||c.attributes.push({id:"hidden"}),b.opacity<1&&c.attributes.push({id:"opacity",value:b.opacity})})},c.load=function(d,e){_.isUndefined(d.l)||(c.clear(a.proj.selected.id),_.eachRight(d.l,function(a){if(!b.layers[a.id])return void e.push({message:"No such layer: "+a.id});var d=!1,f=1;_.each(a.attributes,function(a){"hidden"===a.id&&(d=!0),"opacity"===a.id&&(f=wv.util.clamp(parseFloat(a.value),0,1),isNaN(f)&&(f=0))}),c.add(a.id,{hidden:d,opacity:f})}))};var f=function(b,d){d=d||{};var e=d.proj||a.proj.selected.id,f=[],g=_.filter(c.active,{group:b});return _.each(g,function(a){a.projections[e]&&(d.dynamic&&"daily"!==a.period||d.renderable&&!c.isRenderable(a.id)||d.visible&&!a.visible||f.push(a))}),d.reverse&&(f=f.reverse()),f};return e(),c};var wv=wv||{};wv.layers=wv.layers||{},wv.layers.sidebar=wv.layers.sidebar||function(a,b){var c="<i class='productsIcon selected icon-layers'></i>Layers",d="<i class='productsIcon selected icon-layers' title='Active Layers'></i>Layers",e="<i class='selected icon-events'></i>Events",f="<i class='selected icon-events' title='Events'></i>Events",g="<i class='productsIcon selected icon-download'></i>Data",h="<i class='productsIcon selected icon-download' title='Data'></i>Data",i=!1,j=!1,k=!1,l={};l.id="productsHolder",l.selector="#productsHolder",l.events=wv.util.events();var m=function(){n(),$(window).resize(q),a.proj.events.on("select",r),q(),wv.util.browser.localStorage&&"collapsed"===localStorage.getItem("sidebarState")&&(l.collapseNow(),j=!0)};l.selectTab=function(a){if("active"===a)$(l.selector).tabs("option","active",0);else if("events"===a)$(l.selector).tabs("option","active",1);else{if("download"!==a)throw new Error("Invalid tab: "+a);$(l.selector).tabs("option","active",2)}},l.collapse=function(b){if(!i){i=!0,$(".accordionToggler").removeClass("atcollapse").addClass("dateHolder").removeClass("arrow").addClass("staticLayers"),$(".accordionToggler").attr("title","Show Layer Selector"),$(".accordionToggler").html("Layers ("+a.layers.get().length+")");var c=b?void 0:"fast";$(".products").hide(c),$("#"+l.id).after($(".accordionToggler")),wv.util.browser.localStorage&&localStorage.setItem("sidebarState","collapsed")}},l.collapseNow=function(){l.collapse(!0)},l.expand=function(b){if(i){i=!1,$(".accordionToggler").removeClass("atexpand").addClass("atcollapse").removeClass("staticLayers dateHolder").addClass("arrow"),$(".accordionToggler").attr("title","Hide Layer Selector"),$(".accordionToggler").empty();var c=b?void 0:"fast";$(".products").show(c,function(){a.wv.events.trigger("sidebar-expand")}),$(".accordionToggler").appendTo("#"+l.id+"toggleButtonHolder"),wv.util.browser.localStorage&&localStorage.setItem("sidebarState","expanded")}},l.expandNow=function(){l.expand(!0)},l.toggle=function(){i?(l.expand(),j=!1):(l.collapse(),j=!0)};var n=function(){var a=$(l.selector);a.addClass("products");var d=$("ul#productsHolder-tabs"),e=$("<li></li>").addClass("layerPicker").addClass("first").attr("data-tab","active");$(l.selector+" footer button").hide(),$("#layers-add").show();var g=$("<a></a>").attr("href","#products").addClass("activetab").addClass("tab").html(c);if(e.append(g),d.append(e),b.features.naturalEvents){var i=$("<li></li>").addClass("layerPicker").addClass("second").attr("data-tab","events"),j=$("<a></a>").attr("href","#wv-events").addClass("tab").html(f);i.append(j),d.append(i)}if(b.features.dataDownload){var k=$("<li></li>").addClass("layerPicker").addClass("third").attr("data-tab","download"),m=$("<a></a>").attr("href","#wv-data").addClass("tab").html(h);k.append(m),d.append(k)}var n=$("div#productsHoldertoggleButtonHolder").addClass("toggleButtonHolder"),q=$("<a></a>").addClass("accordionToggler").addClass("atcollapse").addClass("arrow").attr("title","Hide");n.append(q),a.tabs({beforeActivate:p,activate:o}),$(".accordionToggler").bind("click",l.toggle)},o=function(a,b){var c=b.newTab.attr("data-tab");"events"!==c&&"download"!==c||$("#wv-layers-options-dialog").dialog("close"),l.events.trigger("select",b.newTab.attr("data-tab")),a.currentTarget&&a.currentTarget.blur()},p=function(a,b){var i=$(l.selector+" footer"),j=b.newTab.attr("data-tab");if("active"===j)$(".ui-tabs-nav").addClass("firstselected").removeClass("secondselected").removeClass("thirdselected"),$(".ui-tabs-nav li.first").addClass("ui-state-active"),$(".ui-tabs-nav li.second").removeClass("ui-state-active"),$(".ui-tabs-nav li.third").removeClass("ui-state-active"),i.show(),i.find("button").hide(),$("#layers-add").show();else if("events"===j)WVC.GA.event("Natural Events","Click","Events Tab"),$(".ui-tabs-nav").removeClass("firstselected").addClass("secondselected").removeClass("thirdselected"),$(".ui-tabs-nav li.first").removeClass("ui-state-active"),$(".ui-tabs-nav li.second").addClass("ui-state-active"),$(".ui-tabs-nav li.third").removeClass("ui-state-active"),i.hide();else{if("download"!==j)throw new Error("Invalid tab index: "+b.index);$(".ui-tabs-nav").removeClass("firstselected").removeClass("secondselected").addClass("thirdselected"),$(".ui-tabs-nav li.first").removeClass("ui-state-active"),$(".ui-tabs-nav li.second").removeClass("ui-state-active"),$(".ui-tabs-nav li.third").addClass("ui-state-active"),i.show(),i.find("button").hide(),$("#wv-data-download-button").show()}var k="active"===j?c:d,m="events"===j?e:f,n="download"===j?g:h;return l.events.trigger("before-select",j),$(".ui-tabs-nav li.first a").html(k),$(".ui-tabs-nav li.second a").html(m),$(".ui-tabs-nav li.third a").html(n),!0},q=function(){!k&&wv.util.browser.small?(l.collapseNow(),k=!0):!k||wv.util.browser.small||j||(l.expandNow(),k=!1)},r=function(){i&&$(".accordionToggler").html("Layers ("+a.layers.get().length+")")};return m(),l};var wv=wv||{};wv.layers=wv.layers||{},wv.layers.active=wv.layers.active||function(a,b,c){var d=(c.aoi,a.layers),e=wv.util.LAYER_GROUPS,f={},g={};g.id="products",g.selector="#products";var h=function(){i(),d.events.on("add",t).on("remove",s).on("update",w).on("visibility",x),a.proj.events.on("select",A),a.palettes.events.on("set-custom",y).on("clear-custom",y).on("range",y).on("update",z),a.date.events.on("select",C),a.wv.events.on("sidebar-expand",q),$(window).resize(q),b.sidebar.events.on("select",function(a){"active"===a&&q()}),b.map.selected.getView().on("change:resolution",B)},i=function(){f={};var a=$(g.selector),b=$("#layers-add");a.empty(),b.button(),a.addClass("bank"),_.eachRight(e,function(b){j(a,b)}),$(g.selector+" .close").off("click"),$(g.selector+" .hideReg").off("click"),$(g.selector+" .close").on("click",r),$(g.selector+" .hideReg").on("click",u),$("#"+g.id+" ul.category").sortable({items:"li:not(.head)",axis:"y",containment:"parent",tolerance:"pointer",placeholder:"state-saver"}),$("#"+g.id+" ul.category li").disableSelection(),$("#"+g.id+" ul.category").bind("sortstop",v),_.each(d.get({group:"overlays"}),function(a){a.palette&&n(a)}),setTimeout(q,1e3)},j=function(a,b){var c=$("<ul></ul>").attr("id",b.id).addClass("category"),e=$("<h3></h3>").addClass("head").attr("id",b.id+"-header").html(b.description);a.append(e),_.each(d.get({group:b.id}),function(a){k(c,b,a)}),a.append(c)},k=function(b,e,f,h){var i=$("<li></li>").attr("id",e.id+"-"+encodeURIComponent(f.id)).addClass(g.id+"item").addClass("item").attr("data-layer",f.id),j=$("<a></a>").addClass("hdanchor hide hideReg bank-item-img").attr("id","hide"+encodeURIComponent(f.id)).attr("data-layer",f.id).on("click",u),k=$("<i></i>").on("click",function(){j.trigger("click")});if(j.append(k),i.append(j),d.available(f.id)?(i.removeClass("disabled").addClass("layer-enabled").removeClass("layer-hidden"),f.visible?j.attr("title","Hide Layer").attr("data-action","hide").parent().addClass("layer-visible"):j.attr("title","Show Layer").attr("data-action","show").parent().addClass("layer-hidden")):(i.removeClass("layer-visible").addClass("disabled").addClass("layer-hidden"),j.attr("title","No data on selected date for this layer")),i.append($("<div></div>").addClass("zot").append("<b>!</b>")),d.available(f.id)&&(f.visible?j.attr("title","Hide Layer").attr("data-action","hide").parent().addClass("layer-visible"):j.attr("title","Show Layer").attr("data-action","show").parent().addClass("layer-hidden")),D(i,f),c.parameters.metadata&&f.metadata){var n=$("<i></i>").addClass("fa").addClass("fa-info-circle").addClass("fa-1x").addClass("wv-layers-metadata-button").click(function(){wv.layers.metadata(f)});i.append(n)}var o=a.layers.getTitles(f.id),p=$("<a></a>").attr("id","close"+e.id+encodeURIComponent(f.id)).addClass("button close bank-item-img").attr("data-layer",f.id).attr("title","Remove Layer").on("click",r),q=$("<i></i>");p.append(q);var s=$("<a></a>").attr("data-layer",f.id).attr("title","Layer options for "+o.title).addClass("wv-layers-options");s.on("click",l),wv.util.browser.small&&s.hide();var t=$("<i></i>").addClass("wv-layers-options-icon");s.append(t);var v=$("<div></div>").addClass("layer-main").attr("data-layer",f.id).append($("<h4></h4>").html(o.title).attr("title",o.title)).append($("<p></p>").html(o.subtitle));i.hover(function(){d3.select('#timeline-footer svg g.plot rect[data-layer="'+f.id+'"]').classed("data-bar-hovered",!0)},function(){d3.select('#timeline-footer svg g.plot rect[data-layer="'+f.id+'"]').classed("data-bar-hovered",!1)}),v.prepend(s),v.prepend(p),i.append(v),f.palette&&m(i.find(".layer-main"),e,f),h?b.prepend(i):b.append(i)},l=function(b){b.stopPropagation();var d=$("#wv-layers-options-dialog"),e=$(this).attr("data-layer"),f=c.layers[e];0===d.length?wv.layers.options(c,a,f):d.attr("data-layer")!==e?(wv.ui.closeDialog(),wv.layers.options(c,a,f)):wv.ui.closeDialog()},m=function(a,b,c){var d=$("<div></div>").addClass("wv-palette").attr("data-layer",encodeURIComponent(c.id));a.append(d)},n=function(d){var e=".wv-palette[data-layer='"+wv.util.jqueryEscape(d.id)+"']";f[d.id]=wv.palettes.legend({selector:e,config:c,models:a,layer:d,ui:b})},o=!1,p=function(){var a,b=$(window).outerHeight(!0),c=$("ul#productsHolder-tabs").outerHeight(!0),d=$("section#productsHolder footer").outerHeight(!0),e=$("#productsHolder").innerHeight()-$("#productsHolder").height(),f=$("#productsHolder").offset();$("#timeline").outerHeight(!0);a=wv.util.browser.small?b-c-d-f.top-e-10-5:b-c-d-f.top-67-e-10-5,$("section#productsHolder #products").css("max-height",a);var h=$("ul#overlays").outerHeight(!0)+$("ul#baselayers").outerHeight(!0)+26;a<=h?($("#products").css("height",a).css("padding-right","10px"),o?$(g.selector).perfectScrollbar("update"):($(g.selector).perfectScrollbar(),o=!0)):($("#products").css("height","").css("padding-right",""),o&&($(g.selector).perfectScrollbar("destroy"),o=!1))},q=function(){wv.util.browser.small?$(".wv-layers-options").hide():$(".wv-layers-options").show(),p()},r=function(a){var b=$(a.target).attr("data-layer");setTimeout(function(){d.remove(b)},50)},s=function(a){var b="#"+a.group+"-"+wv.util.jqueryEscape(a.id);$(b).remove(),f[a.id]&&delete f[a.id],q()},t=function(a){var b=$("#"+a.group);k(b,e[a.group],a,"top"),a.palette&&n(a),q()},u=function(a){$(this).find(".hideReg");$(this).parent().hasClass("disabled")||("show"===$(this).attr("data-action")?d.setVisibility($(this).attr("data-layer"),!0):d.setVisibility($(this).attr("data-layer"),!1))},v=function(a,b){var c=b.item,e=c.next();e.length?d.moveBefore(c.attr("data-layer"),e.attr("data-layer")):d.pushToBottom(c.attr("data-layer"))},w=function(a,b,c){setTimeout(i,1)},x=function(a,b){var c=$(".hideReg[data-layer='"+a.id+"']");b?c.attr("data-action","hide").attr("title","Hide Layer").parent().removeClass("layer-hidden").addClass("layer-visible"):c.attr("data-action","show").attr("title","Show Layer").parent().removeClass("layer-visible").addClass("layer-hidden"),B()},y=function(a){f[a]&&f[a].update()},z=function(){_.each(f,function(a){a.update()})},A=function(){b.map.selected.getView().on("change:resolution",B),setTimeout(i,1)},B=function(a){_.each(e,function(a){_.each(d.get({group:a.id}),function(a){var b=$('#products li.productsitem[data-layer="'+a.id+'"]');D(b,a)})})},C=function(){$(g.selector);_.each(e,function(a){$("#"+a.id);_.each(d.get({group:a.id}),function(b){var c=$("#"+a.id+"-"+encodeURIComponent(b.id)),e=$("#hide"+encodeURIComponent(b.id));d.available(b.id)?(c.removeClass("layer-visible").removeClass("disabled").addClass("layer-enabled").removeClass("layer-hidden"),b.visible?e.attr("title","Hide Layer").attr("data-action","hide").parent().addClass("layer-visible"):e.attr("title","Show Layer").attr("data-action","show").parent().addClass("layer-hidden")):(c.removeClass("layer-visible").removeClass("layer-enabled").addClass("disabled").addClass("layer-hidden"),e.attr("title","No data on selected date for this layer")),D(c,b)})})},D=function(d,e){var f=b.map,g=f.selected.getView().getZoom(),h=c.sources,i=a.proj.selected.id,j="arctic"==i||"antarctic"==i?1:0,k=e.projections[i].matrixSet;if(void 0!==k){var l=e.projections[i].source,m=h[l].matrixSets[k].resolutions.length-1+j,n=d.find("div.zot");g>m?(n.attr("title","Layer is overzoomed by "+100*(g-m)+"%"),d.hasClass("layer-hidden")||d.hasClass("zotted")?d.hasClass("layer-hidden")&&d.hasClass("zotted")&&d.removeClass("zotted"):d.addClass("zotted")):(n.attr("title","Layer is zoomed by "+100*(g-m)+"%"),d.hasClass("zotted")&&d.removeClass("zotted"))}};return h(),g};var wv=wv||{};wv.layers=wv.layers||{},wv.layers.modal=wv.layers.modal||function(a,b,c){var d=a.layers,e={};e.selector="#layer-modal",e.id="layer-modal";var f,g,h,i,j=$("#layers-add"),k=$(e.selector+" header"),l=$(" #layer-categories "),m=$(e.selector+" #selected-category"),n=$(e.selector+" #layers-all"),o=320,p=a.proj.selected.id,q=React.createFactory(WVC.LayerList),r={},s={},t=function(){_.each(c.layers,function(a){s[a.id]=!0}),d.events.on("remove",O),a.proj.events.on("select",D),Q(),j.click(function(a){$(e.selector).dialog("open")}),$(window).resize(C)},u=$("<nav></nav>").attr("id","categories-nav"),v=$("<nav></nav>").attr("id","category-breadcrumb"),w=function(){"categories"==c.parameters.modalView?console.warn("'Add Layers' view changed to Categories"):"measurements"==c.parameters.modalView?console.warn("'Add Layers' view changed to Measurements"):"layers"==c.parameters.modalView&&console.warn("'Add Layers' view changed to Layers")},x=function(){var a=$(window).width()-.15*$(window).width();g=Math.floor(a/o),g<1&&(g=1),g>3&&(g=3),f=$(window).height()-100};$.fn.hasScrollBar=function(){return this.get(0).scrollHeight>this.height()};var y=function(){x(),$(e.selector).dialog("option",{height:f,width:o*g+10}),$("#layer-modal-main").css("height",f-40).perfectScrollbar("update")},z=function(){$("#layer-modal-main").perfectScrollbar("update")},A=function(a){var b=null;if(a instanceof Array)for(var c=0;c<a.length&&!(b=A(a[c]));c++);else for(var d in a){if("settings"==d)for(var e=0;e<d.length;e+=1){var f=a[d][e];return f}if((a[d]instanceof Object||a[d]instanceof Array)&&(b=A(a[d])))break}return b},B=function(){m.hide(),v.hide(),h=!1,$("#layers-search-input").val(""),$("#layer-search label.search-icon").removeClass("search-on").off("click")},C=function(){$(e.selector).dialog("isOpen")&&y()},D=function(a){B(),E(),z()},E=function(){p=a.proj.selected.id;"categories"==c.parameters.modalView?(crumbText="Categories",F()):"measurements"==c.parameters.modalView?(crumbText="All Measurements",H()):"layers"==c.parameters.modalView?(crumbText="All Layers",I()):"geographic"==p?(crumbText="Categories",F()):(crumbText="All Measurements",H())},F=function(){l.empty(),l.data("isotope")&&l.isotope("destroy"),n.hide(),u.empty(),_.each(c.categories,function(a,b){_.each(c.categories[b],function(a,d){var e,f;if(_.each(a.measurements,function(a,b){var d=c.measurements[a],e=A(d),g=c.layers[e];e==g.id&&Object.keys(g.projections).indexOf(p)>-1&&(f=!0)}),f===!0){a.placement?"first"===a.placement?e=1:"last"===a.placement&&(e=3):e=2;var g=$("<div></div>").attr("data-sort",e).addClass("layer-category layer-category-"+J(b)).attr("id",a.id);a.image&&g.css("background-image",'url("images/wv.layers/categories/'+a.image+'")');var h=$("<div></div>").addClass("category-background-cover");g.append(h);var i=$("<h3></h3>"),j=$("<a></a>").text(a.title).attr("alt",a.title).addClass("layer-category-name").click(function(b){G(a)});i.append(j),h.append(i);var k=$("<ul></ul>");$i=0,_.each(a.measurements,function(b,d){var e,f=c.measurements[b],g=A(f),h=c.layers[g];if(g==h.id&&Object.keys(h.projections).indexOf(p)>-1&&(e=!0),e===!0){if($i++,$i>6&&L(a,k),void 0===c.measurements[b])throw new Error("Error: Measurement '"+b+"' stated in category '"+a.title+"' does not exist in measurement list!");
var i=$("<a></a>").attr("data-category",a.id).attr("data-measurement",f.id).attr("title",a.title+" - "+f.title).text(f.title);i.click(function(b){G(a,f.id,d)});var j=$("<li></li>").addClass("layer-category-item");j.append(i),k.append(j)}}),h.append(k),l.append(g),v.show()}}),l.show();var d=$("<input />").attr("type","radio").text(K(b)),e=$("<label></label>").text(K(b));d.attr("id","button-filter-"+J(b)).attr("data-filter",J(b)).click(function(a){l.isotope({filter:".layer-category-"+J(b)}),u.find(".ui-button").removeClass("nav-selected"),$("label[for="+$(this).attr("id")+"]").addClass("nav-selected")}),e.attr("for","button-filter-"+J(b)),u.append(d),u.append(e),u.buttonset(),u.show()}),l.isotope({itemSelector:".layer-category",getSortData:{name:".layer-category-name",order:"[data-sort]"},sortBy:["order","name"],filter:".layer-category-legacy",masonry:{gutter:10}}),$("#layer-modal-main").prepend(u),$("label[for=button-filter-legacy]").addClass("nav-selected")},G=function(a,b,e){m.empty(),v.empty();var f=$("<div></div>").attr("id",a.id+"-list");_.each(a.measurements,function(b,e){var g,h=c.measurements[b],i=A(h),j=c.layers[i];if(i==j.id&&Object.keys(j.projections).indexOf(p)>-1&&(g=!0),g===!0){var k=$("<div></div>").attr("id","accordion-"+a.id+"-"+h.id),l=$("<h3></h3>").text(h.title),m=$("<h5></h5>").text(h.subtitle),n=$("<ul></ul>"),o=$("<div></div>");o.append(n),_.each(h.sources,function(a,b){var e;if(_.each(a.settings,function(a){var b=c.layers[a];b.id==a&&Object.keys(b.projections).indexOf(p)>-1&&(e=!0)}),e===!0){var f=$("<li></li>"),g=$("<a></a>").text(a.title).attr("href","#"+h.id+"-"+a.id);f.append(g),n.append(f);var i=$("<div></div>").attr("id",h.id+"-"+a.id),j=$("<div></div>").addClass("source-metadata"),k=$("<div></div>").addClass("metadata-more"),l=$("<span></span>").addClass("ellipsis").text("...");k.append(l),k.toggle(function(a){j.removeClass("overflow"),l.text("^").addClass("up"),z()},function(a){j.addClass("overflow"),l.text("...").removeClass("up"),z()}),a.description&&$.get("config/metadata/"+a.description+".html").success(function(a){j.html(a),i.append(j),j.find("a").attr("target","_blank"),j.text().length>1e3&&j.addClass("overflow").after(k)});var m=$("<ul></ul>").addClass("source-settings"),q=$("<ul></ul>").addClass("source-orbit-tracks").attr("id",a.id+"-orbit-tracks");if(_.each(a.settings,function(a){var b=c.layers[a];if(b.id==a&&Object.keys(b.projections).indexOf(p)>-1){var e=$("<li></li>").attr("data-layer",encodeURIComponent(b.id)).attr("value",encodeURIComponent(b.id)).addClass("measurement-settings-item"),f=$("<input></input>").attr("type","checkbox").addClass("settings-check").attr("id","setting-"+b.id).attr("value",encodeURIComponent(b.id)).attr("data-layer",encodeURIComponent(b.id)).on("ifChecked",M).on("ifUnchecked",N);_.find(d.active,{id:b.id})&&f.attr("checked","checked");var g=$("<label></label>").attr("for","setting-"+encodeURIComponent(b.id)).text(b.title);if(e.append(f).append(g),b.title.indexOf("Orbital Track")!==-1){var h;if(b.title.indexOf("(")!==-1){var i=/\(([^)]+)\)/,j=i.exec(b.title);h=j[1]}g.empty().text(h),q.append(e)}else m.append(e);e.click(function(a){a.stopPropagation();var c=$(this).find("input#setting-"+b.id);c.iCheck("toggle")})}}),i.append(m),q.children().length>0){var r=$("<h3></h3>").addClass("source-orbits-title").text("Orbital Tracks:");i.append(r),i.append(q)}o.append(i)}}),o.tabs(),k.append(l),k.append(m),f.append(k),f.append(o)}}),f.accordion({collapsible:!0,heightStyle:"content",animate:!1,active:!1,activate:function(a,b){z()}}),b&&f.accordion("option","active",e),m.append(f);var g=$("<a></a>").text(crumbText).attr("alt","categories").attr("title","Back to Layer Categories").click(D);v.append(g).append("<b> / "+a.title+"</b>"),m.prepend(v),$("#layers-search-input").show(),l.hide(),u.hide(),n.hide(),m.show(),z(),m.iCheck({checkboxClass:"icheckbox_square-red"})},H=function(){_.each(c.categories,function(a,b){_.each(c.categories[b],function(a,b){"legacy-all"==a.id&&G(a)})})};e.readySearch=function(){return i=c.layerOrder,q({onClick:function(){},layerArray:i,layers:c.layers,style:"background: #000;"})};var I=function(){var a;if(n.empty(),$("#layers-all").css("height",f-40-30),a=e.readySearch(),e.reactList=ReactDOM.render(a,n[0]),m.hide(),l.hide(),u.hide(),n.show(),v.empty(),h){var b=$("<a></a>").text(crumbText).attr("alt",crumbText).attr("title","Back to "+crumbText).click(D);v.append(b).append("<b> / Search Results</b>"),n.prepend(v),$("#layers-search-input").show(),$("label.search-icon").addClass("search-on"),$("label.search-on").click(D),v.show()}},J=function(a){return"hazards and disasters"===a?"legacy":a},K=function(a){return"scientific"===a?"science disciplines":a},L=function(a,b){var c=$("<li></li>").addClass("layer-category-item"),d=$("<a></a>").attr("data-category",a.id).text("...");d.click(function(b){G(a)}),c.append(d),b.append(c)},M=function(a){a.stopPropagation(),d.add(decodeURIComponent($(this).val()))},N=function(a){a.stopPropagation(),d.remove(decodeURIComponent($(this).val()))},O=function(a){var b=$(e.selector+" [data-layer='"+wv.util.jqueryEscape(a.id)+"']");b.iCheck("uncheck")},P=function(){wv.util.browser.small?($("#layers-search-input").blur(),$("#layer-modal-main").focus()):$("#layers-search-input").focus()},Q=function(){w(),x(),$("#layer-modal-main").css("height",f-40).perfectScrollbar();var a=$("<div></div>").attr("id","layer-search"),b=$("<input></input>").attr("id","layers-search-input").attr("placeholder","Search"),c=$("<label></label>").addClass("search-icon").click(function(a){}).append("<i></i>");a.append(c).append(b),k.append(a);var d=$("<div></div>").attr("id","layers-modal-close").click(function(a){$(e.selector).dialog("close")}).append("<i></i>");k.append(d),$(e.selector).dialog({autoOpen:!1,resizable:!1,height:f,width:o*g+10,modal:!0,dialogClass:"layer-modal no-titlebar",draggable:!1,title:"Layer Picker",show:{effect:"fade",duration:400},hide:{effect:"fade",duration:200},open:function(a,b){y(),l.data("isotope")&&l.isotope().on("layoutComplete",function(a,b){z()}),$(".ui-widget-overlay").click(function(a){$(e.selector).dialog("close")}),setTimeout(P,410)},close:function(a,b){$(".ui-widget-overlay").unbind("click")}}),b.keyup(V),D()},R=function(){var a=$("#layers-search-input").val().toLowerCase(),b=a.split(/ +/);return b},S=function(b){return!b.projections[a.proj.selected.id]},T=function(b,d){var f=$(e.selector+"search").val();if(""===f)return!1;var g=!1,h=a.layers.getTitles(b.id);return $.each(d,function(a,d){if(g=!(h.title.toLowerCase().contains(d)||h.subtitle.toLowerCase().contains(d)||h.tags.toLowerCase().contains(d)||c.layers[b.id].id.toLowerCase().contains(d)))return!1}),g},U=_.throttle(function(){var a=R(),b=[];$.each(c.layers,function(c,d){var e=S(d),f=T(d,a),g=e||f;g||b.push(c)}),r.layerList=b,layerWidget=q({onState:d.add,offState:d.remove,layerArray:b,layers:c.layers}),e.reactList=ReactDOM.render(layerWidget,n[0]),z()},250,{trailing:!0}),V=function(a){0!==$("#layers-search-input").val().length?h=!0:(h=!1,E(),B()),h?("none"!==n.css("display")&&"none"!==v.css("display")||I(),U()):E()};return t(),e};var wv=wv||{};wv.layers=wv.layers||{},wv.layers.options=wv.layers.options||function(a,b,c){var d,e,f,g,h={},i=0,j=function(){g=document.createElement("canvas"),g.width=120,g.height=10,a.features.customPalettes?wv.palettes.loadCustom(a).done(k):k()},k=function(e){if(d=wv.ui.getDialog(),d.attr("id","wv-layers-options-dialog").attr("data-layer",c.id),m(d),a.features.customPalettes&&b.palettes.allowed(c.id)&&b.palettes.getLegends(c.id).length<2){var g=b.palettes.getLegend(c.id,i);"continuous"===g.type||"discrete"===g.type?(o(d),t(d)):1===b.palettes.getDefaultLegend(c.id,i).colors.length&&t(d)}var h=b.layers.getTitles(c.id);d.dialog({dialogClass:"wv-panel",title:h.title,show:{effect:"slide",direction:"left"},width:300,height:"auto",position:{my:"left top",at:"right+5 top",of:$("#products")},close:l}),$("#wv-squash-button-check").addClass("custom-check"),$("#wv-palette-selector").addClass("custom-check"),$("#wv-layers-options-dialog .custom-check").iCheck({radioClass:"iradio_square-grey",checkboxClass:"icheckbox_square-grey"}),$("#wv-layers-options-dialog #wv-palette-selector").each(function(){$(this).perfectScrollbar("update")}),$("#wv-squash-button-check").on("ifChanged",function(){var a=$("#wv-squash-button-check").prop("checked"),d=f;b.palettes.setRange(c.id,parseFloat(d.val()[0]),parseFloat(d.val()[1]),a,i)}),b.layers.events.on("remove",A).on("opacity",n),b.palettes.events.on("range",q).on("update",s)},l=function(){b.layers.events.off("remove",A).off("opacity",n),b.palettes.events.off("range",q).off("update",s),d=null,wv.ui.closeDialog()},m=function(a){var d=$("<div></div>").html("Opacity").addClass("wv-header"),f=$("<div></div>").noUiSlider({start:c.opacity,step:.01,range:{min:0,max:1}}).on("slide",function(){b.layers.setOpacity(c.id,parseFloat($(this).val()))}),g=$("<div></div>").addClass("wv-label").addClass("wv-label-opacity");a.append(d),a.append(f),a.append(g),e=f,n(c,c.opacity)},n=function(a,b){if(a.id===c.id){var d=(100*b).toFixed(0)+"%";$("#wv-layers-options-dialog .wv-label-opacity").html(d),e.val()!==b&&e.val(b)}},o=function(){var a=$("<div></div>").html("Thresholds").addClass("wv-header"),b=$("<div></div>").addClass("wv-palette-squash"),c=$("<input></input>").attr("type","checkbox").attr("id","wv-squash-button-check"),e=$("<label></label>").attr("for","wv-squash-button-check").attr("title","Squash Palette").html("Squash Palette");b.append(c).append(e);var f=$("<div></div>").addClass("wv-layer-options-threshold");d.append(a),d.append(b),d.append(f),p()},p=function(){var a=b.palettes.get(c.id,i),d=a.entries.values.length-1,e=a.min||0,g=a.max||d,h=$("<div></div>").noUiSlider({start:[e,g],step:1,range:{min:0,max:d}}).on("set",function(){var a=$("#wv-squash-button-check").prop("checked");b.palettes.setRange(c.id,parseFloat($(this).val()[0]),parseFloat($(this).val()[1]),a,i)}).on("slide",function(){r(parseFloat($(this).val()[0]),parseFloat($(this).val()[1]))}),j=$("<div>&nbsp;</div>").addClass("wv-label");j.append($("<span></span>").addClass("wv-label-range-min")),j.append($("<span></span>").addClass("wv-label-range-max")),$(".wv-layer-options-threshold").empty().append(h).append(j),f=h,f=h,q()},q=function(){r();var a=b.palettes.get(c.id,i),d=_.isUndefined(a.min)?0:a.min,e=_.isUndefined(a.max)?a.legend.tooltips.length-1:a.max;current=[parseFloat(f.val()[0]),parseFloat(f.val()[1])],_.isEqual(current,[d,e])||f.val([d,e]),a.squash?$("#wv-squash-button-check").iCheck("check"):$("#wv-squash-button-check").iCheck("uncheck")},r=function(a,d){var e=b.palettes.get(c.id,i),f=b.palettes.getLegend(c.id,i);a=a||e.min||0,d=d||e.max||f.tooltips.length-1;var g=f.units?f.tooltips[a]+" "+f.units:f.tooltips[a],h=f.units?f.tooltips[d]+" "+f.units:f.tooltips[d];$("#wv-layers-options-dialog .wv-label-range-min").html(g),$("#wv-layers-options-dialog .wv-label-range-max").html(h)},s=function(){q(),v()},t=function(a){var b=$("<div></div>").addClass("wv-header").addClass("wv-color-palette-label").html("Color Palette"),c=$("<div></div>").attr("id","wv-palette-selector");a.append(b).append(c),u(!0)},u=function(e){var f=$("#wv-palette-selector").empty();f.append(y());var g=c.palette.recommended||[];_.each(g,function(a){var b=z(a);b&&f.append(b)}),_.each(a.paletteOrder,function(a){if(_.indexOf(g,a)<0){var b=z(a);b&&f.append(b)}}),d.append(f),f.perfectScrollbar();var h=b.palettes.get(c.id,i);h.custom?$(".wv-palette-selector-row input[data-palette='"+h.custom+"']").iCheck("check"):$(".wv-palette-selector-row input[data-palette='__default']").iCheck("check"),$("#wv-palette-selector input").on("ifChecked",function(){var a=this;setTimeout(function(){var d=$(a).attr("data-palette");"__default"===d?b.palettes.clearCustom(c.id,i):b.palettes.setCustom(c.id,d,i)},0)}),e||$("#wv-palette-selector").iCheck({radioClass:"iradio_square-grey"})},v=function(){var a=b.palettes.get(c.id,i);a.custom?$("#wv-palette-selector input[data-palette='"+a.custom+"']").iCheck("check"):$("#wv-palette-selector input[data-palette='__default']").iCheck("check")},w=function(a,b,c){wv.palettes.colorbar(g,a);var d=$("<div></div>").addClass("wv-palette-selector-row"),e=$("<input></input>").attr("type","radio").attr("id","wv-palette-radio-"+b).attr("name","wv-palette-radio").attr("data-palette",b),f=$("<label></label>").attr("for","wv-palette-radio-"+b),h=$("<img></img>").attr("src",g.toDataURL("image/png")),i=$("<span></span>").addClass("wv-palette-label").html(c);return f.append(h),f.append(i),d.append(e),d.append(f),d},x=function(a,b,c){var d=$("<div></div>").addClass("wv-palette-selector-row"),e=$("<input></input>").attr("type","radio").attr("id","wv-palette-radio-"+b).attr("name","wv-palette-radio").attr("data-palette",b),f=a.classes?a.classes.colors[0]:a.colors[0],g=$("<label></label>").attr("for","wv-palette-radio-"+b),h=$("<span></span>").addClass("wv-palettes-class").css("background-color",wv.util.hexToRGB(f)).html("&nbsp;"),i=$("<span></span>").html(c).addClass("wv-palette-label");return g.append(h),g.append(i),d.append(e),d.append(g),d},y=function(){var a=b.palettes.getDefaultLegend(c.id,i);return"continuous"===a.type||"discrete"===a.type?w(a.colors,"__default","Default"):x(a,"__default","Default")},z=function(a){var d=b.palettes.getDefaultLegend(c.id,i),e=b.palettes.getCustom(a),f=1===e.colors.length?"classification":"continuous";if("continuous"===d.type&&"continuous"===f||"discrete"===d.type&&"continuous"===f){var g=wv.palettes.translate(d.colors,e.colors);return w(g,a,e.name)}if("classification"===d.type&&"classification"===f)return x(e,a,e.name)},A=function(a){c.id===a.id&&d&&d.dialog("close")};return j(),h};var wv=wv||{};wv.image=wv.image||{},wv.image.rubberband=wv.image.rubberband||function(a,b,c){var d,e,f={},g="One or more layers on the map have been modified (changed palette, thresholds, etc.). These modifications cannot be used to take a snapshot. Would you like to temporarily revert to the original layer(s)?",h="The graticule layer cannot be used to take a snapshot. Would you like to hide this layer?",i="Image may not be downloaded when rotated. Would you like to reset rotation?",j="wv-image-button",k="#"+j,l=null,m=null,n=$("#wv-map"),o="off",p=null,q=null;f.events=wv.util.events();var r=function(){if(d=document.getElementById(j),null===d)throw new Error("Error: element '"+j+"' not found!");e=$("<input></input>").attr("type","checkbox").attr("id","wv-image-button-check").val("");var a=$("<label></label>").attr("for","wv-image-button-check").attr("title","Take a snapshot"),b=$("<i></i>").addClass("fa").addClass("fa-camera").addClass("fa-2x");a.append(b),$(k).append(a),$(k).append(e),e.button({text:!1}),e.on("click",t)},s=function(a){$("#wv-info-button input").button(a),$("#wv-proj-button input").button(a),$("#wv-link-button input").button(a)},t=function(){var c=($("#wv-image-button-check").prop("checked"),"geographic"===a.proj.selected.id),d=function(){o="on",s("disable"),f.events.trigger("show"),$(".ui-dialog").on("dialogclose",function(){"on"===o&&t(),document.activeElement.blur()}),v()},j=function(){b.map.selected.getView().animate({rotation:0,duration:400})},k=function(){b.map.selected;q=a.palettes.active,a.palettes.clear(),t()},l=function(){a.layers.setVisibility("Graticule",!1),t()};if("off"==o){var m=a.layers.get({renderable:!0});if(_.find(m,{id:"Graticule"})&&c)return void wv.ui.ask({header:"Notice",message:h,onOk:l,onCancel:function(){e.prop("checked",!1).button("refresh")}});if(a.palettes.inUse())return void wv.ui.ask({header:"Notice",message:g,onOk:k,onCancel:function(){e.prop("checked",!1).button("refresh")}});0===b.map.selected.getView().getRotation()?d():wv.ui.ask({header:"Reset rotation?",message:i,onOk:function(){j(),setTimeout(t,500)}})}else o="off",e.prop("checked",!1).button("refresh"),n.insertAfter("#productsHolder"),p.destroy(),c&&b.map.events.trigger("selectiondone"),q&&(a.palettes.restore(q),q=null),s("enable"),wv.ui.closeDialog(),$(".wv-image-coords").hide()},u=function(a){m=l,l=a,f.events.trigger("update",l)},v=function(){n.Jcrop({bgColor:"black",bgOpacity:.3,onSelect:function(a){m=l,w(a)},onChange:function(a){w(a)},onRelease:function(a){l=m,t()},fullScreen:!0}),p=n.data("Jcrop"),"geographic"===a.proj.selected.id&&b.map.events.trigger("selecting"),l?p.setSelect([l.x,l.y,l.x2,l.y2]):p.setSelect([$(window).width()/2-100,$(window).height()/2-100,$(window).width()/2+100,$(window).height()/2+100])},w=function(a){u(a)};return r(),f};var wv=wv||{};wv.image=wv.image||{},wv.image.panel=wv.image.panel||function(a,b,c){var d,e,f,g,h={},i=c.alignTo,j="imagedownload",k=j,l="1",m="image/jpeg",n="false",o=-1;c.features.imageDownload?(f=c.features.imageDownload.host,g=c.parameters.imagegen||c.features.imageDownload.path):(f="http://map2.vis.earthdata.nasa.gov",g="imagegen/index.php"),url=f+"/"+g+"?",c.parameters.imagegen&&wv.util.warn("Redirecting image download to: "+url);var p=function(){b.rubberband.events.on("update",s),b.rubberband.events.on("show",q)},q=function(){if(i={id:"wv-image-button"},d=document.getElementById(j),null===d)throw new Error("Error: element '"+j+"' not found!");d.setAttribute("class","imagedownload"),r(),$(window).resize(r);var b="<div class='wv-image-header'><select id='wv-image-resolution'><option value='0.125'>30m</option><option value='0.25'>60m</option><option value='0.5'>125m</option><option value='1' selected>250m</option><option value='2'>500m</option><option value='4'>1km</option><option value='20'>5km</option><option value='40'>10km</option></select>Resolution (per pixel)</div><div class='wv-image-header'><select id='wv-image-format'><option value='image/jpeg'>JPEG</option><option value='image/png'>PNG</option><option value='image/geotiff'>GeoTIFF</option><option value='image/kmz'>KMZ</option></select>Format</div><div class='wv-image-header'><select id='wv-image-worldfile' > <option value='false'>No</option><option value='true'>Yes</option></select>Worldfile (.zip)</div><table class='wv-image-download'><tr><th>Raw Size</th><th>Maximum</th></tr><tr><td id='wv-image-size' class='wv-image-size'>000.00MB</td><td class='wv-image-size'>250 MB</td></tr><tr><td><span id='wv-image-width'>0000</span> x <span id='wv-image-height'>0000</span> px</td><td><button id='wv-image-download-button'>Download</button></tr></table></div>",c=wv.ui.getDialog().html(b);c.dialog({dialogClass:"wv-panel wv-image",title:"Take a snapshot",show:{effect:"slide",direction:"up"},hide:{effect:"slide",direction:"up"},width:230,height:"auto",minHeight:10,draggable:!1,resizable:!1,autoOpen:!1}),$("#wv-image-download-button").button(),$(".ui-dialog").zIndex(600),"geographic"!==a.proj.selected.id&&($("#wv-image-format [value='image/kmz']").remove(),$("#wv-image-resolution [value='0.5']").remove(),$("#wv-image-resolution [value='0.25']").remove(),$("#wv-image-resolution [value='0.125']").remove());var f=Math.round(wvx.ui.map.selected.getView().getZoom());if(f!=o){o=f;for(var g=a.proj.selected.resolutions.length,h=f>=g?a.proj.selected.resolutions[g-1]:a.proj.selected.resolutions[f],k="geographic"==a.proj.selected.id?h/.002197265625:h/256,p="geographic"==a.proj.selected.id?[.125,.25,.5,1,2,4,20,40]:[1,2,4,20,40],q=1/0,t=-1,u=0,v=0;v<p.length;v++)u=Math.abs(p[v]-k),u<q&&(l=p[v],q=u,t=v);if(t>0)if("geographic"==a.proj.selected.id)switch(f){case 3:case 4:case 6:case 7:l=p[t-1]}else switch(f){case 1:case 2:case 4:case 5:l=p[t-1]}}$("#wv-image-format").change(function(){m=$("#wv-image-format option:checked").val(),s(e)}),$("#wv-image-worldfile").change(function(){n=$("#wv-image-worldfile option:checked").val(),s(e)}),$("#wv-image-resolution option").removeAttr("selected"),$("#wv-image-resolution option[value='"+l+"']").attr("selected","selected"),$("#wv-image-format option").removeAttr("selected"),$("#wv-image-format option[value='"+m+"']").attr("selected","selected"),$("#wv-image-worldfile option").removeAttr("selected"),$("#wv-image-worldfile option[value='"+n+"']").attr("selected","selected"),wv.ui.positionDialog(c,{my:"left top",at:"left bottom+5",of:"#wv-image-button"}),c.dialog("open"),$(".wv-image-coords").show()},r=function(){var a=$("#"+i.id).offset(),b=a.left+parseInt($("#"+i.id).css("width"))-parseInt($("#"+k).css("width"));$("#"+k).css("left",b+"px")},s=function(c){try{e=c;var d=b.map.selected,f=a.date.selected,g=e,h=a.proj.selected.id,i=a.layers.get({reverse:!0,renderable:!0}),j=a.proj.change?a.proj.change.epsg:a.proj.selected.epsg,k=[];_(i).each(function(a){k.push(_.isUndefined(a.opacity)?1:a.opacity)});var m=g,n=m.x,o=m.y,p=m.x2,q=m.y2,r=a.proj.selected.crs,s=d.getCoordinateFromPixel([Math.floor(n),Math.floor(q)]),t=d.getCoordinateFromPixel([Math.floor(p),Math.floor(o)]),u=ol.proj.transform(s,r,"EPSG:4326"),v=ol.proj.transform(t,r,"EPSG:4326"),w=u[0],x=v[0],y=v[1],z=u[1],A=wv.util.formatCoordinate([w,z]),B=wv.util.formatCoordinate([x,y]);p-n<150&&(A="",B=""),$("#wv-image-top").css({left:n-10,top:o-20,width:p-n}).html(B),$("#wv-image-bottom").css({left:n,top:q,width:p-n}).html(A);var C=url,D=256;"geographic"==h&&(D=.002197);var E=f,F=wv.util.parseDateUTC(E.getUTCFullYear()+"-01-01"),G="00"+(1+Math.ceil((E.getTime()-F)/864e5));C+="TIME="+E.getUTCFullYear()+G.substr(G.length-3),C+="&extent="+s[0]+","+s[1]+","+t[0]+","+t[1],C+="&epsg="+j;var H=[];_.each(i,function(a){a.projections[h].layer?H.push(a.projections[h].layer):H.push(a.id)}),C+="&layers="+H.join(","),C+="&opacities="+k.join(",");var I,J,K=0,L=0;$("#wv-image-resolution").unbind("change").change(function(){imgRes=$("#wv-image-resolution option:checked").val(),l=imgRes,K=Math.round(Math.abs(t[0]-s[0])/D/Number(imgRes)),L=Math.round(Math.abs(t[1]-s[1])/D/Number(imgRes)),imgFilesize=(K*L*24/8388608).toFixed(2),I=$("#wv-image-format option:checked").val(),J=$("#wv-image-worldfile option:checked").val();var a,b=imgFilesize>250||0===L||0===K;b?(a="<i class='fa fa-times fa-fw'></i>",$(".wv-image-size").addClass("wv-image-size-invalid"),$("#wv-image-download-button").button("disable")):(a="<i class='fa fa-check fa-fw'></i>",$(".wv-image-size").removeClass("wv-image-size-invalid"),$("#wv-image-download-button").button("enable")),$("#wv-image-width").html(K),$("#wv-image-height").html(L),$("#wv-image-size").html(a+imgFilesize+" MB")}).change(),$("#wv-image-download-button").unbind("click").click(function(){WVC.GA.event("Image Download","Click","Download"),wv.util.metrics("lc="+encodeURIComponent(C+"&worldfile="+J+"&format="+I+"&width="+K+"&height="+L)),window.open(C+"&worldfile="+J+"&format="+I+"&width="+K+"&height="+L,"_blank")})}catch(a){wv.util.error(a)}};return p(),h};var wv=wv||{};wv.notifications=wv.notifications||{},wv.notifications.ui=wv.notifications.ui||function(a,b){var c,d,e,f,g,h={},i={},j={};g=b.features.alert.url,h.events=wv.util.events(),h.infoIconActive=!1,h.notifyIconActive=!1,h.messageIconActive=!1;var k={alert:"bolt",message:"gift",outage:"exclamation-circle"},l=function(){var a;d=$("#wv-info-button i")[0],e=$("#wv-info-button")[0],a=wv.util.get(g),a.then(function(a){var b,c;b=JSON.parse(a),c=b.notifications,i=o(c),m(i),q()},function(a){console.warn(a)})},m=function(a){var b,d,e;b=a.messages[0],d=a.outages[0],e=a.alerts[0],b&&!n(b)&&(c="message",f=b.id),e&&!n(e)&&(c="alert",j.alert=e.id),d&&!n(d)&&(c="outage",j.outage=d.id)},n=function(a){var b,c,d,e;return d=a.notification_type,e=a.id.toString(),b=wv.util.isInLocalStorage(d),c=!1,b&&(c=w(d,e)),c},o=function(a){for(var b,c,d=[],e=[],f=[],g=0,h=a.length;g<h;g++)c=a[g],b=c.notification_type,"message"===b?d.push(c):"alert"===b?e.push(c):f.push(c);return{messages:p(d),alerts:p(e),outages:p(f)}},p=function(a){return a.sort(function(a,b){return new Date(b.created_at)-new Date(a.created_at)}),a},q=function(){c?(d.className="fa fa-2x fa-"+k[c],e.className="wv-toolbar-button "+k[c]):(d.className="fa fa-2x fa-info-circle",e.className="wv-toolbar-button")};h.getMessages=function(){var a;return i.messages?f?(a=$("<li class='gift'><a><i class='ui-icon fa fa-fw fa-gift active'></i>What's New</a></li>"),a.on("click",r),h.messageIconActive=!0,a):i.messages[0]?(a=$("<li><a><i class='ui-icon fa fa-fw fa-gift'></i>What's New</a></li>"),a.on("click",r),a):null:null},h.getAlert=function(){var a;return _.isEmpty(j)?_.isEmpty(i.alerts)&&_.isEmpty(i.outages)?null:(a=$("<li><a><i class='ui-icon fa fa-fw fa-bolt'></i>Notifications</a></li>"),a.on("click",s),a):(a=$("<li class='"+k[c]+"'><a><i class='ui-icon fa fa-fw active fa-"+k[c]+"'></i>Notifications</a></li>"),h.infoIconActive=!0,h.notifyIconActive=!0,a.on("click",s),a)};var r=function(a){var b;this.className="ui-icon fa fa-fw fa-gift",h.messageIconActive=!1,wv.util.localStorage("message",f),f=null,b=i.messages[0],b&&x(b,"Latest Release"),"message"===c&&(c=null),q()},s=function(a){this.className="ui-icon fa fa-fw fa-bolt",h.infoIconActive=!1,h.notifyIconActive=!1,c=null,t(),j.outage&&wv.util.localStorage("outage",j.outage),j.alert&&wv.util.localStorage("alert",j.alert),j={},h.messageIconActive&&(c="message"),q()},t=function(){var a,b,c=$('<div class="wv-notify-modal"></div>');return i.alerts||i.outages?(b=u(),c.append(v(i.outages,"outage")),c.append(v(i.alerts,"alert")),a=wv.ui.getDialog().append(c),void a.dialog({title:"Notifications",width:b[0],height:b[1],maxHeight:525,show:{effect:"fade"},hide:{effect:"fade"}})):null},u=function(){return width=625,height="auto",(wv.util.browser.small||wv.util.browser.touchDevice)&&(width=$(window).width(),height=$(window).height()),[width,height]},v=function(a,b){for(var c,d,e,f=$("<ul></ul>"),g=0,h=a.length;g<h;g++)e="",j[b]&&0===g&&(e=b),d=new Date(a[g].created_at),d=d.getDate()+" "+wv.util.giveMonth(d)+" "+d.getFullYear(),c=$("<li><div class='"+e+"'><h2> <i class='fa fa-"+k[b]+"'/> "+b+"<span> Posted "+d+"</span></h2><p>"+a[g].message+"</p></div></li>"),f.append(c);return f},w=function(a,b){var c=localStorage.getItem(a);return b<=c},x=function(a,c){var d,e,f,g;g=new Date(a.created_at),g=g.getDate()+" "+wv.util.giveMonth(g)+" "+g.getFullYear(),f=b.features.alert.releases||"https://github.com/nasa-gibs/worldview/releases",dimensions=u(),e=$("<div class='wv-notify-modal'><div><h2>"+c+"<span> Posted "+g+"</span></h2><p>"+a.message+"</p></div></div>"),$footer=$('<div class="wv-notify-footer"><p> Check out our <a target="_blank" href="'+f+'">release notes</a> for a complete list of new additions.</p></div>'),e.append($footer),d=wv.ui.getDialog().append(e),d.dialog({title:"What's New",width:dimensions[0],height:dimensions[1],maxHeight:525,show:{effect:"fade"},hide:{effect:"fade"}})};return l(),h};var wv=wv||{};wv.palettes=function(a){var b;a.supported=!0;var c=function(){var b=wv.util.browser;!b.ie&&b.webWorkers&&b.cors?d():a.supported=!1};a.colorbar=function(a,c){var d;if(d=a.length?$(a).get(0):a){var e=d.getContext("2d");if(e.fillStyle=b,e.fillRect(0,0,d.width,d.height),c){var f=c.length,g=d.width/f,h=Math.ceil(g);_.each(c,function(a,b){e.fillStyle=wv.util.hexToRGBA(a),e.fillRect(Math.floor(g*b),0,h,d.height)})}}};var d=function(){var a=2,c=document.createElement("canvas");c.width=2*a,c.height=2*a;var d=c.getContext("2d");d.fillStyle="rgb(200, 200, 200)",d.fillRect(0,0,a,a),d.fillRect(a,a,a,a),d.fillStyle="rgb(240, 240, 240)",d.fillRect(0,a,a,a),d.fillRect(a,0,a,a),b=d.createPattern(c,"repeat")};return a.translate=function(a,b){var c=[];return _.each(a,function(d,e){var f=e/a.length,g=Math.floor(f*b.length);c.push(b[g])}),c},a.lookup=function(a,b){var c={};return _.each(a.colors,function(a,d){var e=parseInt(a.substring(0,2),16)+","+parseInt(a.substring(2,4),16)+","+parseInt(a.substring(4,6),16)+",255",f=b.colors[d],g={r:parseInt(f.substring(0,2),16),g:parseInt(f.substring(2,4),16),b:parseInt(f.substring(4,6),16),a:255};c[e]=g}),c},a.loadCustom=function(a){return wv.util.load.config(a.palettes,"custom","config/palettes-custom.json")},a.loadRendered=function(a,b){var c=a.layers[b];return wv.util.load.config(a.palettes.rendered,c.palette.id,"config/palettes/"+c.palette.id+".json")},a.requirements=function(b,c){var d=[];if(c.palettes={rendered:{},custom:{}},_.each(b.l,function(b){var e=b.id;c.layers[e]&&c.layers[e].palette&&d.push(a.loadRendered(c,e));var f=_.find(b.attributes,{id:"palette"});f&&d.push(a.loadCustom(c))}),d.length>0){var e=$.Deferred();return $.when.apply(null,d).then(e.resolve).fail(e.reject),e}},a.parse=function(a,b,c){if(a.palettes){if(!wv.palettes.supported)return delete a.palettes,void wv.ui.notify("The custom palette feature is not supported with your web browser. Upgrade or try again in a different browser");var d=a.palettes.split("~");_.each(d,function(d){var e=d.split(","),f=e[0],g=e[1];if(c.layers[f])if(c.layers[f].palette){var h=_.find(a.l,{id:f});h?h.attributes.push({id:"palette",value:g}):b.push({message:"Layer "+f+" is not active"})}else b.push({message:"Layer "+f+" does not support palettes"});else b.push({message:"Invalid layer for palette "+g+": "+f})}),delete a.paletes}},c(),a}(wv.palettes||{});var wv=wv||{};wv.palettes=wv.palettes||{},wv.palettes.legend=wv.palettes.legend||function(a){var b=a.selector,c=a.config,d=(a.models,a.models.palettes),e=a.ui,f=a.layer,g=!1,h=!1,i={},j=function(){var b=f.palette.id;c.palettes.rendered[b]?(g=!0,k()):wv.palettes.loadRendered(c,f.id).done(function(){g||(g=!0,k(),a.onLoad&&a.onLoad())})},k=function(){var a=$(b),e=f.palette.id,g=(c.palettes.rendered[e],$("<div></div>").addClass("wv-palettes-panel").attr("data-layer",f.id));a.append(g);var h=d.getLegends(f.id);_.each(h,function(a,b){"continuous"!==a.type&&"discrete"!==a.type||l(g,a,b,f.id),"classification"===a.type&&m(g,a,b)}),i.update()},l=function(a,c,d,e){$container=$("<div></div>").addClass("wv-palettes-legend").attr("data-index",d),$colorbar=$("<canvas></canvas>").addClass("wv-palettes-colorbar").attr("id",c.id).attr("data-index",d),$colorbar[0].width=235,$colorbar[0].height=12,$container.append($colorbar);var f=$("<div></div>").addClass("wv-running-bar"),g=$("<span></span>").addClass("wv-running-label"),h=$("<div></div>").addClass("wv-palettes-ranges"),i=$("<div></div>").addClass("wv-palettes-min"),j=$("<div></div>").addClass("wv-palettes-max"),k=$("<div></div>").addClass("wv-palettes-title");$container.prepend(k),h.append(i).append(j).append(g),$container.append(h).append(f),$colorbar.on("mousemove",function(a){p(a,d)}),$colorbar.on("mouseout",r),a.append($container),wv.palettes.colorbar(b+" [data-index='"+d+"'] canvas",c.colors)},m=function(a,b,c){var d=$("<div></div>").addClass("wv-palettes-legend").addClass("wv-palettes-classes").attr("data-index",c);a.attr("id",b.id).append(d)},n=function(a,c){var d=$(b+" [data-index='"+c+"']");d.empty(),_.each(a.colors,function(a,b){var e,f=$("<span></span>").addClass("wv-running-category-label");e=$("<span></span>").attr("data-index",c).attr("data-class-index",b).attr("data-hex",a).addClass("wv-palettes-class").html("&nbsp;").css("background-color",wv.util.hexToRGB(a)).hover(s,t),d.append(e),d.append(f),e.on("mouseenter",q),e.on("mouseout",r)});var e=$("<div></div>");_.each(a.colors,function(b,d){var f=a.tooltips[d];f=a.units?f+" "+a.units:f;var g=$("<div></div>").addClass("wv-palettes-class-detail").attr("data-class-index",d);$colorBox=g.append($("<span></span>").addClass("wv-palettes-class").html("&nbsp;").css("background-color",wv.util.hexToRGB(b))).append($("<span></span>").addClass("wv-palettes-class-label").attr("data-index",c).attr("data-class-index",d).html(f)),e.append(g)}),h||(h=!0)};i.update=function(){if(g){var a=d.getLegends(f.id);_.each(a,function(a,c){"continuous"===a.type||"discrete"===a.type?(wv.palettes.colorbar(b+" [data-index='"+c+"'] canvas",a.colors),o(c)):"classification"===a.type&&n(a,c)})}};var o=function(a){if(g){var c=d.getLegends(f.id,a);d.get(f.id,a).entries;_.each(c,function(a,d){var e=a.minLabel||_.first(a.tooltips),f=a.maxLabel||_.last(a.tooltips);e=a.units?e+" "+a.units:e,f=a.units?f+" "+a.units:f,$(b+" [data-index='"+d+"'] .wv-palettes-min").html(e),$(b+" [data-index='"+d+"'] .wv-palettes-max").html(f);var g=a.title||"&nbsp;";1===c.length?$(b+" [data-index='"+d+"'] .wv-palettes-title").hide():$(b+" [data-index='"+d+"'] .wv-palettes-title").html(g);
})}},p=function(a,b){var c,h,i,j;g&&(j=d.getLegends(f.id)[b],offset=$(a.currentTarget).offset(),h=a.pageX-offset.left,i=a.pageY-offset.top,c=wv.util.getCanvasPixelData(a.currentTarget,h,i),hex=wv.util.rgbaToHex(c[0],c[1],c[2]),e.map.runningdata.newLegend(j,hex))},q=function(a){var b=$(this).data("hex"),c=d.getLegends(f.id)[0];e.map.runningdata.newLegend(c,b)},r=function(){e.map.runningdata.clearAll()},s=function(){legendIndex=$(this).attr("data-index"),classIndex=$(this).attr("data-class-index"),$(".wv-palettes-class-label[data-index='"+legendIndex+"'][data-class-index='"+classIndex+"']").addClass("wv-palettes-class-highlight")},t=function(){legendIndex=$(this).attr("data-index"),classIndex=$(this).attr("data-class-index"),$(".wv-palettes-class-label[data-index='"+legendIndex+"'][data-class-index='"+classIndex+"']").removeClass("wv-palettes-class-highlight")};return j(),i};var wv=wv||{};wv.palettes=wv.palettes||{},wv.palettes.model=wv.palettes.model||function(a,b){b.palettes=b.palettes||{rendered:{},custom:{}};var c={};c.events=wv.util.events(),c.active={},c.getRendered=function(a,c){var d=b.layers[a].palette.id,e=b.palettes.rendered[d];return _.isUndefined(c)||(e=e.maps[c]),e},c.getCustom=function(a){if(palette=b.palettes.custom[a],!palette)throw new Error("Invalid palette: "+a);return palette};var d=function(a){c.active[a]=c.active[a]||{};var b=c.active[a];b.maps=b.maps||[],_.each(c.getRendered(a).maps,function(a,c){b.maps[c]||(b.maps[c]=_.cloneDeep(a))})};c.allowed=function(a){return!!wv.palettes.supported&&b.layers[a].palette},c.setCustom=function(a,e,f){if(!b.layers[a])throw new Error("Invalid layer: "+a);d(a),f=_.isUndefined(f)?0:f;var g=c.active[a],h=g.maps[f];h.custom!==e&&(h.custom=e,i(a),c.events.trigger("set-custom",a,g),c.events.trigger("change"))},c.clearCustom=function(a,b){b=_.isUndefined(b)?0:b;var d=c.active[a];if(d){var e=d.maps[b];e.custom&&(delete e.custom,i(a),c.events.trigger("clear-custom",a),c.events.trigger("change"))}},c.setRange=function(a,b,e,f,g){d(a),g=_.isUndefined(g)?0:g;var h=c.active[a].maps[g];0===b&&(b=void 0),e===c.get(a,g).entries.values.length-1&&(e=void 0),h.min=b,h.max=e,h.squash=f,i(a),c.events.trigger("range",a,h.min,h.max),c.events.trigger("change")},c.getCount=function(a){return c.getRendered(a).maps.length},c.get=function(a,b){return b=_.isUndefined(b)?0:b,c.active[a]?c.active[a].maps[b]:c.getRendered(a,b)},c.getLegend=function(a,b){var d=c.get(a,b);return d.legend||d.entries},c.getDefaultLegend=function(a,b){var d=c.getRendered(a,b);return d.legend||d.entries},c.getLegends=function(a){for(var b=[],d=c.getCount(a),e=0;e<d;e++)b.push(c.getLegend(a,e));return b},c.isActive=function(a){return c.active[a]},c.getLookup=function(a){return c.active[a].lookup},c.clear=function(){c.active={},c.events.trigger("update")},c.restore=function(a){c.active=a,c.events.trigger("update")};var e=function(a){return a.length?a[0]:a},f=function(a){return a.length?a[a.length-1]:a};c.save=function(b){if(c.inUse()&&!b.l)throw new Error("No layers in state");_.each(c.active,function(d,e){_.find(a.layers.get(),{id:e})&&(c.getCount(e)>1?c.saveMulti(b,e):c.saveSingle(b,e))})},c.saveSingle=function(a,b){var d=_.find(a.l,{id:b}).attributes,e=c.get(b);if(e.custom&&d.push({id:"palette",value:e.custom}),e.min){var f=e.entries.values[e.min];d.push({id:"min",value:f})}if(e.max){var g=e.entries.values[e.max];d.push({id:"max",value:g})}e.squash&&d.push({id:"squash"})},c.saveMulti=function(a,b){for(var d=[],g=!1,h=[],i=!1,j=[],k=!1,l=[],m=!1,n=0;n<c.getCount(b);n++){var o=c.get(b,n);o.custom?(d.push(o.custom),g=!0):d.push(""),o.min?(h.push(e(o.entries.values[o.min])),i=!0):h.push(""),o.max?(j.push(f(o.entries.values[o.max])),k=!0):j.push(""),o.squash?(l.push(o.squash),m=!0):l.push("")}var p=_.find(a.l,{id:b}).attributes;g&&p.push({id:"palette",value:d.join(";")}),i&&p.push({id:"min",value:h.join(";")}),k&&p.push({id:"max",value:j.join(";")}),m&&p.push({id:"squash",value:l.join(";")})},c.key=function(a){if(!c.isActive(a))return"";var b=c.get(a),d=[];return b.custom&&d.push("palette="+b.custom),b.min&&d.push("min="+b.min),b.max&&d.push("max="+b.max),b.squash&&d.push("squash"),d.join(",")},c.load=function(a,b){wv.palettes.supported&&_.each(a.l,function(a){var d,e,f=a.id,h=[],i=[],j=[],k=0;if(_.each(a.attributes,function(a){"palette"===a.id&&(k=c.getCount(f),values=wv.util.toArray(a.value.split(";")),_.each(values,function(a,d){try{c.setCustom(f,a,d)}catch(c){b.push("Invalid palette: "+a)}})),"min"===a.id&&(k=c.getCount(f),values=wv.util.toArray(a.value.split(";")),_.each(values,function(a,c){return""===a?void h.push(void 0):(d=parseFloat(a),void(_.isNaN(d)?b.push("Invalid min value: "+a):h.push(g(f,"min",d,c))))})),"max"===a.id&&(k=c.getCount(f),values=wv.util.toArray(a.value.split(";")),_.each(values,function(a,c){return""===a?void i.push(void 0):(e=parseFloat(a),void(_.isNaN(e)?b.push("Invalid max value: "+a):i.push(g(f,"max",e,c))))})),"squash"===a.id&&(k=c.getCount(f),a.value===!0?j[0]=!0:(values=wv.util.toArray(a.value.split(";")),_.each(values,function(a){j.push("true"===a)})))}),h.length>0||i.length>0)for(var l=0;l<k;l++){var m=h.length>0?h[l]:void 0,n=i.length>0?i[l]:void 0,o=j.length>0?j[l]:void 0;c.setRange(f,m,n,o,l)}})};var g=function(a,b,d,g){g=g||0;var h,i=c.get(a,g).entries.values;return _.each(i,function(a,c){var g=e(a),i=f(a);return"min"===b&&d===g?(h=c,!1):"max"===b&&d===i?(h=c,!1):void 0}),h};c.inUse=function(){var b=a.layers.get(),d=!1;return _.each(b,function(a){if(c.active[a.id])return d=!0,!1}),d};var h=function(a){var b=!1,d=c.active[a].maps;return _.each(d,function(d,e){if(d.custom)return b=!0,!1;var f=c.getRendered(a,e);return"classification"===d.type||(d.min<=0&&delete d.min,d.max>=f.entries.values.length&&delete d.max,_.isUndefined(d.min)&&_.isUndefined(d.max))?void 0:(b=!0,!1)}),b},i=function(a){if(!h(a))return void delete c.active[a];var b=c.active[a].maps,d={};_.each(b,function(a,b){oldLegend=a.legend,entries=a.entries,legend={colors:[],minLabel:oldLegend.minLabel,maxLabel:oldLegend.maxLabel,tooltips:oldLegend.tooltips,units:oldLegend.units,type:entries.type,title:entries.title,id:oldLegend.id};var e=entries.colors,f=(entries.values,a.custom?c.getCustom(a.custom).colors:e),g=a.min||0,h=a.max||e.length,i=e.length,j=f.length;_.each(e,function(b,c){if(c<g||c>h)targetColor="00000000";else{var e,k;a.squash?(e=(c-g)/(h-g),c==h&&(e=1),k=Math.floor(e*j),k>=j&&(k=j-1)):(e=c/i,k=Math.floor(e*j)),targetColor=f[k]}legend.colors.push(targetColor);var l=_.parseInt(b.substring(0,2),16)+","+_.parseInt(b.substring(2,4),16)+","+_.parseInt(b.substring(4,6),16)+","+_.parseInt(b.substring(6,8),16),m={r:_.parseInt(targetColor.substring(0,2),16),g:_.parseInt(targetColor.substring(2,4),16),b:_.parseInt(targetColor.substring(4,6),16),a:_.parseInt(targetColor.substring(6,8),16)};d[l]=m}),a.legend=legend}),c.active[a].lookup=d};return c};var wv=wv||{};wv.data=function(a){return a.parse=function(a,b,c){a.dataDownload&&(a.download=a.dataDownload,delete a.dataDownload);var d=a.download;d&&(c.products[d]||(delete a.download,b.push({message:"No such product: "+d})))},a}(wv.data||{});var wv=wv||{};wv.data=wv.data||{},wv.data.cmr=wv.data.cmr||{},wv.data.cmr.client=wv.data.cmr.client||function(a){var b=a.timeout||45e3,c=wv.data.cmr.client,d={url:"https://cmr.earthdata.nasa.gov/search/",traditional:!0,dataType:"json",timeout:b},e={},f=function(){c.ajax=wv.util.ajaxCache()};return e.submit=function(a){var b=$.extend(!0,{},d,a),e=a.startTimeDelta||0,f=a.endTimeDelta||0,g=a.time,h="granules.json";if(a.search&&(h=a.search),b.url+=h,g){var i=new Date(Date.UTC(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate(),0,0+e,0)),j=new Date(Date.UTC(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate(),23,59+f,59));i=i.toISOString(),j=j.toISOString(),b.data.temporal=i+","+j}b.data.pageSize="1000";var k=$.Deferred(),l="ev=data-download&"+$.param(b.data,!0);return wv.util.metrics(l),c.ajax.submit(b).done(function(a){k.resolve(a.feed.entry)}).fail(function(a,b,c){k.reject(a,b,c)}),k.promise()},f(),e},wv.data.cmr.geometry=function(a){var b={};b.polygons=[];var c=function(){if(a.polygons)d(a.polygons);else{if(!a.boxes)throw new Error("Unable to find spatial field");e(a.boxes)}};b.toOpenLayers=function(){return olPolygons=[],$.each(b.polygons,function(a,b){var c=[];$.each(b,function(a,b){var d=[];$.each(b,function(a,b){var c=[b.x,b.y];d.push(c)}),c.push(d)}),olPolygons.push(new ol.geom.Polygon(c))}),olPolygons[0]};var d=function(a){$.each(a,function(a,c){var d=[];$.each(c,function(a,b){for(var c=[],e=b.split(" "),f=0;f<e.length;f+=2){var g=parseFloat(e[f]),h=parseFloat(e[f+1]);c.push({x:h,y:g})}d.push(c)}),b.polygons.push(d)})},e=function(a){$.each(a,function(a,c){var d=[],e=c.split(" "),f=parseFloat(e[0]),g=parseFloat(e[1]),h=parseFloat(e[2]),i=parseFloat(e[3]);d.push({x:g,y:f}),d.push({x:i,y:f}),d.push({x:i,y:h}),d.push({x:g,y:h}),d.push({x:g,y:f}),b.polygons.push([d])})};return c(),b},wv.data.cmr.mockClient=function(a){var b,c,d={},e=function(){if(!a)throw new Error("No mock CMR suffix specified");b="mock/cmr.cgi-"+a};d.submit=function(a){console.warn("Mocking CMR query",b);var d=$.Deferred();return c?d.resolve(c.feed.entry):$.getJSON(b,function(b){try{c=f(a,b),d.resolve(c.feed.entry)}catch(a){wv.util.error(a)}}).fail(function(a,b,c){d.reject(a,b,c)}),d.promise()};var f=function(a,b){var c=wvx.models.date.selected,d=new Date(Date.UTC(2013,7,6)),e=(c-d)/864e5;return $.each(b.feed.entry,function(a,b){var c=wv.util.parseTimestampUTC(b.time_start);c.setUTCDate(c.getUTCDate()+e),b.time_start=c.toISOString();var d=wv.util.parseTimestampUTC(b.time_end);d.setUTCDate(d.getUTCDate()+e),b.time_end=d.toISOString()}),b};return e(),d},wv.data.cmr.REL_DATA="http://esipfed.org/ns/fedsearch/1.1/data#",wv.data.cmr.REL_METADATA="http://esipfed.org/ns/fedsearch/1.1/metadata#",wv.data.cmr.REL_BROWSE="http://esipfed.org/ns/fedsearch/1.1/browse#",wv.data.cmr.DATA_EXTS=["hdf","he5","h5","hdf5","nc","bz2"],wv.data.cmr.roundTime=function(a){var b=wv.util.parseTimestampUTC(a);return b.getUTCMilliseconds()>=500&&b.setUTCSeconds(b.getUTCSeconds()+1),b.setUTCMilliseconds(0),b.toISOString()};var wv=wv||{};wv.data=wv.data||{},wv.data.handler=wv.data.handler||{},wv.data.handler.getByName=function(a){var b={AquaSwathMultiDay:wv.data.handler.aquaSwathMultiDay,CollectionList:wv.data.handler.collectionList,CollectionMix:wv.data.handler.collectionMix,List:wv.data.handler.list,DailyGranuleList:wv.data.handler.dailyGranuleList,DailyAMSRE:wv.data.handler.dailyAMSRE,MODISGrid:wv.data.handler.modisGrid,MODISMix:wv.data.handler.modisMix,MODISSwath:wv.data.handler.modisSwath,TerraSwathMultiDay:wv.data.handler.terraSwathMultiDay,HalfOrbit:wv.data.handler.halfOrbit},c=b[a];if(!c)throw new Error("No such handler: "+a);return c},wv.data.handler.base=function(a,b){var c={};c.events=wv.util.events(),c.cmr=null,c.ajax=null;var d=function(){var b=wv.data.handler.base;b.cmr||(a.parameters.mockCMR?b.cmr=wv.data.cmr.mockClient(a.parameters.mockCMR):b.cmr=wv.data.cmr.client({timeout:a.parameters.timeoutCMR})),c.cmr=b.cmr,b.ajax||(b.ajax=wv.util.ajaxCache()),c.ajax=b.ajax,c.extents={},$.each(a.projections,function(a,b){c.extents[b.crs]=b.maxExtent})};return c.submit=function(){var d=a.products[b.selectedProduct].query,e=$.extend(!0,{},d),f=c._submit(e),g=b.selectedProduct;f.done(function(a){try{if(b.selectedProduct!==g)return void c.events.trigger("results",{granules:[],meta:{}});var d=c._processResults(a);c.events.trigger("results",d)}catch(a){c.events.trigger("error","exception",a)}}).fail(function(a,b,d){"timeout"===b?c.events.trigger("timeout"):c.events.trigger("error",b,d)}),"pending"===f.state()&&c.events.trigger("query")},d(),c},wv.data.handler.modisSwathMultiDay=function(a,b,c){var d=c.startTimeDelta||0,e=c.endTimeDelta||0,f=wv.data.handler.base(a,b),g=function(){f.extents[wv.map.CRS_WGS_84]=wv.map.CRS_WGS_84_QUERY_EXTENT};return f._submit=function(a){var c={time:b.time,startTimeDelta:d,endTimeDelta:e,data:a};return f.cmr.submit(c)},f._processResults=function(d){var e={meta:{},granules:d};b.crs===wv.map.CRS_WGS_84&&(e.meta.queryMask=wv.map.CRS_WGS_84_QUERY_MASK);var g=wv.data.results,h=a.products[b.selectedProduct],i=g.chain();return i.processes=[g.tagProduct(b.selectedProduct),g.tagNRT(h.nrt),g.tagURS(h.urs),g.collectPreferred(b.prefer),g.preferredFilter(b.prefer),g.tagVersion(),g.collectVersions(),g.versionFilter(),g.geometryFromCMR(),g.transform(b.crs),g.extentFilter(b.crs,f.extents[b.crs]),g.timeFilter({time:b.time,eastZone:c.eastZone,westZone:c.westZone,maxDistance:c.maxDistance}),g.timeLabel(b.time),g.connectSwaths(b.crs)],i.process(e)},g(),f},wv.data.handler.aquaSwathMultiDay=function(a,b){var c={startTimeDelta:-180,endTimeDelta:180,maxDistance:270,eastZone:300,westZone:1380},d=wv.data.handler.modisSwathMultiDay(a,b,c);return $.extend(!0,d,c)},wv.data.handler.terraSwathMultiDay=function(a,b){var c={startTimeDelta:-180,endTimeDelta:180,maxDistance:270,eastZone:180,westZone:1260},d=wv.data.handler.modisSwathMultiDay(a,b,c);return $.extend(!0,d,c)},wv.data.handler.collectionList=function(a,b,c){var d=wv.data.handler.base(a,b);return d._submit=function(a){var b={data:a,search:"collections.json"};return d.cmr.submit(b)},d._processResults=function(c){var d={meta:{},granules:c},e=wv.data.results,f=a.products[b.selectedProduct],g=e.chain();return g.processes=[e.tagList(),e.tagProduct(b.selectedProduct),e.tagURS(f.urs),e.tagVersion(),e.collectVersions(),e.versionFilter(),e.productLabel(a.products[b.selectedProduct].name)],g.process(d)},d},wv.data.handler.collectionMix=function(a,b,c){var d,e,f=wv.data.handler.base(a,b),g=function(){var f=a.products[b.selectedProduct],g=f.nrt.handler,h=wv.data.handler.getByName(g);d=h(a,b,c);var i=f.science.handler,j=wv.data.handler.getByName(i);e=j(a,b,c)};return f._submit=function(){var c={time:b.time,startTimeDelta:d.startTimeDelta,endTimeDelta:d.endTimeDelta,data:a.products[b.selectedProduct].query.nrt},e=f.cmr.submit(c),g={time:b.time,data:a.products[b.selectedProduct].query.science},h=f.cmr.submit(g);return wv.util.ajaxJoin([{item:"nrt",promise:e},{item:"science",promise:h}])},f._processResults=function(a){var c=!1;return c=a.nrt.length>0&&a.science.length>0?"nrt"===b.prefer:a.nrt.length>0,c?d._processResults(a.nrt):e._processResults(a.science)},g(),f},wv.data.handler.list=function(a,b,c){var d=wv.data.handler.base(a,b);return d._submit=function(a){var c={startTimeDelta:1,endTimeDelta:-1,time:b.time,data:a};return d.cmr.submit(c)},d._processResults=function(c){var d={meta:{},granules:c},e=wv.data.results,f=a.products[b.selectedProduct],g=e.chain();return g.processes=[e.tagList(),e.tagProduct(b.selectedProduct),e.tagNRT(f.nrt),e.tagURS(f.urs),e.collectPreferred(b.prefer),e.preferredFilter(b.prefer),e.tagVersion(),e.collectVersions(),e.versionFilter(),e.dateTimeLabel(b.time)],g.process(d)},d},wv.data.handler.dailyGranuleList=function(a,b,c){var d=wv.data.handler.list(a,b,c);return d._submit=function(a){var c={startTimeDelta:180,endTimeDelta:-180,time:b.time,data:a};return d.cmr.submit(c)},d},wv.data.handler.dailyAMSRE=function(a,b,c){var d=wv.data.handler.base(a,b);return d._submit=function(a){var c={startTimeDelta:180,endTimeDelta:-180,time:b.time,data:a};return d.cmr.submit(c)},d._processResults=function(c){var d={meta:{},granules:c},e=wv.data.results,f=a.products[b.selectedProduct],g=e.chain();return g.processes=[e.tagList(),e.tagProduct(b.selectedProduct),e.tagURS(f.urs),e.tagVersion(),e.versionFilterExact(f.version),e.dateTimeLabel(b.time)],g.process(d)},d},wv.data.handler.modisGrid=function(a,b,c){var d=wv.data.handler.base(a,b);return d._submit=function(){var c=b.crs.replace(/:/,"_"),e={startTimeDelta:1,endTimeDelta:-1,time:b.time,data:a.products[b.selectedProduct].query},f=d.cmr.submit(e),g=d.ajax.submit({url:"data/MODIS_Grid."+c+".json?v="+wv.brand.BUILD_NONCE,dataType:"json"});$.Deferred();return wv.util.ajaxJoin([{item:"granules",promise:f},{item:"grid",promise:g}])},d._processResults=function(c){var e=a.products[b.selectedProduct],f={meta:{gridFetched:c.grid},granules:c.granules},g=wv.data.results,h=g.chain();return h.processes=[g.tagProduct(b.selectedProduct),g.tagVersion(),g.tagURS(e.urs),g.collectVersions(),g.versionFilter(),g.modisGridIndex(),g.geometryFromMODISGrid(b.crs),g.extentFilter(b.crs,d.extents[b.crs]),g.modisGridLabel()],h.process(f)},d},wv.data.handler.modisMix=function(a,b,c){var d,e,f=wv.data.handler.base(a,b),g=function(){var f=a.products[b.selectedProduct],g=f.nrt.handler,h=wv.data.handler.getByName(g);d=h(a,b,c);var i=f.science.handler,j=wv.data.handler.getByName(i);e=j(a,b,c)};return f._submit=function(){var c=b.crs.replace(/:/,"_"),e={time:b.time,startTimeDelta:d.startTimeDelta,endTimeDelta:d.endTimeDelta,data:a.products[b.selectedProduct].query.nrt},g=f.cmr.submit(e),h={time:b.time,data:a.products[b.selectedProduct].query.science},i=f.cmr.submit(h),j=f.ajax.submit({url:"data/MODIS_Grid."+c+".json?v="+wv.brand.BUILD_NONCE,dataType:"json"});return wv.util.ajaxJoin([{item:"nrt",promise:g},{item:"science",promise:i},{item:"grid",promise:j}])},f._processResults=function(a){var c=!1;return c=a.nrt.length>0&&a.science.length>0?"nrt"===b.prefer:a.nrt.length>0,c?d._processResults(a.nrt):e._processResults({granules:a.science,grid:a.grid})},g(),f},wv.data.handler.modisSwath=function(a,b,c){var d=270,e=wv.data.handler.base(a,b),f=function(){e.extents[wv.map.CRS_WGS_84]=wv.map.CRS_WGS_84_QUERY_EXTENT};return e._submit=function(a){var c={time:b.time,data:a};return e.cmr.submit(c)},e._processResults=function(c){var f={meta:{},granules:c};b.crs===wv.map.CRS_WGS_84&&(f.meta.queryMask=wv.map.CRS_WGS_84_QUERY_MASK);var g=wv.data.results,h=a.products[b.selectedProduct],i=g.chain();return i.processes=[g.tagProduct(b.selectedProduct),g.tagNRT(h.nrt),g.tagURS(h.urs),g.collectPreferred(b.prefer),g.preferredFilter(b.prefer),g.tagVersion(),g.collectVersions(),g.versionFilter(),g.geometryFromCMR(),g.antiMeridianMulti(d),g.densify(),g.transform(b.crs),g.extentFilter(b.crs,e.extents[b.crs]),g.timeLabel(b.time),g.connectSwaths(b.crs)],i.process(f)},f(),e},wv.data.handler.halfOrbit=function(a,b,c){var d=wv.data.handler.base(a,b),e=function(){d.extents[wv.map.CRS_WGS_84]=wv.map.CRS_WGS_84_QUERY_EXTENT};return d._submit=function(a){var c={time:b.time,data:a};return d.cmr.submit(c)},d._processResults=function(c){var d={meta:{},granules:c};b.crs===wv.map.CRS_WGS_84&&(d.meta.queryMask=wv.map.CRS_WGS_84_QUERY_MASK);var e=wv.data.results,f=a.products[b.selectedProduct],g=e.chain();return g.processes=[e.orbitFilter(f.orbit),e.tagProduct(b.selectedProduct),e.tagNRT(f.nrt),e.tagURS(f.urs),e.collectPreferred(b.prefer),e.preferredFilter(b.prefer),e.tagVersion(),e.collectVersions(),e.versionFilter(),e.geometryFromCMR(),e.dividePolygon(),e.densify(),e.transform(b.crs),e.timeLabel(b.time)],console.log("before process",d),g.process(d)},e(),d};var wv=wv||{};wv.data=wv.data||{},wv.data.map=wv.data.map||function(a,b,c){var d={},e=null,f=[],g=[],h=null,i=null,j=null,k=null,l=null,m=null,n=function(){a.events.on("activate",D).on("query",E).on("queryResults",x).on("projectionUpdate",D).on("granuleSelect",B).on("granuleUnselect",C),D()},o=function(b){var c,d=J();if(c=a.isSelected(b.granule)?"images/data.minus-button.png":"images/data.plus-button.png",b!==l)return[new ol.style.Style({image:new ol.style.Icon({src:c,scale:d.scale})})];var e=-(d.size/2+14);return[new ol.style.Style({image:new ol.style.Icon({src:c,scale:d.scale}),text:new ol.style.Text({font:"bold 14px ‘Lucida Sans’, Arial, Sans-Serif",text:b.granule.label,fill:new ol.style.Fill({color:"#ffffff"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, .7)",width:5}),offsetY:e})})]},p=function(b){return a.isSelected(b.granule)?[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(242, 12, 12, 0.25)"}),stroke:new ol.style.Stroke({color:"rgb(255, 6, 0)",width:3})})]:[new ol.style.Style({fill:new ol.style.Fill({color:"rgba(181, 158, 50, 0.25)"}),stroke:new ol.style.Stroke({color:"rgb(251, 226, 109)",width:3})})]},q=function(){i=new ol.layer.Vector({source:new ol.source.Vector({wrapX:!1}),style:o}),e.addLayer(i)},r=function(){h=new ol.layer.Vector({source:new ol.source.Vector({wrapX:!1}),style:p}),e.addLayer(h)},s=function(){j=new ol.layer.Vector({source:new ol.source.Vector({wrapX:!1}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(127, 127, 127, 0.2)"}),stroke:new ol.style.Stroke({color:"rgb(127, 127, 127)",width:3}),opacity:.6})}),e.addLayer(j)},t=function(){swathLayer=new ol.layer.Vector({source:new ol.source.Vector({wrapX:!1}),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(195, 189, 123, 0.75)",width:2})})}),e.addLayer(swathLayer)},u=function(){k=new ol.layer.Vector({source:new ol.source.Vector({wrapX:!1}),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(186, 180, 152, 0.6)",width:1.5})})}),e.addLayer(k)},v=function(){s(),u(),t(),r(),q(),$(b.selected.getViewport()).on("mousemove",F),$(b.selected.getViewport()).on("click",G)},w=function(){e&&(e.removeLayer(j),e.removeLayer(k),e.removeLayer(swathLayer),e.removeLayer(h),e.removeLayer(i)),m=[],$(b.selected.getViewport()).off("mousemove",F),$(b.selected.getViewport()).off("click",G)};d.dispose=w;var x=function(b){f=b,g=b.granules,y(),z(),A(),_.each(a.selectedGranules,function(a){m[a.id]&&(j.getSource().removeFeature(m[a.id]),delete m[a.id]),B(a)})},y=function(){i.getSource().clear();var b=[];_.each(g,function(c){if(c.centroid&&c.centroid[a.crs]){var d=c.centroid[a.crs],e=new ol.Feature({geometry:d});e.button=!0,e.granule=c,c.feature=e,b.push(e)}}),i.getSource().addFeatures(b)},z=function(){swathLayer.getSource().clear();var b=f.meta.swaths;if(b){var c=a.crs===wv.map.CRS_WGS_84?270:Number.POSITIVE_INFINITY,d=[];_.each(b,function(b){var e=null;_.each(b,function(b){if(!e)return void(e=b);var f=wv.map.toPolys(e.geometry[a.crs]),g=wv.map.toPolys(b.geometry[a.crs]);_.each(f,function(a){_.each(g,function(b){var e=a.getInteriorPoint().getCoordinates(),f=b.getInteriorPoint().getCoordinates(),g=wv.map.distanceX(e[0],f[0]);if(g<c){var h=new ol.geom.LineString([e,f]);d.push(new ol.Feature(h))}})}),e=b})}),swathLayer.getSource().addFeatures(d)}},A=function(){k.getSource().clear();var a=f.meta.grid;if(a){var b=[],c=new ol.format.GeoJSON;_.each(a,function(a){var d=c.readGeometry(a.geometry),e=new ol.Feature(d);b.push(e)}),k.getSource().addFeatures(b)}},B=function(b){if(b.feature){b.feature.changed();var c=new ol.Feature(b.geometry[a.crs]);c.granule=b,j.getSource().addFeature(c),m[b.id]=c}},C=function(a){a.feature&&(a.feature.changed(),j.getSource().removeFeature(m[a.id]),delete m[a.id])},D=function(){w(),e=b.selected,v()},E=function(){e&&(swathLayer.getSource().clear(),k.getSource().clear(),h.getSource().clear(),i.getSource().clear())},F=function(a){var b=e.getEventPixel(a.originalEvent),c=null;e.forEachFeatureAtPixel(b,function(a,b){a.button&&(c=a)}),l&&l.changed(),c&&c.changed(),l!==c&&(c?H(c):I(l)),l=c},G=function(b){var c=e.getEventPixel(b.originalEvent);e.forEachFeatureAtPixel(c,function(c,d){c.button&&(a.toggleGranule(c.granule),l=!1,F(b))})},H=function(b){if(granule=b.granule,granule.geometry){var c=new ol.Feature(granule.geometry[a.crs]);c.granule=granule,h.getSource().clear(),h.getSource().addFeature(c)}},I=function(){h.getSource().clear()},J=function(){var a=e.getView().getZoom(),b=12,c=Math.pow(2,a),d=Math.min(b+c,b+32);return{scale:d/48,size:d}};return n(),d};var wv=wv||{};wv.data=wv.data||{},wv.data.model=wv.data.model||function(a,b){var c="__NO_PRODUCT",d={name:"Not available for download &nbsp;&nbsp;<span class='link'>(?)</span>",notSelectable:!0},e=a.layers,f=!1,g=null,h={};h.EVENT_ACTIVATE="activate",h.EVENT_DEACTIVATE="deactivate",h.EVENT_PRODUCT_SELECT="productSelect",h.EVENT_LAYER_UPDATE="layerUpdate",h.EVENT_QUERY="query",h.EVENT_QUERY_RESULTS="queryResults",h.EVENT_QUERY_CANCEL="queryCancel",h.EVENT_QUERY_ERROR="queryError",h.EVENT_QUERY_TIMEOUT="queryTimeout",h.EVENT_GRANULE_SELECT="granuleSelect",h.EVENT_GRANULE_UNSELECT="granuleUnselect",h.active=!1,h.events=wv.util.events(),h.selectedProduct=null,h.selectedGranules={},h.prefer="science",h.granules=[],h.layers=[],h.projection=null,h.crs=null,h.time=null;var i=function(){a.layers.events.on("change",l),a.proj.events.on("select",o),a.date.events.on("select",p),l(),o(),p()};h.activate=function(a){if(!h.active)try{a&&r(a),h.active=!0,h.events.trigger(h.EVENT_ACTIVATE),a?h.selectProduct(a):h.selectedProduct?(h.events.trigger(h.EVENT_PRODUCT_SELECT,h.selectedProduct),j()):h.selectProduct(q())}catch(a){throw h.active=!1,h.selectedProduct=null,a}},h.deactivate=function(){h.active&&(h.active=!1,h.events.trigger(h.EVENT_DEACTIVATE))},h.toggleMode=function(){h.active?h.deactivate():h.activate()},h.groupByProducts=function(){var a={};$.each(h.layers,function(e,f){var g=f.product||c,h=b.products[g]||d;a[g]||(a[g]={title:h.name,items:[],notSelectable:h.notSelectable}),a[g].items.push({label:f.name,sublabel:f.description,value:f.id,categories:{All:1}})});var e={},f=a.__NO_PRODUCT;return _.each(a,function(a,b){b!==c&&(e[b]=a)}),f&&(e[c]=f),e},h.getProductsString=function(){var a=[],b=h.groupByProducts();return $.each(b,function(b,c){var d=[];$.each(c.items,function(a,b){d.push(b.value)}),a.push(b+","+d.join(","))}),a.join("~")},h.selectProduct=function(a){h.selectedProduct!==a&&(h.selectedProduct=a,h.active&&(h.events.trigger(h.EVENT_PRODUCT_SELECT,h.selectedProduct),a&&j()))},h.selectGranule=function(a){h.selectedGranules[a.id]=a,h.events.trigger(h.EVENT_GRANULE_SELECT,a)},h.unselectGranule=function(a){h.selectedGranules[a.id]&&(delete h.selectedGranules[a.id],h.events.trigger(h.EVENT_GRANULE_UNSELECT,a))},h.toggleGranule=function(a){h.isSelected(a)?h.unselectGranule(a):h.selectGranule(a)},h.isSelected=function(a){var b=!1;return $.each(h.selectedGranules,function(c,d){a.id===d.id&&(b=!0)}),b},h.getSelectionSize=function(){var a=0,b=!0;if($.each(h.selectedGranules,function(c,d){b&&d.granule_size?a+=parseFloat(d.granule_size):b=!1}),b)return a},h.getSelectionCounts=function(){return counts={},$.each(h.layers,function(a,b){b.product&&(counts[b.product]=0)}),$.each(h.selectedGranules,function(a,b){counts[b.product]++}),counts},h.setPreference=function(a){h.prefer=a,j()},h.save=function(a){h.active&&(a.download=h.selectedProduct)},h.load=function(b,c){var d=b.download;if(d){var e=_.find(a.layers.active,{product:d});e?a.wv.events.on("startup",function(){h.activate(d)}):c.push({message:"No active layers match product: "+d})}};var j=function(){if(h.active){if(!h.selectedProduct)return void h.events.trigger(h.EVENT_QUERY_RESULTS,{meta:{},granules:[]});var a=b.products[h.selectedProduct];if(!a)throw Error("Product not defined: "+h.selectedProduct);var c=wv.data.handler.getByName(a.handler),d=c(b,h);d.events.on("query",function(){h.events.trigger(h.EVENT_QUERY)}).on("results",function(a){if(f=!1,h.active&&!g&&h.events.trigger(h.EVENT_QUERY_RESULTS,a),g){var b=g;g=null,k(b)}}).on("error",function(a,b){f=!1,h.active&&h.events.trigger(h.EVENT_QUERY_ERROR,a,b)}).on("timeout",function(){f=!1,h.active&&h.events.trigger(h.EVENT_QUERY_TIMEOUT)}),k(d)}},k=function(a){if(f)g=a;else try{f=!0,a.submit()}catch(a){throw f=!1,a}},l=function(){h.layers=[];var b=!1;_.each(a.layers.get(),function(c){var d=c.id,e=a.layers.getTitles(c.id),f=e.title,g=e.subtitle,i=c.product;h.layers.push({id:d,name:f,description:g,product:i}),i===h.selectedProduct&&(b=!0)}),b||h.selectProduct(null),h.events.trigger(h.EVENT_LAYER_UPDATE),h.active&&!b&&h.selectProduct(q());var c=h.groupByProducts();_.each(h.selectedGranules,function(a){c[a.product]||m(a.product)||h.unselectGranule(a)})},m=function(a){var b=!1;return _.each(e.active,function(c){if(c.product===a)return b=!0,!1}),b},n=function(){h.projection=a.proj.selected.id,h.crs=a.proj.selected.crs},o=function(){n(),h.events.trigger("projectionUpdate"),l(),j()};h.updateProjection=o;var p=function(){h.time=a.date.selected,j()},q=function(){for(var b=null,c=a.layers.get({flat:!0}),d=c.length-1;d>=0;d--)c[d].product&&(b=c[d].product);return b},r=function(a){var b=!1;if($.each(h.layers,function(c,d){var e=d.product;if(e===a)return b=!0,!1}),!b)throw Error("No layer displayed for product: "+a)};return i(),h};var wv=wv||{};wv.data=wv.data||{},wv.data.results=wv.data.results||{},wv.data.results.antiMeridianMulti=function(a){var b={};return b.name="AntiMeridianMulti",b.process=function(b,c){var d=c.geometry[wv.map.CRS_WGS_84];if(!(d instanceof ol.geom.MultiPolygon||wv.map.isPolygonValid(d,a))){var e=wv.map.adjustAntiMeridian(d,1),f=wv.map.adjustAntiMeridian(d,-1),g=e.getInteriorPoint(),h=f.getInteriorPoint(),i=new ol.geom.MultiPolygon([e.getCoordinates(),f.getCoordinates()]),j=new ol.geom.MultiPoint([g.getCoordinates(),h.getCoordinates()]);c.geometry[wv.map.CRS_WGS_84]=i,c.centroid[wv.map.CRS_WGS_84]=j}return c},b},wv.data.results.chain=function(){var a={};return a.processes=[],a.process=function(b){return $.each(b.granules,function(a,b){delete b.filtered,delete b.filteredBy}),$.each(a.processes,function(a,c){$.each(b.granules,function(a,d){if(!d.filtered){var e=c.process(b.meta,d);e||(d.filtered=!0,d.filteredBy=c.name)}}),c.after&&c.after(b)}),newGranules=[],filteredGranules={},$.each(b.granules,function(a,b){b.filtered?(filteredGranules[b.filteredBy]||(filteredGranules[b.filteredBy]=[]),filteredGranules[b.filteredBy].push(b)):newGranules.push(b)}),{meta:b.meta,granules:newGranules,filtered:filteredGranules}},a},wv.data.results.collectPreferred=function(a){var b={};return b.name="CollectPreferred",b.process=function(b,c){b.preferred||(b.preferred={});var d="nrt"===a&&c.nrt||"science"===a&&!c.nrt;if(d){var e=wv.data.cmr.roundTime(c.time_start);b.preferred[e]=c}return c},b},wv.data.results.collectVersions=function(){var a={};return a.name="CollectVersions",a.process=function(a,b){if(a.versions||(a.versions={}),b.version){var c=wv.data.cmr.roundTime(b.time_start),d=a.versions[c]||0;a.versions[c]=Math.max(d,b.version)}return b},a},wv.data.results.connectSwaths=function(a){var b=270,c={},d={},e={};e.name="ConnectSwaths",e.process=function(b,e){if(e.centroid[a]){var g=h(e.time_start),i=h(e.time_end);if(c[g])return void console.warn("Discarding duplicate start time",g,e,c[g]);if(d[i])return void console.warn("Discarding duplicate end time",i,e,d[i]);var j=[e];return c[g]=j,d[i]=j,f(j),e}},e.after=function(a){a.meta.swaths=[],$.each(c,function(b,c){c.length>1&&a.meta.swaths.push(c)})};var f=function(e){var i=!1,j=a===wv.map.CRS_WGS_84?b:Number.POSITIVE_INFINITY,k=h(e[0].time_start),l=h(e[e.length-1].time_end),m=d[k];if(m){var n=m[m.length-1],o=h(m[0].time_start),p=h(m[m.length-1].time_end);if(g(e[0],n,j)){delete c[k],delete d[l],delete c[o],delete d[p];var q=m.concat(e),r=h(q[0].time_start),s=h(q[q.length-1].time_end);c[r]=q,d[s]=q,i=!0,e=q}}i&&f(e)},g=function(b,c,d){var e=wv.map.toPolys(b.geometry[a]),f=wv.map.toPolys(c.geometry[a]),g=!1;return $.each(e,function(a,b){$.each(f,function(a,c){var e=b.getInteriorPoint().getCoordinates()[0],f=c.getInteriorPoint().getCoordinates()[0];if(Math.abs(f-e)<d)return g=!0,!1})}),g},h=function(a){return wv.data.cmr.roundTime(a)};return e},wv.data.results.dateTimeLabel=function(a){var b={};return b.name="DateTimeLabel",b.process=function(a,b){var c=wv.util.parseTimestampUTC(b.time_start);if(b.time_end){var d=wv.util.parseTimestampUTC(b.time_end);b.label=wv.util.toISOStringDate(c)+": "+wv.util.toISOStringTimeHM(c)+"-"+wv.util.toISOStringTimeHM(d)+" UTC"}else b.label=wv.util.toISOStringDate(c)+": "+wv.util.toISOStringTimeHM(c)+" UTC";return b},b},wv.data.results.densify=function(){var a={};a.name="Densify",a.process=function(a,b){return b};return a},wv.data.results.dividePolygon=function(){var a={};return a.name="DividePolygon",a.process=function(a,b){if(b.geometry["EPSG:4326"].getPolygons)return b;var c=b.geometry["EPSG:4326"].getLinearRing(0),d=c.getCoordinates(),e=[];_.each(d,function(a){var b=new L.LatLng(a[1],a[0]);e.push(b)});var f=L.sphericalPolygon.dividePolygon(e),g=f.interiors,h=[];return _.each(g,function(a){
var b=[];_.each(a,function(a){b.push([a.lng,a.lat])}),h.push(b)}),b.geometry["EPSG:4326"]=new ol.geom.MultiPolygon([h]),b},a},wv.data.results.extentFilter=function(a,b){var c={};if(c.name="ExtentFilter",c.process=function(c,d){var e=d.geometry[a];if(!e)return result;var f=e.getExtent();return ol.extent.intersects(b,f)?d:void 0},!b)throw new Error("No extent");return c},wv.data.results.geometryFromCMR=function(a){var b={};return b.name="GeometryFromCMR",b.process=function(b,c){if(c.geometry||(c.geometry={}),c.centroid||(c.centroid={}),!c.geometry[wv.map.CRS_WGS_84]){var d=wv.data.cmr.geometry(c,a),e=d.toOpenLayers(),f=e.getInteriorPoint();c.geometry[wv.map.CRS_WGS_84]=e,c.centroid[wv.map.CRS_WGS_84]=f}return c},b},wv.data.results.geometryFromMODISGrid=function(a){var b=new ol.format.GeoJSON,c={};return c.name="GeoemtryFromMODISGrid",c.process=function(c,d){if(d.geometry||(d.geometry={},d.centroid={}),!d.geometry[a]){var e=c.grid[d.hv];if(!e)return;var f=c.grid[d.hv],g=b.readGeometry(c.grid[d.hv].geometry),h=new ol.geom.Point([f.properties.CENTER_X,f.properties.CENTER_Y]);d.geometry[a]=g,d.centroid[a]=h}return d},c},wv.data.results.modisGridIndex=function(){var a={};return a.name="MODISGridIndex",a.process=function(a,b){var c=b.producer_granule_id,d=c.match(/\.h(\d+)v(\d+)\./);return b.h=parseInt(d[1],10),b.v=parseInt(d[2],10),b.hv="h"+b.h+"v"+b.v,b},a.after=function(a){a.meta.grid={},$.each(a.meta.gridFetched.features,function(b,c){var d="h"+c.properties.H+"v"+c.properties.V;a.meta.grid[d]=c})},a},wv.data.results.modisGridLabel=function(){var a={};return a.name="MODISGridLabel",a.process=function(a,b){b.label="h"+b.h+" - v"+b.v;var c=wv.util.parseTimestampUTC(b.time_start),d=wv.util.toISOStringDate(c);return b.downloadLabel=d+": h"+b.h+"-"+b.v,b},a},wv.data.results.orbitFilter=function(a){var b={};return b.name="OrbitFilter",b.process=function(b,c){if(!a)return c;var d=new RegExp(a.regex),e=c[a.field],f=e.match(d);return f&&f[1]===a.match?c:void 0},b},wv.data.results.preferredFilter=function(a){var b={};return b.name="PreferredFilter",b.process=function(b,c){var d=wv.data.cmr.roundTime(c.time_start);if(b.preferred[d]){if("nrt"===a&&!c.nrt)return;if("science"===a&&c.nrt)return}return c},b},wv.data.results.productLabel=function(a){var b={};return b.name="ProductLabel",b.process=function(b,c){return c.label=a,c},b},wv.data.results.tagList=function(a){var b={};return b.name="TagList",b.process=function(a,b){return b},b.after=function(a){a.meta.showList=!0},b},wv.data.results.tagNRT=function(a){var b={};return b.name="TagNRT",b.process=function(b,c){if(!a)return c;var d;if("value"===a.by)d=c[a.field]===a.value;else{if("regex"!==a.by)throw new Error("Unknown TagNRT method: "+a.by);var e=new RegExp(a.value);d=e.test(c[a.field])}return d&&(c.nrt=!0,b.nrt=!0),c},b},wv.data.results.tagProduct=function(a){var b={};return b.name="TagProduct",b.process=function(b,c){return c.product=a,c},b},wv.data.results.tagURS=function(a){var b={};return b.name="TagURS",b.process=function(b,c){if(!a)return c;var d;if("constant"===a.by)d=a.value;else if("value"===a.by)d=c[a.field]===a.value;else{if("regex"!==a.by)throw new Error("Unknown TagURS method: "+a.by);var e=new RegExp(a.value);d=e.test(c[a.field])}return c.urs=d,d&&(b.urs=b.urs?b.urs+=1:1),c},b},wv.data.results.tagVersion=function(){var a={};return a.name="TagVersion",a.process=function(a,b){var c=b.dataset_id.match("V(\\d{3})(\\d*)");if(c){var d=c[1],e=c[2]||0;return b.version=parseFloat(d+"."+e),b}return c=b.dataset_id.match("V([\\d\\.]+)"),c?(b.version=parseFloat(c[1]),b):b},a},wv.data.results.timeFilter=function(a){var b=null,c=null,d=null,e={};e.name="TimeFilter";var f=function(){b=new Date(a.time.getTime()).setUTCMinutes(a.westZone),c=new Date(a.time.getTime()).setUTCMinutes(a.eastZone),d=a.maxDistance,timeOffset=a.timeOffset||0};return e.process=function(a,e){var f=e.geometry[wv.map.CRS_WGS_84],g=wv.util.parseTimestampUTC(e.time_start);if(g.setUTCMinutes(g.getUTCMinutes()+timeOffset),!(f instanceof ol.geom.MultiPolygon||wv.map.isPolygonValid(f,d))){var h=g<c?1:-1;f=wv.map.adjustAntiMeridian(f,h),e.geometry[wv.map.CRS_WGS_84]=f,e.centroid[wv.map.CRS_WGS_84]=f.getInteriorPoint()}var i=e.centroid[wv.map.CRS_WGS_84].getCoordinates()[0];if(!(g<c&&i<0||g>b&&i>0))return e},f(),e},wv.data.results.timeLabel=function(a){var b={};return b.name="TimeLabel",b.process=function(b,c){var d,e=wv.util.parseTimestampUTC(c.time_start);c.time_end&&(d=wv.util.parseTimestampUTC(c.time_end));var f=Math.floor((e.getTime()-a.getTime())/864e5),g="";0!==f&&(g=f<0?" ("+f+" day)":" (+"+f+" day)");var h=wv.util.toISOStringTimeHM(e),i=null;return i=d?wv.util.toISOStringTimeHM(d):"?",c.label=h+" - "+i+" UTC"+g,c.downloadLabel=wv.util.toISOStringDate(e)+": "+h+"-"+i+" UTC",c},b},wv.data.results.transform=function(a){var b={};return b.name="Transform",b.process=function(b,c){if(c.geometry[a])return c;var d=c.geometry[wv.map.CRS_WGS_84],e=d.clone().transform(wv.map.CRS_WGS_84,a);return c.geometry[a]=e,e instanceof ol.geom.Polygon?c.centroid[a]=e.getInteriorPoint():c.centroid[a]=e.getInteriorPoints().getPoint(0),c},b},wv.data.results.versionFilter=function(){var a={};return a.name="VersionFilter",a.process=function(a,b){if(b.version){var c=wv.data.cmr.roundTime(b.time_start);if(a.versions[c]&&a.versions[c]!==b.version)return}return b},a},wv.data.results.versionFilterExact=function(a){var b={};return b.name="versionFilterExact",b.process=function(b,c){if(c.version&&c.version===a)return c},b};var wv=wv||{};wv.data=wv.data||{},wv.data.ui=wv.data.ui||function(a,b,c){var d=!1,e=a.data,f=null,g=null,h=null,i=null,j=b.map,k={query:null,noneInView:null,noResults:null},l={};l.selector="#wv-data",l.id="wv-data";var m=function(){e.events.on("activate",s).on("deactivate",t).on("productSelect",u).on("layerUpdate",v).on("query",w).on("queryResults",x).on("queryCancel",y).on("queryError",z).on("queryTimeout",A).on("granuleSelect",B).on("granuleUnselect",B),$(window).resize(p),b.sidebar.events.on("select",function(a){"download"===a?(p(),e.activate()):e.deactivate()})};l.render=function(){var a=$("#productsHolder footer"),b=$(l.selector).empty().addClass(l.id+"list").addClass("bank"),c=$("<button></button>").attr("id","wv-data-download-button").addClass("action").attr("type","button").attr("value","").on("click",C);a.append(c),c.hide();var d=$("<div></div>").attr("id",l.id+"content").addClass("content");b.append(d),$("#wv-data-download-button").button(),l.refresh()},l.refresh=function(){var a=$(l.selector+"content");a=$(l.selector+"content").empty();var b=e.groupByProducts();$.each(b,function(b,c){n(a,b,c)}),$('.dl-group[value="__NO_PRODUCT"] h3 span').click(function(a){D()}),r()};var n=function(a,b,c){var d,f=c.title,g=$("<h3></h3>").addClass("head").html(f);if(!c.notSelectable){var h=$("<i></i>").attr("id",b+"dynamictext").addClass("dynamic").html("0 selected");d=$("<input type='radio'></input>").attr("value",b).attr("data-product",b),g.prepend(d).append(h)}e.selectedProduct===b&&d.each(function(){this.checked=!0});var i=$("<div class='dl-group'></div>").attr("value",b).attr("data-product",b).click(function(){e.selectProduct($(this).find("input").attr("data-product")),$(".dl-group").removeClass("dl-group-selected"),$(this).addClass("dl-group-selected"),$(".dl-group input").each(function(){this.checked=!1}),$(this).find("input").each(function(){this.checked=!0})}).append(g);a.append(i);var j=$("<ul></ul>").attr("id",l.id+b).addClass(l.id+"category");$.each(c.items,function(a,d){o(j,b,c,d)}),i.append(j)},o=function(a,b,c,d){var e=$("<li></li>").attr("id",l.id+b+encodeURIComponent(d.value)).addClass("item").addClass("item-static");e.append("<h4>"+d.label+"</h4>"),e.append("<p>"+d.sublabel+"</p>"),a.append(e)},p=function(){r()},q=!1,r=function(){var a=$(window).outerHeight(!0),b=$("ul#productsHolder-tabs").outerHeight(!0),c=$("section#productsHolder footer").outerHeight(!0),d=$("#productsHolder").innerHeight()-$("#productsHolder").height(),e=$("#productsHolder").offset(),f=$("#timeline").outerHeight(!0),g=a-b-c-e.top-f-d-10-5;$(l.selector).css("max-height",g);var h=$("#wv-datacontent").outerHeight(!0);g<=h?($("#wv-data").css("height",g).css("padding-right","10px"),q?$(l.selector).perfectScrollbar("update"):($(l.selector).perfectScrollbar(),q=!0)):($("#wv-data").css("height","").css("padding-right",""),q&&($(l.selector).perfectScrollbar("destroy"),q=!1))};l.onViewChange=function(){var c=b.map.selected;if(e.active&&!d&&i&&0!==i.granules.length){var f=!1,g=!1,h=c.getView().calculateExtent(c.getSize()),j=a.proj.selected.crs;_.each(i.granules,function(a){if(a.centroid&&a.centroid[j]&&(f=!0,ol.extent.intersects(h,a.centroid[j].getExtent())))return g=!0,!0}),wv.ui.indicator.hide(k.noneInView),f&&!g&&(k.noneInView=wv.ui.indicator.show("Zoom out or move map"))}};var s=function(){b.sidebar.selectTab("download"),f||(f=wv.data.map(e,j,c)),v(),B()},t=function(){wv.ui.indicator.hide(k),g&&g.hide(),h&&h.hide(),f.dispose()},u=function(a){$(l.selector+" input[value='"+a+"']").prop("checked","true")},v=function(){e.active&&l.refresh()},w=function(){d=!0,k.query=wv.ui.indicator.searching(k),g&&g.hide(),h&&h.hide()},x=function(a){g&&(g.hide(),g=null),d=!1,i=a,wv.ui.indicator.hide(k);var b=!0;null!==e.selectedProduct&&0===a.granules.length&&(k.noData=wv.ui.indicator.noData(k),b=!1),a.meta.showList&&b&&(g=wv.data.ui.selectionListPanel(e,a),g.show()),B()},y=function(){d=!1,wv.ui.indicator.hide(k)},z=function(a,b){d=!1,wv.ui.indicator.hide(k),"abort"!==a&&(console.error("Unable to search",a,b),wv.ui.notify("Unable to search at this time.<br/><br/>Please try again later."))},A=function(){d=!1,wv.ui.indicator.hide(k),wv.ui.notify("No results received yet. This may be due to a connectivity issue. Please try again later.")},B=function(){$button=$("#wv-data-download-button");var a=_.size(e.selectedGranules);if(a>0){$button.button("enable");var b=e.getSelectionSize();if(b){var c=Math.round(100*b)/100;$button.find(".ui-button-text").html("Download Data ("+c+" MB)")}else $button.find(".ui-button-text").html("Download Selected Data")}else $button.button("disable"),$button.find(".ui-button-text").html("No Data Selected");var d=e.getSelectionCounts();$.each(d,function(a,b){$("#"+a+"dynamictext").html(""+b+" selected")}),h&&h.visible()&&h.refresh()},C=function(){WVC.GA.event("Data Download","Click","Download Button"),g&&g.setVisible(!1),h||(h=wv.data.ui.downloadListPanel(c,e),h.events.on("close",function(){g&&g.setVisible(!0)})),h.show()},D=function(){var a="<h3 class='wv-data-unavailable-header'>Why are these layers not available for downloading?</h3>",b='Some layers in Worldview do not have corresponding source data products available for download.  These include National Boundaries, Orbit Tracks, Earth at Night, and MODIS Corrected Reflectance products.<br><br>For a downloadable product similar to MODIS Corrected Reflectance, please try the MODIS Land Surface Reflectance layers available in Worldview.  If you would like to generate MODIS Corrected Reflectance imagery yourself, please see the following document: <a href="https://earthdata.nasa.gov/sites/default/files/field/document/MODIS_True_Color.pdf" target="_blank">https://earthdata.nasa.gov/sites/default/files/field/document/MODIS_True_Color.pdf</a><br><br>If you would like to download only an image, please use the "camera" icon in the upper right.<br><br> Data download will not work for "Terra and Aqua" Fires, select Terra only Fires and/or Aqua only Fires to download the associated data files.';wv.ui.notify(a+b,"Notice",600)};return m(),l},wv.data.ui.bulkDownloadPage=wv.data.ui.bulkDownloadPage||function(){var a={},b={wget:"pages/wget.html",curl:"pages/curl.html"};a.show=function(a,d){var e=Date.now(),f=window.open(b[d]+"?v="+e,"Worldview_"+e),g=!1;f.onload=function(){g||(c(f,a,d),g=!0)};var h=0,i=setInterval(function(){return h++,g?void clearInterval(i):h>20?void clearInterval(i):void(c(f,a,d)&&(g=!0,clearInterval(i)))},100)};var c=function(a,b,c){var d=[],e={},f=[];$.each(b,function(a,b){$.each(b.list,function(a,g){var h="";g.urs&&(h="--netrc "),$.each(g.links,function(a,i){if(i.data){if(b.noBulkDownload)return void f.push("<li><a href='"+i.href+"'>"+i.href+"</a></li>");if("curl"===c?d.push("curl --remote-name "+h+i.href):d.push(i.href),g.urs){var j=/\/\/([^\/]*)\//.exec(i.href);j&&(e[j[1]]=!0)}}})})});var g=a.document.getElementById("links");if(!g)return!1;g.innerHTML="<pre>"+d.join("\n")+"</pre>";var h=[],i=[];if($.each(e,function(a,b){h.push("machine "+a+" login URS_USER password URS_PASSWORD"),i.push(a)}),h.length>0){a.document.getElementById("netrc").innerHTML="<pre>"+h.join("\n")+"</pre>",a.document.getElementById("bulk-password-notice").style.display="block",a.document.getElementById("netrc-instructions").style.display="block";var j=a.document.getElementById("fdm-password-instructions");j&&(j.style.display="block");var k=a.document.getElementById("fdm-machine-names");k&&(k.innerHTML="<pre>"+i.join("\n")+"</pre>")}return f.length>0&&(a.document.getElementById("indirect-instructions").style.display="block",a.document.getElementById("indirect").innerHTML="<ul>"+f.join("\n")+"</ul>"),!0};return a}(),wv.data.ui.downloadListPanel=function(a,b){var c,d,e=wv.data.cmr,f="<div id='wv-data-selection-notice'><i class='icon fa fa-info-circle fa-3x'></i><p class='text'>Some items you have selected require a profile with Earthdata Login to download. It is simple and free to sign up! <a href='https://urs.earthdata.nasa.gov/users/new' target='urs'>Click to register for a profile.</a></p></div>",g={},h=!1;g.events=wv.util.events(),g.show=function(){d=wv.ui.getDialog().attr("id","wv-data-selection"),d.dialog({title:"Download Links",width:600,height:500,autoOpen:!1});var a=$("<div></div>").attr("id","wv-data-bulk-download-links").addClass("ui-dialog-buttonpane").addClass("ui-widget-content").addClass("ui-helper-clearfix").html(p());$("#wv-data-selection").after(a),$(".ui-dialog .ui-dialog-titlebar-close").attr("tabindex",-1),d.dialog("open"),$("a.wget").click(q),$("a.curl").click(r),d.find(".collapse").accordion({collapsible:!0,active:!1,icons:{header:"fa fa-caret-right fa-fw",activeHeader:"fa fa-caret-down fa-fw"}}),d.on("dialogclose",function(){g.events.trigger("close")}),g.refresh()},g.refresh=function(){c=i(),$("#wv-data-selection").html(o(c));var a=j()&&0!==_.size(b.selectedGranules);a?$("wv-data-bulk-download-links").show():$("wv-data-bulk-download-links").hide(),$("#wv-data-selection .remove").click(s),$("#wv-data-selection tr").on("mouseenter",t),$("#wv-data-selection tr").on("mouseleave",u)},g.hide=function(){var a=$(".ui-dialog");0!==a.length&&a.hide()},g.visible=function(){var a=$(".ui-dialog");return 0!==a.length&&a.is(":visible")};var i=function(){var c={};return h=!1,$.each(b.selectedGranules,function(b,d){d.urs&&(h=!0),c[d.product]?c[d.product].granules.push(d):(productConfig=a.products[d.product],c[d.product]={name:productConfig.name,granules:[d],counts:{},noBulkDownload:productConfig.noBulkDownload||!1});var f=c[d.product];d.product;$.each(d.links,function(a,b){var c=b.href.toLowerCase().split(".").slice(-1);c&&c.length>0&&(c=c[0]),(e.DATA_EXTS.indexOf(c)===-1&&b.rel!==e.REL_BROWSE||b.rel===e.REL_METADATA)&&(f.counts[b.href]?f.counts[b.href]++:f.counts[b.href]=1)})}),$.each(c,function(a,b){b.links=[],b.list=[];var c=b.granules[0];$.each(c.links,function(a,c){var d=b.counts[c.href];d%b.granules.length===0&&b.links.push(k(c))}),$.each(b.granules,function(a,c){var d={id:c.id,label:c.downloadLabel||c.label,links:[],urs:c.urs};$.each(c.links,function(a,c){var f=b.counts[c.href];f%b.granules.length!==0&&c.rel!==e.REL_BROWSE&&d.links.push(k(c))}),b.list.push(d)}),b.list.sort(function(a,b){return a.label>b.label?1:a.label<b.label?-1:0})}),c},j=function(){var a=!1;return $.each(c,function(b,c){c.noBulkDownload||(a=!0)}),a},k=function(a){var b=a.title;return a.title||(b=a.href.split("/").slice(-1),b&&b.length&&""===b[0]&&(b=a.href)),{href:a.href,title:b,data:a.rel===e.REL_DATA}},l=function(a){var b=[];return b.push("<ul>"),$.each(a,function(a,c){b.push("<li class='link'><a href='"+c.href+"' target='_blank'>"+c.title+"</a></li>")}),b.push("</ul>"),b.join("\n")},m=function(a,b){var c;return c=a.name!==b.label?["<tr data-granule='"+b.id+"'>","<td><input type='button' class='remove' data-granule='"+b.id+"' value='X'></input></td>","<td><nobr><ul><li>"+b.label+"</li></ul></nobr></td>","<td class='wv-data-granule-link'>"+l(b.links)+"</td>","</tr>"]:["<tr data-granule='"+b.id+"'>","<td><input type='button' class='remove' data-granule='"+b.id+"' value='X'></input></td>","<td colspan='2'>"+l(b.links)+"</td>","</tr>"],c.join("\n")},n=function(a){var b=["<h3>"+a.name+"</h3>"];return b.push("<h5>Selected Data</h5>"),b.push("<table>"),$.each(a.list,function(c,d){b.push(m(a,d))}),b.push("</table>"),a.links&&a.links.length>0&&(b.push("<h5>Data Collection Information</h5>"),b.push("<div class='product'>"),b.push(l(a.links)),b.push("</div>")),b.join("\n")},o=function(){if(0===_.size(b.selectedGranules))return"<br/><h3>Selection Empty</h3>";var a=[];h&&a.push(f);var d=[];$.each(c,function(a,b){d.push(n(b))}),a.push(d.join("<br/><br/><br/>"));var e=a.join("");return e},p=function(){var a="<div class='bulk collapse'><h5>Bulk Download</h5><ul class='BulkDownload'><li><a class='wget' href='#'>List of Links</a>: for wget or download managers that accept a list of URLs</li><li><a class='curl' href='#'>List of cURL Commands</a>: can be copied and pasted to a terminal window to download using cURL.</li></ul></div>";return a},q=function(){wv.data.ui.bulkDownloadPage.show(c,"wget")},r=function(){wv.data.ui.bulkDownloadPage.show(c,"curl")},s=function(){var a=$(this).attr("data-granule");b.unselectGranule(b.selectedGranules[a]),u.apply(this)},t=function(){b.events.trigger("hoverOver",b.selectedGranules[$(this).attr("data-granule")])},u=function(){b.events.trigger("hoverOut",b.selectedGranules[$(this).attr("data-granule")])};return g},wv.data.ui.selectionListPanel=function(a,b){var c,d={},e={},f=function(){a.events.on("granuleUnselect",j)};d.show=function(){c=wv.ui.getDialog("wv-data-list"),c.attr("id","wv-data-list").html(h()).dialog({title:"Select data",width:400,height:400}),$("button.ui-dialog-titlebar-close").hide(),$.each(b.granules,function(a,b){e[b.id]=b}),$("#wv-data-list input").on("click",i)},d.hide=function(){var a=$(".ui-dialog");0!==a.length&&a.hide()},d.visible=function(){var a=$(".ui-dialog");return 0!==a.length&&a.is(":visible")},d.setVisible=function(a){a?d.show():d.hide()};var g=function(){var c=[];$.each(b.granules,function(b,d){var e=a.isSelected(d)?"checked='true'":"";c.push("<tr><td><input type='checkbox' value='"+d.id+"' "+e+"></td><td class='label'>"+d.label+"</td></tr>")});var d=c.join("\n");return d},h=function(){var a=["<div'>","<table>",g(),"</table>","</div>"],b=a.join("\n")+"<br/>";return b},i=function(b,c){var d=e[$(this).attr("value")],f=$(this).prop("checked");f?a.selectGranule(d):a.unselectGranule(d)},j=function(a){$("#wv-data-list input[value='"+a.id+"']").removeAttr("checked")};return f(),d};var wv=wv||{};wv.map=wv.map||{},wv.map=function(a){return a.CRS_WGS_84="EPSG:4326",a.CRS_WGS_84_QUERY_EXTENT=[-180,-60,180,60],a.parse=function(a,b){if(a.map&&(a.v=a.map,delete a.map),a.v){var c=_.map(a.v.split(","),function(a){return parseFloat(a)}),d=wv.map.isExtentValid(c);d?a.v=c:(b.push({message:"Invalid extent: "+a.v}),delete a.v)}},a.isExtentValid=function(a){if(_.isUndefined(a))return!1;var b=!0;return a.toArray&&(a=a.toArray()),_.each(a,function(a){if(isNaN(a))return b=!1,!1}),b},a.tileScheduler=_.once(function(){if(wv.util.browser.webWorkers)return wv.map.palette.scheduler({script:"js/map/wv.map.tileworker.js?v="+wv.brand.BUILD_NONCE,max:4})}),a.setOpacity=function(a,b){if(a.setOpacity(b),1===b){var c=a.originalTransitionEffect||"resize";a.transitionEffect=c}else a.originalTransitionEffect=a.transitionEffect,a.transitionEffect="none"},a.setVisibility=function(a,b,c){if(a.isControl)a.setVisibility(b);else{var d=b?c:0;a.div.style.opacity=d,b&&c>0&&!a.getVisibility()&&a.setVisibility(!0)}},a.getLayerByName=function(a,b){var c=a.getLayers().getArray();return _.find(c,{wvname:b})},a.isPolygonValid=function(a,b){for(var c=a.getLinearRing(0),d=c.getCoordinates(),e=0;e<d.length-1;e++){var f=d[e],g=d[e+1];if(Math.abs(g[0]-f[0])>b)return!1}return!0},a.adjustAntiMeridian=function(a,b){for(var c=a.getLinearRing(0),d=c.getCoordinates().slice(),e=0;e<d.length;e++)b>0&&d[e][0]<0&&(d[e]=[d[e][0]+360,d[e][1]]),b<0&&d[e][0]>0&&(d[e]=[d[e][0]-360,d[e][1]]);return new ol.geom.Polygon([d])},a.distance2D=function(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2))},a.distanceX=function(a,b){return Math.abs(b-a)},a.interpolate2D=function(a,b,c){var d=b[0]-a[0],e=b[1]-a[1],f=a[0]+d*c,g=a[1]+e*c;return[f,g]},a.toPolys=function(a){return a.getPolygons?a.getPolygons():[a]},a}(wv.map||{});var wv=wv||{};wv.map=wv.map||{},wv.map.model=wv.map.model||function(a,b){var c={};return c.extent=null,c.events=wv.util.events(),c.rotation=0,c.update=function(a){c.extent=a,c.events.trigger("update",a)},c.load=function(b,d){if(b.v){var e=a.proj.selected,f=b.v,g=e.maxExtent;"geographic"===e.id&&(e.wrapExtent=g=[-250,-90,250,90]),ol.extent.intersects(f,g)?c.extent=b.v:(c.extent=_.clone(e.maxExtent),d.push({message:"Extent outside of range"}))}"arctic"!==b.p&&"antarctic"!==b.p||isNaN(b.r)||(c.rotation=b.r*(Math.PI/180))},c.save=function(b){b.v=_.clone(c.extent),0!==c.rotation&&0!==c.rotation&&"geographic"!==a.proj.selected.id&&(b.r=(c.rotation*(180/Math.PI)).toPrecision(6))},c.getLeadingExtent=function(){var a=wv.util.now().getUTCHours();a<3?a=23:a<9&&(a=0);var b=20.6015625+a*-8.71875,c=b+159.328125,d=-46.546875,e=53.015625;return[b,d,c,e]},c};var wv=wv||{};wv.map=wv.map||{},wv.map.animate=wv.map.animate||function(a,b,c){var d,e=(a.map,{}),f=function(){};e.move=function(a,b,e,f){var j,k,l,m,n,o,p,q;q=c.map.selected,j=d||q.getView().getCenter(),k=q.getView().getZoom(),l=e||5,m="fly"==a?5e3:1e3,n="fly"==a?1e3:1,p=q.getView(),b.length>2&&(b=ol.extent.getCenter(b)),o=k>=8?4:k-3,o<0&&(o=0),k<4&&(a="zoom"),setTimeout(function(){"fly"===a?(h(p,m,o,l),i(p,m,b,l)):"zoom"===a?(g(p,m,l),i(p,m,b,l)):i(p,m,b,l),f()},n),d=b};var g=function(a,b,c){a.animate({duration:b,zoom:c})},h=function(a,b,c,d){a.animate({zoom:c,duration:b/2},{zoom:d,duration:b/2})},i=function(a,b,c){a.animate({duration:b,center:c})};return f(),e};var wv=wv||{};wv.map=wv.map||{},wv.map.runningdata=wv.map.runningdata||function(a){var b,c,d,e,f;b=this,b.layers=[],b.prePixelData=[],b.pixel=null,b.oldLayers=[],b.init=function(){c=$("#products"),d=c.height(),e=c.scrollTop(),f=e+d,a.layers.events.on("change",function(){setTimeout(function(){d=c.height(),f=e+d},300)}),c.on("scroll",function(){e=c.scrollTop(),f=e+d})},b.getDataLabel=function(a,b){for(var c=a.units||"",d=0,e=a.colors.length;d<e;d++)if(wv.util.hexColorDelta(a.colors[d],b)<5)return{label:a.tooltips[d]+" "+c,len:e,index:d}},b.getLabelMarginLeft=function(a,b,c){return c+a/2>b?b-a-5:c-a/2<0?0:c-(a/2+5)};var g=function(a){var b,c,d=$(".productsitem[data-layer='"+a+"']");return!!(d[0]&&(b=d[0].offsetTop,c=b+d.height(),b>=e&&b<=f||c>=e&&c<=f))};b.getPalette=function(a){return $("#"+a)},b.getPercent=function(a,b,c){var d,e;return a<250?(d=c/a,e=d*b+.5*d,e/c):b/a},b.LayersToRemove=function(a,b){return _.difference(a,b)},b.newPoint=function(c,d){b.activeLayers=[],d.forEachLayerAtPixel(c,function(c,d){var e,f;if(c.wv&&c.wv.def.palette){if(f=c.wv.id,!g(f))return;legends=a.palettes.getLegends(f),e=wv.util.rgbaToHex(d[0],d[1],d[2],d[3]),_.each(legends,function(a){a&&b.createRunnerFromLegend(a,e)})}}),b.update()},b.update=function(){b.oldLayers.length&&b.updateRunners(b.LayersToRemove(b.oldLayers,b.activeLayers)),b.oldLayers=b.activeLayers},b.newLegend=function(a,d){b.activeLayers=[a.id],c.addClass("active-lengend"),b.createRunnerFromLegend(a,d),b.update()},b.createRunnerFromLegend=function(a,c){var d;"continuous"===a.type||"discrete"===a.type?(d=b.getDataLabel(a,c),d&&(b.setLayerValue(a.id,d),b.activeLayers.push(a.id))):"classification"===a.type&&(d=b.getDataLabel(a,c),d&&(b.setCategoryValue(a.id,d),b.activeLayers.push(a.id)))},b.remove=function(a){var b=$("#"+a),c=b.parent();c.removeClass("wv-running"),b.removeClass("wv-running")},b.clearAll=function(){c.removeClass("active-lengend"),$(".wv-running").removeClass("wv-running")},b.setCategoryValue=function(a,b){var c,d,e,f,g,h,i,j;i=3,j=15,c=$("#"+a),f=c.find("[data-class-index='"+b.index+"']"),g=c.find(".wv-running-category-label"),d=c.width(),g.text(b.label),e=wv.util.getTextWidth(b.label,"Lucida Sans"),h=(i+j)*b.index,h<5&&(h=5),g.attr("style","left:"+Math.round(h)+"px;"),c.addClass("wv-running"),c.find(".wv-active").removeClass("wv-active"),f.addClass("wv-active")},b.setLayerValue=function(a,c){var d,e,f,g,h,i,j,k;d=b.getPalette(a),e=d.parent(),f=d.width(),$paletteCaseWidth=e.outerWidth(),$paletteLabel=e.find(".wv-running-label"),$paletteBar=e.find(".wv-running-bar"),h=b.getPercent(c.len,c.index,f),k=($paletteCaseWidth-f)/2,j=f*h+k,$paletteLabel.text(c.label),g=wv.util.getTextWidth(c.label,"Lucida Sans"),i=b.getLabelMarginLeft(g,f,j),$paletteLabel.attr("style","left:"+Math.round(i)+"px;"),$paletteBar.attr("style","left:"+Math.round(j)+"px;"),e.addClass("wv-running")},b.updateRunners=function(a){if(a.length)for(var c=0,d=a.length;c<d;c++)b.remove(a[c])},b.init()};var wv=wv||{};wv.map=wv.map||{},wv.map.rotate=wv.map.rotate||function(a,b,c){this.evts=wv.util.events();b.map;this.intervalId=null;var d=this;this.init=function(a,b){this.buildRotationWidget(a),this.setRotationEvents(a,b)},this.buildRotationWidget=function(a){var b=$("#"+a.getTarget()),c=$("<button></button>").addClass("wv-map-rotate-left wv-map-zoom").attr("title","You may also rotate by holding Alt and dragging the mouse"),d=$("<i></i>").addClass("fa fa-undo"),e=$("<button></button>").addClass("wv-map-rotate-right wv-map-zoom").attr("title","You may also rotate by holding Alt and dragging the mouse"),f=$("<i></i>").addClass("fa fa-repeat"),g=$("<button></button>").addClass("wv-map-reset-rotation wv-map-zoom").attr("title","Click to reset").attr("style","width: 43px");c.append(d),e.append(f),b.append(c).append(g).append(e)},this.setRotationEvents=function(a,c){var e=500,f=$("#wv-map-"+c+" .wv-map-rotate-left"),g=$("#wv-map-"+c+" .wv-map-rotate-right"),h=$("#wv-map-"+c+" .wv-map-reset-rotation");f.button({text:!1}).mousedown(function(){d.intervalId=setInterval(function(){d.rotate(10,e,a)},e),d.rotate(10,e,a)}).mouseup(function(){clearInterval(d.intervalId)}),g.button({text:!1}).mousedown(function(){d.intervalId=setInterval(function(){d.rotate(-10,e,a)},e),d.rotate(-10,e,a)}).mouseup(function(){clearInterval(d.intervalId)}),h.button({label:Number(b.map.rotation*(180/Math.PI)).toFixed()}).mousedown(function(){clearInterval(d.intervalId),a.getView().animate({duration:500,rotation:0}),h.button("option","label","0")})},this.updateRotation=function(){var c,e;e=a.selected.getView(),c=e.getRotation(),b.map.rotation=c,d.setResetButton(c)},this.setResetButton=function(a){var b=$(".wv-map-reset-rotation"),c=a*(180/Math.PI);switch(b.button("option","label",Number(c).toFixed()),!0){case c>=100:b.find("span").attr("style","padding-left: 9px");break;case c<=-100:b.find("span").attr("style","padding-left: 6px");break;case c<=-10:b.find("span").attr("style","padding-left: 10px");break;default:b.find("span").attr("style","padding-left: 14px")}},this.rotate=function(a,b,c){var d=c.getView().getRotation()*(180/Math.PI);if(360===Math.abs(d))c.getView().setRotation(0);else if(Math.abs(d)>=360){var e=(360-Math.abs(d))*(Math.PI/180);d<0?c.getView().setRotation(e):c.getView().setRotation(-e)}c.getView().animate({rotation:c.getView().getRotation()-Math.PI/a,duration:b})}};var wv=wv||{};wv.map=wv.map||{},wv.map.layerbuilder=wv.map.layerbuilder||function(a,b,c,d){var e={};e.init=function(a){e.extentLayers=[],a.events.on("selecting",h),a.events.on("selectiondone",i)},e.createLayer=function(b,d){var h,i,j,k,l,m,n,o;if(n=null,d=d||{},i=e.layerKey(b,d),j=a.proj.selected,k=c.getItem(i),!k){if(h=d.date||a.date.selected,o={id:b.id,key:i,date:wv.util.toISOStringDate(h),proj:j.id,def:b},b=_.cloneDeep(b),_.merge(b,b.projections[j.id]),"wmts"===b.type)k=f(b,d),"geographic"===j.id&&b.wrapadjacentdays===!0&&(l=f(b,d,1),m=f(b,d,-1),k.wv=o,m.wv=o,l.wv=o,k=new ol.layer.Group({layers:[k,l,m]}));else{if("wms"!==b.type)throw new Error("Unknown layer type: "+b.type);k=g(b,d),"geographic"===j.id&&b.wrapadjacentdays===!0&&(l=g(b,d,1),m=g(b,d,-1),k.wv=o,m.wv=o,l.wv=o,k=new ol.layer.Group({layers:[k,l,m]}))}k.wv=o,c.setItem(i,k),k.setVisible(!1)}return k.setOpacity(b.opacity||1),k},e.layerKey=function(b,c){var d,e=b.id,f=a.proj.selected.id;d=c.date?wv.util.toISOStringDate(c.date):wv.util.toISOStringDate(a.date.selected);var g="daily"===b.period?d:"",h="";return a.palettes.isActive(b.id)&&(h=a.palettes.key(b.id)),[e,f,g,h].join(":")};var f=function(c,d,e){var f,g,h,i,j,k,l,m;if(f=a.proj.selected,g=b.sources[c.source],l=f.maxExtent,m=[f.maxExtent[0],f.maxExtent[3]],!g)throw new Error(c.id+": Invalid source: "+c.source);if(h=g.matrixSets[c.matrixSet],!h)throw new Error(c.id+": Undefined matrix set: "+c.matrixSet);i=[],_.each(h.resolutions,function(a,b){i.push(b)}),j="",e&&(1===e?(l=[-250,-90,-180,90],m=[-540,90]):(l=[180,-90,250,90],m=[180,90])),"daily"===c.period&&(k=d.date||a.date.selected,e&&(k=wv.util.dateAdd(k,"day",e)),j="?TIME="+wv.util.toISOStringDate(k));var n={url:g.url+j,layer:c.layer||c.id,crossOrigin:"anonymous",format:c.format,matrixSet:h.id,tileGrid:new ol.tilegrid.WMTS({origin:m,resolutions:h.resolutions,matrixIds:i,tileSize:h.tileSize[0]}),wrapX:!1,style:"default"};if(a.palettes.isActive(c.id)){var o=a.palettes.getLookup(c.id);n.tileClass=ol.wv.LookupImageTile.factory(o)}var p=new ol.layer.Tile({extent:l,source:new ol.source.WMTS(n)});return p},g=function(c,d,e){var f,g,h,i,j,k,l,m;if(f=a.proj.selected,g=b.sources[c.source],k=f.maxExtent,l=[f.maxExtent[0],f.maxExtent[3]],m=f.resolutions,!g)throw new Error(c.id+": Invalid source: "+c.source);i="image/png"===c.format,"geographic"===f.id&&(m=[.28125,.140625,.0703125,.03515625,.017578125,.0087890625,.00439453125,.002197265625,.0010986328125,.00054931640625,.00027465820313]),e&&(1===e?(k=[-250,-90,-180,90],l=[-540,90]):(k=[180,-90,250,90],l=[180,90])),parameters={LAYERS:c.layer||c.id,FORMAT:c.format,TRANSPARENT:i,VERSION:"1.1.1"},c.styles&&(parameters.STYLES=c.styles),h="","daily"===c.period&&(j=d.date||a.date.selected,e&&(j=wv.util.dateAdd(j,"day",e)),h="?TIME="+wv.util.toISOStringDate(j));var n=new ol.layer.Tile({extent:k,source:new ol.source.TileWMS({url:g.url+h,wrapX:!0,style:"default",crossOrigin:"anonymous",params:parameters,tileGrid:new ol.tilegrid.TileGrid({origin:l,resolutions:m})})});return n},h=function(){var b,d,f;f=a.layers.active;for(var g=0,h=f.length;g<h;g++)b=f[g],b.wrapadjacentdays&&b.visible&&(d=e.layerKey(b,{date:a.date.selected}),b=c.getItem(d),b.setExtent([-180,-90,180,90]))},i=function(){var b,d,f;d=a.layers.active;for(var g=0,h=d.length;g<h;g++)b=d[g],b.wrapadjacentdays&&b.visible&&(f=e.layerKey(b,{date:a.date.selected}),b=c.getItem(f),b.setExtent([-250,-90,250,90]))};return e.init(d),e};var wv=wv||{};wv.map=wv.map||{},wv.map.precachetile=wv.map.precachetile||function(a,b,c,d){self.promiseDay=function(a){var b,f,g,i,j,k,l;return j=e(a),k=d.selected,f=d.selected.frameState_,i=f.pixelRatio,b=f.viewState,l=j.map(function(e){var f,j,l=0;return l=0,f=d.layerKey(e,{date:a}),j=c.getItem(f),j&&c.removeItem(f),j=d.createLayer(e,{date:a}),h(j,g,b,i,k)}),new Promise(function(b){Promise.all(l).then(function(c){b(a)})})};var e=function(b){var c,d=[];return c=a.layers.get(),_.each(c,function(a){a.visible&&new Date(a.startDate>b)&&d.push(a)}),d},f=function(a,b){return a[1]<-180?(a=g(b,a),a[1]=a[1]+360,a[3]=a[3]+360):a[1]>180?(a=g(b,a),a[1]=a[1]-360,a[3]=a[3]-360):a=g(a,b),isFinite(a[0])?a:null},g=function(a,b){return ol.extent.getIntersection(a,b)},h=function(a,b,c,d,e){return new Promise(function(g,h){
var j,k;j=a.values_.layers,j=a.values_.layers?a.getLayers().getArray():[a],k=j.map(function(a){return b=f(a.getExtent(),e.getView().calculateExtent(e.getSize())),i(a,b,c,d)}),Promise.all(k).then(function(a){g("reslove layer group")})})},i=function(a,b,c,d){var e,f,g,h,i,j;return new Promise(function(k,l){b||k("reslove tile layer"),j=c.projection,h=0,e=new ol.renderer.canvas.TileLayer(a),f=a.getSource(),i=f.getTileGridForProjection(j),g=i.getZForResolution(c.resolution,e.zDirection),i.forEachTileCoord(b,g,function(a){var b;b=f.getTile(a[0],a[1],a[2],d,j),b.load();var c=function(a){"tileloadend"===a.type?(--h,0===h&&k()):l(new Error("No response at this URL")),this.un("tileloadend",c),this.un("tileloaderror",c)};f.on("tileloadend",c),f.on("tileloaderror",c),++h})})};return self};var wv=wv||{};wv.map=wv.map||{},wv.map.datelinebuilder=wv.map.datelinebuilder||function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o={};o.init=function(b,d,e){var h;c=d,g=React.createFactory(WVC.DateLine),f=React.createFactory(WVC.LineText),u(c,e),n=a.proj.selected.id,b.events.on("moveend",function(){p()&&(t(!0),h=y(c),z(h))}),b.events.on("drag",function(){p()&&t(!1)}),b.events.on("movestart",function(){p()&&t(!1)}),a.date.events.on("select",function(){x(a.date.selected)}),a.proj.events.on("select",function(){n=a.proj.selected.id})};var p=function(){return"geographic"===n},q=function(a,b,c,d,e,f){var g={height:b,lineOver:v,lineOut:w,lineX:c,overlay:d,tooltip:f};return ReactDOM.render(s(a,g),e)},r=function(a,b,c){var d={dateLeft:wv.util.toISOStringDate(wv.util.dateAdd(c,"day",1)),dateRight:wv.util.toISOStringDate(c)};return ReactDOM.render(s(a,d),b)},s=function(a,b){return a(b)},t=function(a){var b={active:a};k.setState(b),j.setState(b)},u=function(a,b){var c,n,o,p,s;n=document.createElement("div"),o=document.createElement("div"),p=document.createElement("div"),s=document.createElement("div"),c=0,d=A([-180,90],n),e=A([180,90],o),h=A([-180,90],p),i=A([180,90],s),a.addOverlay(d),a.addOverlay(e),a.addOverlay(h),a.addOverlay(i),l=r(f,p,b),m=r(f,s,wv.util.dateAdd(b,"day",-1)),j=q(g,c,-180,h,n,l),k=q(g,c,180,i,o,m)},v=function(a,b,d,e){var f;f=c.getCoordinateFromPixel(a),b.setPosition([d,f[1]]),e.setState({active:!0})},w=function(a){a.setState({active:!1})},x=function(a){var b,c;b={dateLeft:wv.util.toISOStringDate(wv.util.dateAdd(a,"day",1)),dateRight:wv.util.toISOStringDate(a)},c={dateLeft:wv.util.toISOStringDate(a),dateRight:wv.util.toISOStringDate(wv.util.dateAdd(a,"day",-1))},l.setState(b),m.setState(c)},y=function(a){var b,c,d,e,f,g,h,i,j;if(0!==a.getSize()[0])return b=a.getView().calculateExtent(a.getSize()),c=[b[2]-1,b[3]+5],f=[b[2]-1,b[1]-5],i=a.getPixelFromCoordinate([b[2]-1,b[3]-1]),j=a.getPixelFromCoordinate([b[0]+1,b[1]+1]),d=Math.round(i[1]+5),e=Math.round(j[1]-5),h=Math.round(b[3]+5),h>90?(h=90,d=a.getPixelFromCoordinate([b[2],90])[1]):d=a.getPixelFromCoordinate(c)[1],e=b[1]>-90?a.getPixelFromCoordinate(f)[1]:a.getPixelFromCoordinate([b[2],-90])[1],g=Math.round(Math.abs(e-d)),[g,h]},z=function(a){var b={height:a[0]};k.setState(b),j.setState(b),d.setPosition([-180,a[1]]),e.setPosition([180,a[1]])},A=function(a,b){var c=new ol.Overlay({element:b,stopEvent:!1});return c.setPosition(a),c};return o};var wv=wv||{};wv.link=wv.link||{},wv.link.model=wv.link.model||function(a){var b={},c="http://go.nasa.gov/1iKIZ4j",d=[{match:new RegExp("%2C","g"),replace:","},{match:new RegExp("%3B","g"),replace:";"},{match:new RegExp("%3D","g"),replace:"="}],e=new Cache(10),f="",g=[];b.events=wv.util.events();var h=function(){a&&a.parameters&&a.parameters.shorten&&(f="-"+a.parameters.shorten)};b.register=function(a){return g.push(a),a.events&&a.events.any(function(){b.events.trigger("update")}),b},b.toQueryString=function(){var a={};_.each(g,function(b){b.save(a)});var b=_.map(a,function(a,b){if(_.isArray(a)){var c=[];_.each(a,function(a){var b="";if(_.isObject(a)){if(b=a.id,a.attributes&&a.attributes.length>0){var d=[];_.each(a.attributes,function(a){a.value?d.push(a.id+"="+a.value):d.push(a.id)}),b+="("+d.join(",")+")"}}else b=a;c.push(b)}),a=c.join(",")}return b+"="+i(a)});return b.join("&")},b.get=function(){var a=b.toQueryString(),c=window.location.href,d=c.split("?")[0];return d=null!==d&&void 0!==d?d:c,d+"?"+a},b.shorten=function(a){if(a||(a=b.get()),e[a])return $.Deferred().resolve(e[a]);if(/localhost/.test(a))return console.warn("Cannot shorten localhost, using",c),$.Deferred().resolve({status_code:200,data:{url:c}});var d=$.getJSON("service/link/shorten.cgi"+f+"?url="+encodeURIComponent(a));return d.done(function(b){e[a]=b}),d},b.load=function(a,b){b=b||[],_.each(g,function(c){c.load(a,b)})};var i=function(a){var b=encodeURIComponent(a);return _.each(d,function(a){b=b.replace(a.match,a.replace)}),b};return h(),b};var wv=wv||{};wv.link=wv.link||{},wv.link.ui=wv.link.ui||function(a,b){var c,d,e={},f="wv-link-button",g="#"+f,h=function(){c=$("<input></input>").attr("type","checkbox").attr("id","wv-link-button-check"),d=$("<label></label>").attr("for","wv-link-button-check").attr("title","Share this map");var b=$("<i></i>").addClass("fa").addClass("fa-link").addClass("fa-2x");d.append(b),$(g).append(d),$(g).append(c),c.button({text:!1}).click(function(){var a=$("#wv-link-button-check").prop("checked");WVC.GA.event("Link","Click","Share link Button"),a?e.show():wv.ui.closeDialog()}),a.link.events.on("update",i)},i=_.throttle(function(){wv.util.browser.history&&window.history.replaceState("","EOSDIS Worldview","?"+a.link.toQueryString())},2e3,{leading:!0,trailing:!0});return e.show=function(){var e=wv.ui.getDialog(),f="<div id='wv-link' ><input type='text' value='' name='permalink_content' id='permalink_content' readonly/>";b.features.urlShortening&&(f+="<span autofocus></span><div id='wv-link-shorten'><input type='checkbox' value='' id='wv-link-shorten-check' /><label id='wv-link-shorten-label' for='wv-link-shorten-check'>Shorten this link</label></div>"),f+="</div>",e.html(f).iCheck({checkboxClass:"icheckbox_square-grey"});var g=function(){$("#permalink_content").val(a.link.get()),$("#wv-link-shorten-check").iCheck("uncheck"),$("#permalink_content").focus(),$("#permalink_content").select()};a.link.events.on("update",g),e.dialog({dialogClass:"wv-panel",title:"Copy this link to share:",show:{effect:"slide",direction:"up"},width:300,height:"auto",minHeight:10,draggable:!1,resizable:!1,autoOpen:!1}).on("dialogclose",function(){$("#wv-link-button-check").prop("checked",!1),c.button("refresh"),a.link.events.off("update",g)}),wv.ui.positionDialog(e,{my:"left top",at:"left bottom+5",of:d}),$(".ui-dialog").zIndex(600),$("#permalink_content").val(a.link.get()),e.dialog("open"),setTimeout(g,500),$("#wv-link-shorten-check").on("ifChanged",function(){var b=$("#wv-link-shorten-check").prop("checked");if(b){var c=a.link.shorten();WVC.GA.event("Link","Check","Shorten"),$("#permalink_content").val("Please wait..."),c.done(function(a){200===a.status_code?$("#permalink_content").val(a.data.url):h(a.status_code,a.status_txt)}).fail(function(a,b,c){h(b,c)})}else $("#permalink_content").val(a.link.get()),WVC.GA.event("Link","Check","Lengthen");$("#permalink_content").focus(),$("#permalink_content").select()});var h=function(){console.warn("Unable to shorten URL"),console.warn.apply(console,arguments),wv.ui.notify("Unable to shorten the permalink at this time. Please try again later.")};$("#wv-link-shorten-check").prop("checked",!1)},h(),e};var wv=wv||{};wv.naturalEvents=wv.naturalEvents||{},wv.naturalEvents.request=wv.naturalEvents.request||function(a,b,c){self={},self.events=wv.util.events(),self.EVENT_QUERY_RESULTS="queryResults",self.EVENT_SELECT="select",self.apiURL=c.features.naturalEvents.host;var d=!1,e=a.naturalEvents;self.ignored=c.naturalEvents.skip||[],e.data={};var f=function(){self.events.on("queryResults",g),self.query()},g=function(){if(e.data.sources&&e.data.types&&e.data.events){d=!0;var a=[];_.each(e.data.events,function(b){self.ignored.includes(b.categories[0].title)||(b.categories[0].css=b.categories[0].title.toLowerCase().split(" ").join("-"),a.push(b))}),e.data.events=a}},h=function(a){var b=self.apiURL+"/events";$.getJSON(b,function(a){e.data.events=a.events,self.events.trigger("queryResults")})},i=function(a){var b=self.apiURL+"/categories";$.getJSON(b,function(a){e.data.types=a.categories,self.events.trigger("queryResults")})},j=function(a){var b=self.apiURL+"/sources";$.getJSON(b,function(a){e.data.sources=a.sources,self.events.trigger("queryResults")})};return self.query=function(a){i(),h(),j()},f(),self};var wv=wv||{};wv.naturalEvents=wv.naturalEvents||{},wv.naturalEvents.model=wv.naturalEvents.model||function(a,b){var c={};c.selected=null,c.active=!1,c.layers=b.naturalEvents.layers;return c.events=wv.util.events(),c.save=function(a){c.active&&(a.e="t")},c.load=function(b){"t"==b.e&&a.wv.events.on("startup",function(){wvx.ui.sidebar.selectTab("events")})},c};var wv=wv||{};wv.naturalEvents=wv.naturalEvents||{},wv.naturalEvents.ui=wv.naturalEvents.ui||function(a,b,d,e){var f,g={},h=a.naturalEvents;g.selector="#wv-events",g.id="wv-events";var i,j=b.map,k=(b.map.selected,wv.naturalEvents.map(a,j,d)),l=!1,m=-1,n=-1,o=function(){e.events.on("queryResults",p),b.sidebar.events.on("select",function(a){"events"===a?(h.active=!0,y(),k.current&&k.draw(k.current)):(h.active=!1,k.dispose(),i.dialog("close")),h.events.trigger("change")}),$(window).resize(y),q()},p=function(){h.data.sources&&(f=h.data.events,g.refresh())},q=function(){var a=$(g.selector).empty().addClass(g.id+"list").addClass("bank"),b=$("<ul></ul>").attr("id",g.id+"content").addClass("content").addClass("map-item-list");a.append(b);var c=$("<div></div>").attr("id","wv-events-detail").hide();a.append(c);var d=$("<span></span>").addClass("notify-message"),e=$("<i></i>").addClass("fa fa-warning fa-1x"),f=$("<div></div>").click(function(a){r()});f.append(e).append(d);var h=$("<i></i>").addClass("fa fa-times fa-1x").click(function(a){i.dialog("close")});i=$("<div></div>").append(h).append(f).dialog({autoOpen:!1,resizable:!1,height:40,width:420,draggable:!1,show:{effect:"fade",duration:400},hide:{effect:"fade",duration:200},dialogClass:"no-titlebar notify-alert",close:function(a,b){l=!0}})},r=function(){var a="<h3 class='wv-data-unavailable-header'>Why can’t I see an event?</h3>",b='There are a variety of factors as to why you may not be seeing an event in Worldview at the moment.<ul><li>Satellite overpass may have occurred before the event. Check out subsequent days or try a different satellite/sensor which has a different overpass time.</li><li>Cloud cover may obscure the event.</li><li>Some events don’t appear on the day that they are reported, you may have to wait a day or two for an event to become visible. Try and scroll through the days to see an event’s progression and/or change the satellite/sensor. NOTE: Wildfire events are currently set to automatically display the next day, as fire events often do not appear in the satellite imagery on the day they are reported.</li><li>The resolution of the imagery may be too coarse to see an event.</li><li>There are normal swath data gaps in some of the imagery layers due to way the satellite orbits the Earth, and an event may have occurred in the data gap.</li></ul>This is currently an experimental feature and we are working closely with the provider of these events, the <a href="http://eonet.sci.gsfc.nasa.gov/" target="_blank">Earth Observatory Natural Event Tracker</a>, to refine this listing to only show events that are visible with our satellite imagery.';wv.ui.notify(a+b,"Notice",800)};g.refresh=function(){var a=$(g.selector+"content");a=$(g.selector+"content").empty(),_.each(f,function(b,c){s(a,b,c)});var c;$(g.selector+"content li").toggle(function(){c&&c.click();var a=$(this).attr("data-index");t(a),$(g.selector+"content li").removeClass("item-selected"),$(this).addClass("item-selected"),wv.util.browser.small&&b.sidebar.collapseNow(),v(),c=$(this)},function(){$(g.selector+"content li").removeClass("item-selected"),u(),k.dispose(),k.current=null,c=null}),$(g.selector+"content a.date").click(function(a){var b=$(this).attr("data-index");t(b,$(this).attr("data-date-index")),a.stopPropagation()}),y()},g.select=function(d,e){var f,i,j;if(d!==m||n!==e){i="fly",d==m&&e!=n&&(i="pan"),m=d,n=n,"geographic"!==a.proj.selected.id&&a.proj.select("geographic"),g.selected=d,f=h.data.events[d],eventItem=null,f.geometries.length>1?eventItem=f.geometries[e||0]:eventItem=f.geometries[0],category="Default",categories=f.categories,categories.constructor!==Array&&(categories=[categories]),_.each(categories,function(a){if(h.layers[a.title])return void(category=a.title)}),layers=h.layers[category],layers||(layers=h.layers.Default),_.each(a.layers.active,function(b){a.layers.setVisibility(b.id,!1)}),_.each(layers,function(b){var c=b[0],d=b[1];a.layers.exists(c)?a.layers.setVisibility(c,d):a.layers.add(c,{visible:d})}),eventDate=wv.util.parseTimestampUTC(eventItem.date);var l=wv.util.toISOStringDate(eventDate),o=wv.util.toISOStringDate(wv.util.today()),p=f.categories[0].title||null;if(l!==o&&null!==p&&"Wildfires"==p){var q=wv.util.dateAdd(wv.util.parseDateUTC(eventItem.date),"day",1);a.date.select(q)}else a.date.select(eventDate);null!==p&&"Wildfires"==p?j=8:"Volcanoes"==p&&(j=6);var r=function(){k.draw(eventItem.coordinates)};if("Point"===eventItem.type)b.map.animate.move(i,eventItem.coordinates,j,r);else if("Polygon"===eventItem.type&&5==eventItem.coordinates[0].length){c=eventItem.coordinates[0];var s=[c[0][0],c[0][1],c[2][0],c[2][1]];b.map.animate.move(i,s,j,r)}}};var s=function(a,b,c){var d=z(b.geometries);eventDate=wv.util.parseDateUTC(d[0].date),dateString=wv.util.giveWeekDay(eventDate)+", "+wv.util.giveMonth(eventDate)+" "+eventDate.getUTCDate(),eventDate.getUTCFullYear()!==wv.util.today().getUTCFullYear()&&(dateString+=", "+eventDate.getUTCFullYear());var e=$("<li></li>").addClass("selectorItem").addClass("item").addClass(b.categories[0].css).attr("data-index",c),f=$("<h4></h4>").addClass("title").html(b.title+"<br/>"+dateString),g=$("<p></p>").addClass("subtitle").html(b.description).hide(),i=$("<i></i>").addClass("map-marker").attr("title",b.categories[0].title),j=$("<ul></ul>").addClass("dates").hide();if(b.geometries.length>1){var k;_.each(b.geometries,function(a,b){date=a.date.split(/T/)[0],date!==k&&($date=$("<a></a>").addClass("date").attr("data-date-index",b).attr("data-index",c).html(date),j.append($("<li class='dates'></li>").append($date)),k=date)})}e.append(i).append(f).append(g).append(j);var l=z(b.sources);l.length>0&&(items=[],_.each(l,function(a){var b=_.find(h.data.sources,{id:a.id});a.url?items.push("<a target='event' class='natural-event-link' href='"+a.url+"'><i class='fa fa-external-link fa-1'></i>"+b.title+"</a>"):items.push(b.title)}),g.append(items.join(" "))),a.append(e),$(".natural-event-link").click(function(a){a.stopPropagation()})},t=function(a,b){g.select(a,b),$("#wv-eventscontent .subtitle").hide(),$("#wv-eventscontent .dates").hide(),$("#wv-eventscontent [data-index='"+a+"'] .subtitle").show(),$("#wv-eventscontent [data-index='"+a+"'] .dates").show(),y()},u=function(){$("#wv-eventscontent .subtitle").hide(),$("#wv-eventscontent .dates").hide(),y()},v=function(a){var b=a||"Events may not be visible at all times.  Read more...",c=$(".notify-message");c.empty(),c.append(b),i.find("i:first-child").attr("title",b),l||i.dialog("open")},w=!1,x=function(){var a=$(window).outerHeight(!0),b=$("ul#productsHolder-tabs").outerHeight(!0),c=$("#wv-events-facets").outerHeight(!0),d=$("#productsHolder").innerHeight()-$("#productsHolder").height(),e=$("#productsHolder").offset(),f=$("#timeline").outerHeight(!0),h=a-b-c-e.top-d;wv.util.browser.small||(h=h-f-10-5),$(g.selector).css("max-height",h);var i=$("#wv-eventscontent").outerHeight(!0);h<=i?($("#wv-events").css("height",h).css("padding-right","10px"),w?$(g.selector).perfectScrollbar("update"):($(g.selector).perfectScrollbar(),w=!0)):($("#wv-events").css("height","").css("padding-right",""),w&&($(g.selector).perfectScrollbar("destroy"),w=!1))},y=function(){x()},z=function(a){return a?(a.constructor!==Array&&(a=[a]),a):[]};return o(),g};var wv=wv||{};wv.naturalEvents=wv.naturalEvents||{},wv.naturalEvents.map=wv.naturalEvents.map||function(a,b,c){var d={},e=null,f=null;d.current=null;var g=function(){f||(f=b.selected)},h=function(){var a=f.getView().getZoom(),b=12,c=Math.pow(2,a),d=Math.min(b+c,b+32);return{scale:d/48,size:d}},i=function(a){var b=h(),c="images/event-icon2.png";return[new ol.style.Style({image:new ol.style.Icon({src:c,scale:b.scale,anchor:[.5,46],anchorXUnits:"fraction",anchorYUnits:"pixels"})})]},j=function(a){return[new ol.style.Style({fill:new ol.style.Fill({color:[255,255,255,.1]}),stroke:new ol.style.Stroke({color:[212,85,0,.8],width:2})})]};d.draw=function(a,c){f=b.selected,f.removeLayer(e);var g,h;a[0].length>2?(h=new ol.geom.Polygon(a),g=j):(h=new ol.geom.Point(a),g=i);var k=new ol.Feature({geometry:h,name:"NaturalEvent",population:4e3,rainfall:500});k.setStyle(g);var l=new ol.source.Vector({features:[k],wrapX:!1});e=new ol.layer.Vector({source:l}),f.addLayer(e),d.current=a};var k=function(){f.removeLayer(e)};return d.dispose=k,g(),d};var wv=wv||{};wv.feedback=wv.feedback||function(){var a={},b=!1;return a.decorate=function(a){a.attr("href","mailto:support@earthdata.nasa.gov?subject=Feedback for EOSDIS Worldview tool"),a.click(function(a){!wv.util.browser.small&&window.feedback&&(a.preventDefault(),b||feedback.init({showIcon:!1}),feedback.showForm(),b=!0)})},a}();var wv=wv||{};wv.tour=wv.tour||function(a,b,c){var d={},e=function(){$("#wv-tour").click(function(){d.start()}),d.introduction()};d.introduction=function(){c.features.tour&&(window.location.search&&!c.parameters.tour||wv.util.browser.ie&&wv.util.browser.version<=9||wv.util.browser.localStorage&&(wv.util.localStorage("hideSplash")||i()&&d.start(!0)))},d.start=function(a){return wv.util.browser.ie&&wv.util.browser.version<=9?void wv.ui.unsupported("tour"):i()?($content=$("#wv-tour-content"),void(0===$content.children().length?$content.load("pages/tour.html",function(){f(a)}):f(a))):void wv.ui.notify("Unfortunately the Worldview tour can only be viewed in larger web browser windows.")};var f=function(a){wv.ui.close();var b=$("#wv-tour-intro");b.dialog({title:"Welcome to Worldview!",dialogClass:"tour",modal:!0,width:700,height:"auto",draggable:!1,resizable:!1}),a?$("#wv-tour-skip").show():$("#wv-tour-skip").hide();var c=document.getElementById("mapPanelTourAnchor");if(!c){var d=document.getElementById("wv-map");c=document.createElement("div"),c.setAttribute("id","mapPanelTourAnchor"),c.setAttribute("style","float:right; height:68px; right:14px; top:90px; width:36px; position:relative; z-index:-1"),d.appendChild(c)}var e=function(){wv.ui.close(),$dialog=$("#wv-tour-end"),$dialog.dialog({title:"Finished!",dialogClass:"tour",modal:!0,width:600,height:"auto",draggable:!1,resizable:!1}),wv.feedback.decorate($dialog.find(".feedback")),$("#repeat").click(f),$("#done").click(i)},f=function(a){a.stopPropagation(),$(".ui-dialog-content").dialog("close"),$("#joyRideTipContent").joyride({adjustForPhone:!1,bordered:!0,includepage:!0,template:{link:'<a href="#" class="joyride-close-tip">X</a>'},postStepCallback:function(a,b){5==a&&e()}})},i=function(a){a.stopPropagation(),$(".ui-dialog-content").dialog("close")},j=function(){$(".ui-dialog-content").dialog("close")},k=function(a,b,c){h(),WVC.GA.event("Tour","Click","Post Tour View",a+1),5==a&&"previous"!==c&&e()},l=function(a){a.stopPropagation(),$(".ui-dialog-content").dialog("close"),g(),WVC.GA.event("Tour","Click","Take Tour"),$("#joyRideTipContent").joyride({adjustForPhone:!1,bordered:!0,includepage:!0,template:{link:'<a href="#" class="joyride-close-tip">X</a>'},postStepCallback:k})},m=function(){var a=wv.util.localStorage("hideSplash");wv.util.localStorage("hideSplash",!a)};$("#takeTour").click(l),$("#skipTour").click(j),$("#dontShowAgain").click(m)},g=function(){var c=b.map.selected;a.proj.selectDefault(),a.date.select(wv.util.today()),a.layers.reset();var d=a.map.getLeadingExtent();c.getView().fit(d,c.getSize()),h()},h=function(){b.sidebar.expandNow(),b.sidebar.selectTab("active"),b.timeline.expandNow(),a.proj.selectDefault()},i=function(){var a=$(window).width(),b=$(window).height();return a>=768&&b>=680};return e(),d};var wv=wv||{};wv.debug=wv.debug||function(){var a=wv.util.fromQueryString(location.search),b={},c=function(){if(a.loadDelay){var c;try{c=parseInt(a.loadDelay),b.loadDelay(c)}catch(a){return void console.warn("Invalid load delay: "+c)}}a.showError&&$(function(){wv.util.error()})},d=function(a,b,c){return function(d){return b(function(){var b=arguments;setTimeout(function(){d&&d.apply(a,b)},c)}),a}};return b.loadDelay=function(a){var b=$.ajax;$.ajax=function(){var c=arguments;console.log("delay",a,c);var e=b.apply($,arguments),f=e.done;e.done=d(e,f,a),e.done(function(){console.log("done",c)});var g=e.fail;e.fail=d(e,g,a),e.fail(function(){console.log("fail",c)});var h=e.always;return e.always=d(e,h,a),e}},c(),b}(),wv.debug.config=wv.debug.config||function(a){if("tiles"===a.parameters.debug){var b=_.parseInt(a.parameters.tileSize);if(_.isNaN(b))throw new Error("No tileSize specified");console.log("Debugging tiles with size",b),a.layers.debug_tile={id:"debug_tile",title:"Debug Tiles",subtitle:"Worldview",tags:"debug",group:"overlays",format:"image/svg",type:"wmts",noTransition:"true",projections:{}},_.each(a.projections,function(c){a.layers.debug_tile.projections[c.id]={source:"debug_tile",matrixSet:b}}),a.sources.debug_tile={url:"service/debug_tile.cgi",matrixSets:{}},a.sources.debug_tile.matrixSets[b]={id:b,tileSize:[b,b]},a.layerOrder.push("debug_tile"),a.defaults.startingLayers.push({id:"debug_tile"})}},wv.debug.layers=wv.debug.layers||function(a,b,c){var d,e,f={gibs:!0,layers:!0,palettes:!0,dataDownload:!0},g=function(){d=c.parameters.debug,c.parameters.debugGIBS&&(d="gibs"),"gibs"===d&&a.sidebar.collapse(),f[d]&&("palettes"===d?wv.palettes.loadCustom(c).done(h):h())},h=function(a){var c=$("<div id='wv-debug-gibs'><div class='wv-debug-gibs-layer'><button class='wv-debug-gibs-previous-layer'>-</button><button class='wv-debug-gibs-next-layer'>+</button><select class='wv-debug-gibs-layerlist'></select></div><div class='wv-debug-gibs-date'><button class='wv-debug-gibs-previous-date'>-</button><button class='wv-debug-gibs-next-date'>+</button><span class='wv-debug-gibs-date-label'>Date</span></div></div>");$("body").append(c),j();var d=$(".wv-debug-gibs-layerlist");d.on("change",k),b.date.events.on("select",n),b.proj.events.on("select",j),$(".wv-debug-gibs-next-layer").click(l),$(".wv-debug-gibs-previous-layer").click(m),$(".wv-debug-gibs-next-date").click(o),$(".wv-debug-gibs-previous-date").click(p),n()},i=function(a){var c=b.proj.selected.id;return!!a.projections[c]&&("Land_Water_Map"!==a.id&&"Land_Mask"!==a.id&&("gibs"===d&&"daily"===a.period&&"wmts"===a.type||(!("palettes"!==d||!a.palette||a.palette.immutable)||(!("dataDownload"!==d||!a.product)||"layers"===d))))},j=function(){var a=$(".wv-debug-gibs-layerlist");a.empty();var e=(b.proj.selected.id,_.sortBy(c.layers,["title","subtitle"]));_.each(e,function(c){if(i(c)){var d=b.layers.getTitles(c.id),e=d.title+"; "+d.subtitle;e.length>65&&(e=e.substr(0,65)+"..."),console.log(c.id);var f=$("<option></option>").val(encodeURIComponent(c.id)).html(e);a.append(f)}}),b.layers.clear(),"gibs"!==d&&c.layers.Land_Water_Map&&b.layers.add("Land_Water_Map"),k.apply(a),"dataDownload"===d&&b.data.activate()},k=function(){if($(this).val()){var a=decodeURIComponent($(this).val()),f=b.layers.getTitles(a);if(console.log(f.title+"; "+f.subtitle),e&&(b.layers.remove(e),b.palettes.clearCustom(e)),b.layers.add(a),"gibs"!==d){var g=b.layers.dateRange();g&&c.parameters&&!c.parameters.ignoreRange&&(g.end.setUTCDate(g.end.getUTCDate()-1),b.date.select(g.end))}e=a,"palettes"===d&&wv.palettes.loadRendered(c,a).done(function(){var d=c.layers[a],e=c.palettes.rendered[a];d.palette.recommended?b.palettes.setCustom(a,d.palette.recommended[0]):e.scale?b.palettes.setCustom(a,"rainbow_2"):b.palettes.setCustom(a,"blue_light")})}},l=function(){$(".wv-debug-gibs-layerlist option:selected").next().attr("selected","selected"),k.apply($(".wv-debug-gibs-layerlist"))},m=function(){$(".wv-debug-gibs-layerlist option:selected").prev().attr("selected","selected"),k.apply($(".wv-debug-gibs-layerlist"))},n=function(){$(".wv-debug-gibs-date-label").html(wv.util.toISOStringDate(b.date.selected))},o=function(){var a=new Date(b.date.selected.getTime());a.setUTCDate(a.getUTCDate()+1),b.date.select(a)},p=function(){var a=new Date(b.date.selected.getTime());a.setUTCDate(a.getUTCDate()-1),b.date.select(a)};g()};var wvx=wvx||{};$(function(){var a,b,c=wv.util.fromQueryString(location.search),d=wv.util.fromQueryString(location.search),e=[],f=function(){d.elapsed?b=(new Date).getTime():k=function(){},k("start"),g()},g=function(){k("loading config");var a=wv.brand.url("config/wv.json"),b=$.getJSON(a);b.done(wv.util.wrap(h)).fail(wv.util.error),wv.ui.indicator.delayed(b,1e3)},h=function(b){k("config loaded"),a=b,a.parameters=d,wvx.config=a,wv.debug.config(a),a.scripts&&_.each(a.scripts,function(a){$.getScript(a)}),wv.layers.validate(e,a),parsers=[wv.proj.parse,wv.layers.parse,wv.date.parse,wv.map.parse,wv.palettes.parse],a.features.dataDownload&&parsers.push(wv.data.parse),a.features.animation&&parsers.push(wv.anim.parse),_.each(parsers,function(b){b(c,e,a)}),requirements=[wv.palettes.requirements(c,a)],$.when.apply(null,requirements).then(wv.util.wrap(i)).fail(wv.util.error)},i=function(){function b(){f.timeline=wv.date.timeline(e,a,f),f.timeline.data=wv.date.timeline.data(e,a,f),f.timeline.zoom=wv.date.timeline.zoom(e,a,f),f.timeline.ticks=wv.date.timeline.ticks(e,a,f),f.timeline.pick=wv.date.timeline.pick(e,a,f),f.timeline.pan=wv.date.timeline.pan(e,a,f),f.timeline.config=wv.date.timeline.config(e,a,f),f.timeline.input=wv.date.timeline.input(e,a,f),a.features.animation&&(f.anim={},f.anim.rangeselect=wv.anim.rangeselect(e,a,f),f.anim.widget=wv.anim.widget(e,a,f),f.anim.gif=wv.anim.gif(e,a,f),f.anim.ui=wv.anim.ui(e,f)),f.dateLabel=wv.date.label(e)}k("init");var d;a.defaults.startDate?d=wv.util.parseDateUTC(a.defaults.startDate):(d=wv.util.now(),d.getUTCHours()<3&&d.setUTCDate(d.getUTCDate()-1));var e={wv:{events:wv.util.events()}},f={};wvx.models=e,wvx.ui=f,e.proj=wv.proj.model(a),e.palettes=wv.palettes.model(e,a),e.layers=wv.layers.model(e,a),e.date=wv.date.model(a,{initial:d}),e.map=wv.map.model(e,a),e.link=wv.link.model(a),e.link.register(e.proj).register(e.layers).register(e.date).register(e.palettes).register(e.map),e.link.load(c),a.features.googleAnalytics&&WVC.GA.init(a.features.googleAnalytics.id);var g={Rotation:wv.map.rotate,Runningdata:wv.map.runningdata,Layerbuilder:wv.map.layerbuilder,Dateline:wv.map.datelinebuilder,Precache:wv.map.precachetile};f.map=wv.map.ui(e,a,g),f.map.animate=wv.map.animate(e,a,f),a.features.animation&&(e.anim=wv.anim.model(e,a),e.link.register(e.anim)),a.features.dataDownload&&(e.data=wv.data.model(e,a)),a.features.dataDownload&&e.link.register(e.data),a.features.naturalEvents&&(e.naturalEvents=wv.naturalEvents.model(e,a),e.link.register(e.naturalEvents)),e.link.load(c),a.features.arcticProjectionChange&&(e.proj.change=wv.proj.change(e,a)),k("ui"),f.proj=wv.proj.ui(e,a),f.sidebar=wv.layers.sidebar(e,a),f.activeLayers=wv.layers.active(e,f,a),f.addModal=wv.layers.modal(e,f,a),a.startDate&&(wv.util.browser.small||b(),f.dateWheels=wv.date.wheels(e,a)),f.rubberband=wv.image.rubberband(e,f,a),f.image=wv.image.panel(e,f,a),a.features.dataDownload&&(f.data=wv.data.ui(e,f,a),f.data.render()),a.features.naturalEvents&&(f.naturalEvents=wv.naturalEvents.ui(e,f,a,wv.naturalEvents.request(e,f,a))),f.link=wv.link.ui(e,a),f.tour=wv.tour(e,f,a),f.info=wv.ui.info(f,a),a.features.alert&&(f.alert=wv.notifications.ui(f,a)),$(window).resize(function(){wv.util.browser.small&&$("#productsHoldertabs li.first a").trigger("click"),f.timeline||b()}),document.activeElement.blur(),$("input").blur(),$("#eventsHolder").hide(),a.features.dataDownload&&(e.data.events.on("activate",function(){f.sidebar.selectTab("download")}).on("queryResults",function(){f.data.onViewChange()}),f.map.events.on("extent",function(){f.data.onViewChange()}),e.map.events.on("projection",e.data.updateProjection)),$(document).click(function(a){"INPUT"!==a.target.nodeName&&$("input").blur()}),wv.brand.release()?console.info(wv.brand.NAME+" - Version "+wv.brand.VERSION+" - "+wv.brand.BUILD_TIMESTAMP):console.warn("Development version"),wv.debug.layers(f,e,a),j(),e.wv.events.trigger("startup"),k("done")},j=function(){var a=0;_.each(e,function(b){var c=b.cause?": "+b.cause:"";wv.util.warn(b.message+c),b.layerRemoved&&(a+=1)})},k=function(a){var c=(new Date).getTime()-b;console.log(c,a)};wv.util.wrap(f)()});